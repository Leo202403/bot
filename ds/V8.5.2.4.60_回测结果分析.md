# V8.5.2.4.60 å›æµ‹ç»“æœåˆ†æ

**æ—¥æœŸ**: 2025-11-19  
**ç‰ˆæœ¬**: V8.5.2.4.60  
**çŠ¶æ€**: âš ï¸ ä¿®å¤å·²åº”ç”¨ï¼Œä½†å‘ç°æ–°é—®é¢˜

---

## âœ… ä¿®å¤éªŒè¯ï¼šå·²æ­£ç¡®åº”ç”¨

### 1. TP/SLæµ‹è¯•æˆåŠŸ
```
âš¡ è¶…çŸ­çº¿: TP=30.0, SL=1.5 â†’ åˆ©æ¶¦12.84% âœ…
ğŸŒŠ æ³¢æ®µ: TP=35.0, SL=2.5 â†’ åˆ©æ¶¦13.48% âœ…
```

### 2. Phase 3æœç´¢ç©ºé—´æ­£ç¡®
```
ğŸ¯ ã€SCALPINGå‚æ•°ä¼˜åŒ–ã€‘
   ğŸ“ å‚æ•°ç½‘æ ¼: TP=[24.0, 30.0, 36.0, 45.0]
   ğŸ’¡ å›´ç»•Phase 2æœ€ä¼˜å€¼(TP=30.0, SL=1.5)æ„å»ºæœç´¢ç©ºé—´ âœ…

ğŸ¯ ã€SWINGå‚æ•°ä¼˜åŒ–ã€‘
   ğŸ“ å‚æ•°ç½‘æ ¼: TP=[28.0, 35.0, 42.0, 52.5]
   ğŸ’¡ å›´ç»•Phase 2æœ€ä¼˜å€¼(TP=35.0, SL=2.5)æ„å»ºæœç´¢ç©ºé—´ âœ…
```

**ç»“è®º**: V8.5.2.4.60çš„æ‰€æœ‰5ä¸ªä¿®å¤éƒ½å·²æ­£ç¡®åº”ç”¨ï¼

---

## âš ï¸ å‘ç°æ–°é—®é¢˜

### Phase 2 Baselineåˆ©æ¶¦å¼‚å¸¸ä½

```
ğŸ“Š Phase 2 baselineï¼ˆä¾›Phase 3ä½¿ç”¨ï¼‰:
   æ•è·: 2499ä¸ª (62.5%)
   å¹³å‡åˆ©æ¶¦: 1.01% âš ï¸
```

**é—®é¢˜**:
- **é¢„æœŸ**: ~12%ï¼ˆæ¥è¿‘TP/SLæµ‹è¯•çš„12.84%/13.48%ï¼‰
- **å®é™…**: 1.01%
- **å·®è·**: ç›¸å·®10å€ä»¥ä¸Š

### å‚æ•°ç»„åˆæµ‹è¯•åˆ©æ¶¦å…¨ä¸º0

```
ğŸ“Š ã€å‚æ•°æµ‹è¯•ç»“æœæ±‡æ€»ã€‘
   #1 è¶…å®½æ¾-ä½åˆ†
      æ•è·ç‡: 62.0% (1735ä¸ª)
      å¹³å‡åˆ©æ¶¦: 0.00% âŒ
   #2 è¶…å®½æ¾
      æ•è·ç‡: 52.1% (1458ä¸ª)
      å¹³å‡åˆ©æ¶¦: 0.00% âŒ
   #3 æå®½æ¾
      æ•è·ç‡: 52.1% (1458ä¸ª)
      å¹³å‡åˆ©æ¶¦: 0.00% âŒ
```

**æ‰€æœ‰27ç»„å‚æ•°ç»„åˆçš„åˆ©æ¶¦éƒ½æ˜¯0.00%**ï¼

---

## ğŸ” é—®é¢˜æ ¹æºåˆ†æ

### å¯¹æ¯”ä¸¤ä¸ªé˜¶æ®µ

#### TP/SLæµ‹è¯•é˜¶æ®µï¼ˆæ­£å¸¸ï¼‰
**æ–¹æ³•**: ç›´æ¥åŸºäº`objective_profit`åˆ¤æ–­

```python
# Line 7016-7017
tp_pct = tp * atr  # 30 * 1.2 = 36%
sl_pct = sl * atr  # 1.5 * 1.2 = 1.8%

# Line 7020-7029
if objective_profit >= tp_pct:
    profit_pct = tp_pct  # è§¦å‘TPï¼Œä½¿ç”¨36%
elif objective_profit < -sl_pct:
    profit_pct = -sl_pct  # è§¦å‘SLï¼Œä½¿ç”¨-1.8%
else:
    profit_pct = objective_profit  # ä½¿ç”¨å®é™…åˆ©æ¶¦
```

**ç»“æœ**: åˆ©æ¶¦12.84%/13.48% âœ…

#### å‚æ•°ç»„åˆæµ‹è¯•é˜¶æ®µï¼ˆå¼‚å¸¸ï¼‰
**æ–¹æ³•**: è°ƒç”¨`calculate_single_actual_profit()`

```python
# Line 7356-7360
actual_profit = calculate_single_actual_profit(
    opp,
    strategy_params=strategy_params,
    use_dynamic_atr=False
)
```

**ç»“æœ**: åˆ©æ¶¦0.00% âŒ

---

## ğŸ’¡ æ¨æµ‹çš„é—®é¢˜

### `calculate_actual_profit.py`ä¾èµ–`future_data`

```python
# Line 52-61
future_data = opportunity.get('future_data', {})

# å¦‚æœfuture_dataä¸ºç©ºæˆ–ä¸å®Œæ•´
max_high = future_data.get('max_high', entry_price)
min_low = future_data.get('min_low', entry_price)
final_close = future_data.get('final_close', entry_price)
```

**å¦‚æœ`future_data`ç¼ºå¤±**:
- `max_high = entry_price`
- `min_low = entry_price`
- `final_close = entry_price`

â†’ **ä»·æ ¼æ²¡æœ‰æ³¢åŠ¨** â†’ **æ°¸è¿œä¸è§¦å‘TP/SL** â†’ **åˆ©æ¶¦=0**

### Phase 1æ”¶é›†çš„æœºä¼šå¯èƒ½ç¼ºå°‘`future_data`

Phase 1æœºä¼šæ•°æ®åŒ…å«ï¼š
```python
['coin', 'timestamp', 'time', 'date', 'entry_price', 'direction',
 'objective_profit', 'holding_hours', 'profit_density', 'consensus']
```

**é—®é¢˜**: å¯èƒ½æ²¡æœ‰`future_data`å­—æ®µï¼ˆåŒ…å«max_high, min_low, final_closeï¼‰ï¼

---

## ğŸ“Š æ•°æ®å¯¹æ¯”

| é˜¶æ®µ | æ–¹æ³• | ä¾èµ–æ•°æ® | ç»“æœ |
|------|------|----------|------|
| TP/SLæµ‹è¯• | åŸºäºobjective_profit | objective_profit âœ… | 12.84%/13.48% âœ… |
| å‚æ•°ç»„åˆæµ‹è¯• | calculate_actual_profit() | future_data âŒ? | 0.00% âŒ |
| Phase 2 Baseline | calculate_actual_profit() | future_data âŒ? | 1.01% âš ï¸ |
| Phase 3åˆ†ç¦»ä¼˜åŒ– | åŸºäºPhase 2 Baseline | future_data âŒ? | -0.94%/-1.49% âŒ |

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šä¿®å¤`calculate_actual_profit.py`ä½¿ç”¨Phase 1çš„`objective_profit`

å½“`future_data`ç¼ºå¤±æ—¶ï¼Œä½¿ç”¨ä¸TP/SLæµ‹è¯•ç›¸åŒçš„ç®€åŒ–é€»è¾‘ï¼š

```python
# åœ¨calculate_single_actual_profit()ä¸­æ·»åŠ 
if not future_data or max_high == min_low == entry_price:
    # é™çº§ï¼šä½¿ç”¨objective_profit + TP/SLåˆ¤æ–­ï¼ˆä¸Phase 2 TP/SLæµ‹è¯•ä¸€è‡´ï¼‰
    objective_profit = opportunity.get('objective_profit', 0)
    
    tp_pct = atr_tp_mult * atr
    sl_pct = atr_stop_mult * atr
    
    if objective_profit >= tp_pct:
        profit_pct = tp_pct  # è§¦å‘TP
    elif objective_profit < -sl_pct:
        profit_pct = -sl_pct  # è§¦å‘SL
    else:
        profit_pct = objective_profit  # å®é™…åˆ©æ¶¦
    
    return profit_pct - trading_cost if include_trading_costs else profit_pct
```

### æ–¹æ¡ˆBï¼šç¡®ä¿Phase 1æ”¶é›†`future_data`

ä¿®æ”¹Phase 1æœºä¼šæ”¶é›†é€»è¾‘ï¼Œåœ¨è¯†åˆ«æœºä¼šæ—¶åŒæ—¶è®°å½•`future_data`ã€‚

**ä¼˜ç‚¹**: æ›´ç²¾ç¡®  
**ç¼ºç‚¹**: éœ€è¦å¤§é‡ä¿®æ”¹ï¼Œä¸”å¢åŠ å†…å­˜å ç”¨

---

## ğŸ”§ å»ºè®®ä¼˜å…ˆä¿®å¤

**æ¨èæ–¹æ¡ˆA**:
1. ä¿®æ”¹`calculate_actual_profit.py`
2. æ·»åŠ é™çº§é€»è¾‘ï¼šå½“`future_data`ç¼ºå¤±æ—¶ï¼Œä½¿ç”¨`objective_profit` + TP/SLåˆ¤æ–­
3. ç¡®ä¿ä¸TP/SLæµ‹è¯•é˜¶æ®µçš„è®¡ç®—é€»è¾‘ä¸€è‡´

**é¢„æœŸæ•ˆæœ**:
- Phase 2 Baseline: 1.01% â†’ ~12%ï¼ˆæ¥è¿‘TP/SLæµ‹è¯•ï¼‰
- å‚æ•°ç»„åˆæµ‹è¯•: 0.00% â†’ æ­£å¸¸å€¼
- Phase 3: èƒ½å¤ŸåŸºäºæ­£ç¡®çš„baselineä¼˜åŒ–

---

## ğŸ“ ç»“è®º

**V8.5.2.4.60çš„ä¿®å¤å·²æ­£ç¡®åº”ç”¨**ï¼š
- âœ… Phase 2 Baselineä½¿ç”¨æœ€ä¼˜TP/SL
- âœ… å‰å‘éªŒè¯ä½¿ç”¨æœ€ä¼˜TP/SL
- âœ… learned_featuresä¼ é€’æœ€ä¼˜TP/SL
- âœ… Phase 3çŸ©é˜µä½¿ç”¨æœ€ä¼˜TP/SL
- âœ… Phase 3æœç´¢ç©ºé—´å›´ç»•æœ€ä¼˜å€¼

**ä½†å‘ç°æ–°é—®é¢˜**ï¼š
- âš ï¸ `calculate_actual_profit.py`åœ¨`future_data`ç¼ºå¤±æ—¶è¿”å›0
- âš ï¸ å¯¼è‡´Phase 2 Baselineå’Œå‚æ•°ç»„åˆæµ‹è¯•ç»“æœå¼‚å¸¸

**ä¸‹ä¸€æ­¥**ï¼š
- ğŸ”§ V8.5.2.4.61: ä¿®å¤`calculate_actual_profit.py`çš„é™çº§é€»è¾‘
- ğŸ“Š é‡æ–°å›æµ‹éªŒè¯å®Œæ•´æ•ˆæœ

