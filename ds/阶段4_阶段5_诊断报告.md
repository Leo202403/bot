# é˜¶æ®µ4å’Œé˜¶æ®µ5è¯Šæ–­æŠ¥å‘Š

## ğŸ“‹ é˜¶æ®µæ¦‚è¿°

### **é˜¶æ®µ4ï¼šç»“æœéªŒè¯**
- **èŒè´£**ï¼šç”¨æœ€ä¼˜å‚æ•°é‡æ–°è®¡ç®—å®é™…åˆ©æ¶¦ï¼Œå¯¹æ¯”ä¼˜åŒ–å‰åçš„æ•ˆæœ
- **è¾“å…¥**ï¼šä¼˜åŒ–åçš„å‚æ•°ã€åŸå§‹æœºä¼šåˆ—è¡¨
- **è¾“å‡º**ï¼šå‰åå¯¹æ¯”æŠ¥å‘Šï¼ˆbaseline vs optimizedï¼‰

### **é˜¶æ®µ5ï¼šåº”ç”¨æ–°å‚æ•°**
- **èŒè´£**ï¼šä¿å­˜ä¼˜åŒ–åçš„å‚æ•°åˆ°learning_config.jsonï¼Œä¾›å®ç›˜ä½¿ç”¨
- **è¾“å…¥**ï¼šéªŒè¯é€šè¿‡çš„å‚æ•°
- **è¾“å‡º**ï¼šæ›´æ–°åçš„é…ç½®æ–‡ä»¶

---

## ğŸ” å½“å‰å®ç°åˆ†æ

### **é˜¶æ®µ4å®ç°ï¼ˆä»£ç ä½ç½®ï¼‰**

**æ–‡ä»¶**ï¼š`ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆç¬¬20381-20462è¡Œï¼‰

```python
# ã€V8.4.2ä¿®å¤ã€‘é‡æ–°è®¡ç®—actual_profitä»¥ç¡®ä¿ä¸å‚æ•°ä¸€è‡´
print(f"\n  ğŸ“Š è®¡ç®—å‰åå¯¹æ¯”ï¼ˆä½¿ç”¨çœŸå®åˆ©æ¶¦ï¼‰...")

# å¯¼å…¥å®é™…åˆ©æ¶¦è®¡ç®—æ¨¡å—
from calculate_actual_profit import calculate_actual_profit_batch

# ä¸ºbaselineé‡æ–°è®¡ç®—actual_profit
print(f"     è®¡ç®—baselineï¼ˆå½“å‰å‚æ•°ï¼‰...")
baseline_opps_copy = [opp.copy() for opp in opportunities]
baseline_opps_updated = calculate_actual_profit_batch(
    opportunities=baseline_opps_copy,
    strategy_params=current_params,
    batch_size=100
)

# ä¸ºoptimizedé‡æ–°è®¡ç®—actual_profit
print(f"     è®¡ç®—optimizedï¼ˆæ–°å‚æ•°ï¼‰...")
optimized_opps_copy = [opp.copy() for opp in opportunities]
optimized_opps_updated = calculate_actual_profit_batch(
    opportunities=optimized_opps_copy,
    strategy_params=v8321_result['optimized_params'],
    batch_size=100
)

# è®¡ç®—ç»Ÿè®¡æ•°æ®ï¼ˆåªç»Ÿè®¡è§¦å‘TP/SLçš„äº¤æ˜“ï¼Œä¸åŒ…æ‹¬time_exitï¼‰
baseline_trades = [o for o in baseline_opps_updated 
                 if o.get('exit_reason') in ['tp', 'sl']]
optimized_trades = [o for o in optimized_opps_updated 
                  if o.get('exit_reason') in ['tp', 'sl']]

baseline_result = {
    'captured_count': len(baseline_trades),
    'avg_profit': (sum(o.get('actual_profit_pct', 0) for o in baseline_trades) / len(baseline_trades)) if baseline_trades else 0,
    'capture_rate': len(baseline_trades) / len(opportunities) if opportunities else 0
}

optimized_result = {
    'captured_count': len(optimized_trades),
    'avg_profit': (sum(o.get('actual_profit_pct', 0) for o in optimized_trades) / len(optimized_trades)) if optimized_trades else 0,
    'capture_rate': len(optimized_trades) / len(opportunities) if opportunities else 0
}
```

### **é˜¶æ®µ5å®ç°ï¼ˆä»£ç ä½ç½®ï¼‰**

**æ–‡ä»¶**ï¼š`ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆç¬¬8481-8525è¡Œï¼‰

```python
# è¶…çŸ­çº¿ä¼˜åŒ–å®Œæˆå
if scalping_optimization.get('improvement') is not None:
    # æ›´æ–°configä¸­çš„è¶…çŸ­çº¿å‚æ•°
    if 'scalping_params' not in config:
        config['scalping_params'] = {}
    config['scalping_params'].update(scalping_optimization['optimized_params'])
    
    old_rate = scalping_optimization['old_time_exit_rate']
    new_rate = scalping_optimization['new_time_exit_rate']
    old_profit = scalping_optimization['old_avg_profit']
    new_profit = scalping_optimization['new_avg_profit']
    
    print(f"  âœ… è¶…çŸ­çº¿ä¼˜åŒ–å®Œæˆ:")
    print(f"     time_exitç‡: {old_rate*100:.0f}% â†’ {new_rate*100:.0f}% ({(new_rate-old_rate)*100:+.0f}%)")
    print(f"     å¹³å‡åˆ©æ¶¦: {old_profit:.1f}% â†’ {new_profit:.1f}% ({new_profit-old_profit:+.1f}%)")

# æ³¢æ®µä¼˜åŒ–å®Œæˆå
if swing_optimization.get('improvement') is not None:
    # æ›´æ–°configä¸­çš„æ³¢æ®µå‚æ•°
    if 'swing_params' not in config:
        config['swing_params'] = {}
    config['swing_params'].update(swing_optimization['optimized_params'])
    
    old_profit = swing_optimization['old_avg_profit']
    new_profit = swing_optimization['new_avg_profit']
    old_capture = swing_optimization['old_capture_rate']
    new_capture = swing_optimization['new_capture_rate']
    
    print(f"  âœ… æ³¢æ®µä¼˜åŒ–å®Œæˆ:")
    print(f"     å¹³å‡åˆ©æ¶¦: {old_profit:.1f}% â†’ {new_profit:.1f}% ({new_profit-old_profit:+.1f}%)")
    print(f"     æ•è·ç‡: {old_capture*100:.0f}% â†’ {new_capture*100:.0f}% ({(new_capture-old_capture)*100:+.0f}%)")
```

---

## âš ï¸ å‘ç°çš„é—®é¢˜

### **é—®é¢˜1ï¼šé˜¶æ®µ4åªç»Ÿè®¡TP/SLäº¤æ˜“ï¼Œæ’é™¤time_exit** ğŸ”´

#### **å½“å‰å®ç°**

```python
# åªç»Ÿè®¡è§¦å‘TP/SLçš„äº¤æ˜“ï¼Œä¸åŒ…æ‹¬time_exit
baseline_trades = [o for o in baseline_opps_updated 
                 if o.get('exit_reason') in ['tp', 'sl']]
optimized_trades = [o for o in optimized_opps_updated 
                  if o.get('exit_reason') in ['tp', 'sl']]
```

#### **é—®é¢˜**

è¿™ä¸é˜¶æ®µ3çš„è¯„åˆ†å‡½æ•°æ”¹è¿›**ä¸ä¸€è‡´**ï¼

```python
# é˜¶æ®µ3ï¼ˆV8.4.5ï¼‰ï¼šç»Ÿè®¡æ‰€æœ‰äº¤æ˜“ï¼ˆåŒ…æ‹¬time_exitï¼‰
all_trades = captured  # åŒ…æ‹¬time_exit
time_exit_penalty = max(0, (time_exit_ratio - 0.5) * 0.5)

# é˜¶æ®µ4ï¼šåªç»Ÿè®¡TP/SL
baseline_trades = [o for o in baseline_opps_updated 
                 if o.get('exit_reason') in ['tp', 'sl']]
```

#### **å½±å“**

1. **ç»Ÿè®¡å£å¾„ä¸ä¸€è‡´**
   - é˜¶æ®µ3ä¼˜åŒ–å™¨ï¼šè€ƒè™‘æ‰€æœ‰äº¤æ˜“
   - é˜¶æ®µ4éªŒè¯ï¼šåªè€ƒè™‘TP/SLäº¤æ˜“
   - **ç»“æœ**ï¼šé˜¶æ®µ4çš„ç»Ÿè®¡ä¸èƒ½çœŸå®åæ˜ é˜¶æ®µ3çš„ä¼˜åŒ–æ•ˆæœ

2. **è¯¯å¯¼æ€§å¯¹æ¯”**
   ```python
   # å‡è®¾åœºæ™¯
   é…ç½®Aï¼š10ç¬”TP/SLï¼ˆå¹³å‡åˆ©æ¶¦2%ï¼‰+ 90ç¬”time_exitï¼ˆå¹³å‡åˆ©æ¶¦-0.5%ï¼‰
   
   é˜¶æ®µ3è¯„åˆ†ï¼š
     - ç»Ÿè®¡æ‰€æœ‰100ç¬”
     - å¹³å‡åˆ©æ¶¦ = (10*2% + 90*-0.5%) / 100 = -0.25%
     - time_exitæƒ©ç½šï¼š(0.9-0.5)*0.5 = 0.2
     - å¾—åˆ†ï¼šä½
   
   é˜¶æ®µ4ç»Ÿè®¡ï¼š
     - åªç»Ÿè®¡10ç¬”TP/SL
     - å¹³å‡åˆ©æ¶¦ = 2%  â† çœ‹èµ·æ¥å¾ˆå¥½ï¼
     - **è¯¯å¯¼**ï¼šå®é™…æ•´ä½“æ˜¯äºæŸçš„
   ```

#### **å»ºè®®ä¿®å¤**

```python
# ã€V8.4.5ä¿®å¤ã€‘ç»Ÿè®¡æ‰€æœ‰äº¤æ˜“ï¼Œä¸é˜¶æ®µ3ä¸€è‡´
baseline_all_trades = baseline_opps_updated
optimized_all_trades = optimized_opps_updated

# è®¡ç®—time_exitæ¯”ä¾‹
baseline_time_exit_ratio = sum(1 for o in baseline_all_trades 
                               if o.get('exit_reason') == 'time_exit') / len(baseline_all_trades)
optimized_time_exit_ratio = sum(1 for o in optimized_all_trades 
                                if o.get('exit_reason') == 'time_exit') / len(optimized_all_trades)

baseline_result = {
    'captured_count': len(baseline_all_trades),
    'avg_profit': sum(o.get('actual_profit_pct', 0) for o in baseline_all_trades) / len(baseline_all_trades),
    'time_exit_ratio': baseline_time_exit_ratio,
    'capture_rate': len(baseline_all_trades) / len(opportunities)
}

optimized_result = {
    'captured_count': len(optimized_all_trades),
    'avg_profit': sum(o.get('actual_profit_pct', 0) for o in optimized_all_trades) / len(optimized_all_trades),
    'time_exit_ratio': optimized_time_exit_ratio,
    'capture_rate': len(optimized_all_trades) / len(opportunities)
}
```

---

### **é—®é¢˜2ï¼šé˜¶æ®µ5ç¼ºå°‘éªŒè¯æœŸæµ‹è¯•çš„å†³ç­–é€»è¾‘** ğŸŸ¡

#### **å½“å‰å®ç°**

```python
# ç›´æ¥åº”ç”¨ä¼˜åŒ–åçš„å‚æ•°ï¼Œæ²¡æœ‰æ£€æŸ¥éªŒè¯æœŸè¡¨ç°
if scalping_optimization.get('improvement') is not None:
    config['scalping_params'].update(scalping_optimization['optimized_params'])
```

#### **é—®é¢˜**

è™½ç„¶V8.4.5åœ¨ç¬¬8537-8611è¡Œæ·»åŠ äº†éªŒè¯æœŸæµ‹è¯•ï¼Œä½†**å†³ç­–é€»è¾‘æ˜¯ç›´æ¥ä¿®æ”¹config**ï¼Œæ²¡æœ‰ä¸é˜¶æ®µ5çš„åº”ç”¨é€»è¾‘é›†æˆã€‚

#### **å½“å‰æµç¨‹**

```
é˜¶æ®µ3ä¼˜åŒ– â†’ é˜¶æ®µ4éªŒè¯ â†’ V8.4.5éªŒè¯æœŸæµ‹è¯•ï¼ˆä¿®æ”¹configï¼‰â†’ é˜¶æ®µ5åº”ç”¨ï¼ˆå†æ¬¡ä¿®æ”¹configï¼‰
                                    â†‘
                                 å¯èƒ½è¢«è¦†ç›–
```

#### **æ½œåœ¨é—®é¢˜**

1. éªŒè¯æœŸå†³ç­–åœ¨ç¬¬8537-8611è¡Œ
2. é˜¶æ®µ5åº”ç”¨åœ¨ç¬¬8481-8525è¡Œ
3. å¦‚æœéªŒè¯æœŸæµ‹è¯•å›é€€åˆ°ä¿å®ˆå‚æ•°ï¼Œä½†é˜¶æ®µ5åˆåº”ç”¨äº†ä¼˜åŒ–åçš„å‚æ•°ï¼Œä¼šäº§ç”Ÿå†²çª

#### **å»ºè®®ä¿®å¤**

```python
# ã€V8.4.5ä¿®å¤ã€‘åœ¨åº”ç”¨å‚æ•°å‰ï¼Œæ£€æŸ¥æ˜¯å¦å·²è¢«éªŒè¯æœŸæµ‹è¯•ä¿®æ”¹
if scalping_optimization.get('improvement') is not None:
    # æ£€æŸ¥éªŒè¯æœŸæ˜¯å¦å·²å›é€€åˆ°ä¿å®ˆå‚æ•°
    if config.get('scalping_params', {}).get('atr_tp_multiplier') == 2.0 and \
       config.get('scalping_params', {}).get('_validation_rollback') == True:
        print(f"  âš ï¸  éªŒè¯æœŸå·²å›é€€åˆ°ä¿å®ˆå‚æ•°ï¼Œè·³è¿‡åº”ç”¨ä¼˜åŒ–åçš„å‚æ•°")
    else:
        config['scalping_params'].update(scalping_optimization['optimized_params'])
        print(f"  âœ… è¶…çŸ­çº¿ä¼˜åŒ–å®Œæˆ:")
        ...
```

---

### **é—®é¢˜3ï¼šé˜¶æ®µ4ç¼ºå°‘æ•è·ç‡çš„å¯¹æ¯”** ğŸŸ¡

#### **å½“å‰å®ç°**

```python
# è¶…çŸ­çº¿ï¼šåªæ˜¾ç¤ºtime_exitç‡å’Œå¹³å‡åˆ©æ¶¦
print(f"     time_exitç‡: {old_rate*100:.0f}% â†’ {new_rate*100:.0f}%")
print(f"     å¹³å‡åˆ©æ¶¦: {old_profit:.1f}% â†’ {new_profit:.1f}%")

# æ³¢æ®µï¼šæ˜¾ç¤ºå¹³å‡åˆ©æ¶¦å’Œæ•è·ç‡
print(f"     å¹³å‡åˆ©æ¶¦: {old_profit:.1f}% â†’ {new_profit:.1f}%")
print(f"     æ•è·ç‡: {old_capture*100:.0f}% â†’ {new_capture*100:.0f}%")
```

#### **é—®é¢˜**

è¶…çŸ­çº¿å’Œæ³¢æ®µçš„å¯¹æ¯”æŒ‡æ ‡ä¸ä¸€è‡´ï¼š
- è¶…çŸ­çº¿ï¼štime_exitç‡ + å¹³å‡åˆ©æ¶¦
- æ³¢æ®µï¼šå¹³å‡åˆ©æ¶¦ + æ•è·ç‡

**ä½†æ•è·ç‡æ˜¯V8.4.5æœ€é‡è¦çš„æŒ‡æ ‡ï¼ˆ25%æƒé‡ï¼‰ï¼**

#### **å»ºè®®ä¿®å¤**

```python
# ã€V8.4.5ä¿®å¤ã€‘ç»Ÿä¸€æ˜¾ç¤ºæ•è·ç‡
print(f"  âœ… è¶…çŸ­çº¿ä¼˜åŒ–å®Œæˆ:")
print(f"     æ•è·ç‡: {old_capture*100:.0f}% â†’ {new_capture*100:.0f}%")
print(f"     å¹³å‡åˆ©æ¶¦: {old_profit:.1f}% â†’ {new_profit:.1f}%")
print(f"     time_exitç‡: {old_time_exit*100:.0f}% â†’ {new_time_exit*100:.0f}%")

print(f"  âœ… æ³¢æ®µä¼˜åŒ–å®Œæˆ:")
print(f"     æ•è·ç‡: {old_capture*100:.0f}% â†’ {new_capture*100:.0f}%")
print(f"     å¹³å‡åˆ©æ¶¦: {old_profit:.1f}% â†’ {new_profit:.1f}%")
print(f"     time_exitç‡: {old_time_exit*100:.0f}% â†’ {new_time_exit*100:.0f}%")
```

---

### **é—®é¢˜4ï¼šé˜¶æ®µ5ç¼ºå°‘å‚æ•°åˆç†æ€§æ£€æŸ¥** ğŸŸ¡

#### **å½“å‰å®ç°**

```python
# ç›´æ¥æ›´æ–°ï¼Œä¸æ£€æŸ¥å‚æ•°æ˜¯å¦åˆç†
config['scalping_params'].update(scalping_optimization['optimized_params'])
```

#### **é—®é¢˜**

å¦‚æœä¼˜åŒ–å™¨è¿”å›äº†ä¸åˆç†çš„å‚æ•°ï¼ˆå¦‚atr_tp_multiplier=6.0ï¼‰ï¼Œä¼šç›´æ¥åº”ç”¨åˆ°é…ç½®æ–‡ä»¶ã€‚

è™½ç„¶V8.4.4æ·»åŠ äº†åŠ¨æ€èŒƒå›´çº¦æŸï¼Œä½†ä½œä¸ºæœ€åä¸€é“é˜²çº¿ï¼Œé˜¶æ®µ5åº”è¯¥æœ‰å‚æ•°åˆç†æ€§æ£€æŸ¥ã€‚

#### **å»ºè®®ä¿®å¤**

```python
# ã€V8.4.5ä¿®å¤ã€‘åº”ç”¨å‰æ£€æŸ¥å‚æ•°åˆç†æ€§
def validate_params(params, signal_type):
    """æ£€æŸ¥å‚æ•°æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…"""
    if signal_type == 'scalping':
        bounds = {
            'atr_tp_multiplier': (1.0, 3.0),
            'atr_stop_multiplier': (1.0, 2.0),
            'max_holding_hours': (4, 16)
        }
    else:  # swing
        bounds = {
            'atr_tp_multiplier': (2.0, 5.0),
            'atr_stop_multiplier': (1.0, 2.5),
            'max_holding_hours': (36, 96)
        }
    
    for key, (min_val, max_val) in bounds.items():
        if key in params:
            if params[key] < min_val or params[key] > max_val:
                print(f"  âš ï¸  å‚æ•°{key}={params[key]}è¶…å‡ºåˆç†èŒƒå›´[{min_val}, {max_val}]ï¼Œä½¿ç”¨é»˜è®¤å€¼")
                params[key] = (min_val + max_val) / 2
    
    return params

# åº”ç”¨å‰éªŒè¯
if scalping_optimization.get('improvement') is not None:
    optimized_params = validate_params(
        scalping_optimization['optimized_params'], 
        'scalping'
    )
    config['scalping_params'].update(optimized_params)
```

---

## ğŸ“Š é—®é¢˜ä¼˜å…ˆçº§

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | ä¼˜å…ˆçº§ | å½±å“ |
|-----|---------|--------|------|
| **é—®é¢˜1ï¼šé˜¶æ®µ4ç»Ÿè®¡å£å¾„ä¸ä¸€è‡´** | ğŸ”´ é«˜ | P0 | éªŒè¯ç»“æœä¸å‡†ç¡® |
| **é—®é¢˜2ï¼šéªŒè¯æœŸå†³ç­–å¯èƒ½è¢«è¦†ç›–** | ğŸŸ¡ ä¸­ | P1 | å¯èƒ½åº”ç”¨é”™è¯¯å‚æ•° |
| **é—®é¢˜3ï¼šè¶…çŸ­çº¿ç¼ºå°‘æ•è·ç‡å¯¹æ¯”** | ğŸŸ¡ ä¸­ | P2 | æ—¥å¿—ä¸å®Œæ•´ |
| **é—®é¢˜4ï¼šç¼ºå°‘å‚æ•°åˆç†æ€§æ£€æŸ¥** | ğŸŸ¡ ä¸­ | P2 | æœ€åé˜²çº¿ç¼ºå¤± |

---

## âœ… å»ºè®®çš„ä¿®å¤æ–¹æ¡ˆ

### **ä¿®å¤1ï¼šç»Ÿä¸€é˜¶æ®µ4çš„ç»Ÿè®¡å£å¾„ï¼ˆP0ï¼‰**

**ä¿®æ”¹æ–‡ä»¶**ï¼š`ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆç¬¬20407-20423è¡Œï¼‰

```python
# ã€V8.4.5ä¿®å¤ã€‘ç»Ÿè®¡æ‰€æœ‰äº¤æ˜“ï¼Œä¸é˜¶æ®µ3ä¸€è‡´
baseline_all_trades = baseline_opps_updated
optimized_all_trades = optimized_opps_updated

# è®¡ç®—å„é¡¹æŒ‡æ ‡
baseline_time_exit_count = sum(1 for o in baseline_all_trades if o.get('exit_reason') == 'time_exit')
optimized_time_exit_count = sum(1 for o in optimized_all_trades if o.get('exit_reason') == 'time_exit')

baseline_result = {
    'captured_count': len(baseline_all_trades),
    'avg_profit': sum(o.get('actual_profit_pct', 0) for o in baseline_all_trades) / len(baseline_all_trades) if baseline_all_trades else 0,
    'time_exit_count': baseline_time_exit_count,
    'time_exit_ratio': baseline_time_exit_count / len(baseline_all_trades) if baseline_all_trades else 0,
    'capture_rate': len(baseline_all_trades) / len(opportunities) if opportunities else 0
}

optimized_result = {
    'captured_count': len(optimized_all_trades),
    'avg_profit': sum(o.get('actual_profit_pct', 0) for o in optimized_all_trades) / len(optimized_all_trades) if optimized_all_trades else 0,
    'time_exit_count': optimized_time_exit_count,
    'time_exit_ratio': optimized_time_exit_count / len(optimized_all_trades) if optimized_all_trades else 0,
    'capture_rate': len(optimized_all_trades) / len(opportunities) if opportunities else 0
}
```

### **ä¿®å¤2ï¼šæ·»åŠ éªŒè¯æœŸå†³ç­–æ ‡è®°ï¼ˆP1ï¼‰**

**ä¿®æ”¹æ–‡ä»¶**ï¼š`ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆç¬¬8562-8574è¡Œï¼‰

```python
# åœ¨éªŒè¯æœŸå›é€€åˆ°ä¿å®ˆå‚æ•°æ—¶ï¼Œæ·»åŠ æ ‡è®°
if val_avg_profit < -1.0:
    print(f"       âš ï¸  éªŒè¯æœŸäºæŸä¸¥é‡ï¼Œå›é€€åˆ°ä¿å®ˆå‚æ•°")
    config['scalping_params'] = {
        'atr_tp_multiplier': 2.0,
        'atr_stop_multiplier': 1.5,
        'max_holding_hours': 12,
        'min_risk_reward': 1.5,
        'min_signal_score': 50,
        '_validation_rollback': True  # ã€V8.4.5æ–°å¢ã€‘æ ‡è®°å·²å›é€€
    }
```

### **ä¿®å¤3ï¼šç»Ÿä¸€æ˜¾ç¤ºæ•è·ç‡ï¼ˆP2ï¼‰**

**ä¿®æ”¹æ–‡ä»¶**ï¼š`ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆç¬¬8500-8502è¡Œï¼‰

```python
print(f"  âœ… è¶…çŸ­çº¿ä¼˜åŒ–å®Œæˆ:")
print(f"     æ•è·ç‡: {old_capture*100:.0f}% â†’ {new_capture*100:.0f}%")
print(f"     å¹³å‡åˆ©æ¶¦: {old_profit:.1f}% â†’ {new_profit:.1f}%")
print(f"     time_exitç‡: {old_rate*100:.0f}% â†’ {new_rate*100:.0f}%")
```

### **ä¿®å¤4ï¼šæ·»åŠ å‚æ•°åˆç†æ€§æ£€æŸ¥ï¼ˆP2ï¼‰**

**æ–°å¢å‡½æ•°**ï¼š`ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`

```python
def validate_strategy_params(params, signal_type):
    """
    ã€V8.4.5ã€‘éªŒè¯ç­–ç•¥å‚æ•°çš„åˆç†æ€§
    
    ä½œä¸ºæœ€åä¸€é“é˜²çº¿ï¼Œç¡®ä¿ä¸ä¼šåº”ç”¨æç«¯å‚æ•°
    """
    if signal_type == 'scalping':
        bounds = {
            'atr_tp_multiplier': (1.0, 3.0),
            'atr_stop_multiplier': (1.0, 2.0),
            'max_holding_hours': (4, 16),
            'min_risk_reward': (0.8, 2.5)
        }
    else:  # swing
        bounds = {
            'atr_tp_multiplier': (2.0, 5.0),
            'atr_stop_multiplier': (1.0, 2.5),
            'max_holding_hours': (36, 96),
            'min_risk_reward': (0.8, 3.0)
        }
    
    validated_params = params.copy()
    has_invalid = False
    
    for key, (min_val, max_val) in bounds.items():
        if key in validated_params:
            if validated_params[key] < min_val or validated_params[key] > max_val:
                print(f"  âš ï¸  å‚æ•°{key}={validated_params[key]}è¶…å‡ºåˆç†èŒƒå›´[{min_val}, {max_val}]")
                validated_params[key] = (min_val + max_val) / 2
                print(f"      å·²ä¿®æ­£ä¸ºé»˜è®¤å€¼: {validated_params[key]}")
                has_invalid = True
    
    if has_invalid:
        print(f"  âš ï¸  æ£€æµ‹åˆ°ä¸åˆç†å‚æ•°ï¼Œå·²è‡ªåŠ¨ä¿®æ­£")
    
    return validated_params
```

---

## ğŸ¯ ä¿®å¤åçš„é¢„æœŸæ•ˆæœ

### **é˜¶æ®µ4ï¼ˆç»“æœéªŒè¯ï¼‰**

```bash
ğŸ“Š è®¡ç®—å‰åå¯¹æ¯”ï¼ˆä½¿ç”¨çœŸå®åˆ©æ¶¦ï¼‰...
   è®¡ç®—baselineï¼ˆå½“å‰å‚æ•°ï¼‰...
   âœ… å®é™…åˆ©æ¶¦è®¡ç®—å®Œæˆ: 2000ä¸ªæœºä¼š

   è®¡ç®—optimizedï¼ˆæ–°å‚æ•°ï¼‰...
   âœ… å®é™…åˆ©æ¶¦è®¡ç®—å®Œæˆ: 2000ä¸ªæœºä¼š

âœ… è¶…çŸ­çº¿ä¼˜åŒ–å®Œæˆ:
   æ•è·ç‡: 45% â†’ 68% (+23%)        # æ–°å¢æ˜¾ç¤º
   å¹³å‡åˆ©æ¶¦: 0.5% â†’ 1.8% (+1.3%)
   time_exitç‡: 78% â†’ 32% (-46%)
```

### **é˜¶æ®µ5ï¼ˆåº”ç”¨å‚æ•°ï¼‰**

```bash
# åœºæ™¯1ï¼šéªŒè¯æœŸé€šè¿‡
ğŸ” ã€V8.4.5å‰å‘éªŒè¯ã€‘åœ¨éªŒè¯æœŸæµ‹è¯•ä¼˜åŒ–åçš„å‚æ•°...
   è¶…çŸ­çº¿éªŒè¯æœŸè¡¨ç°:
     å¹³å‡åˆ©æ¶¦: 1.5%
     æ•è·ç‡: 65.0%
     âœ… éªŒè¯æœŸè¡¨ç°è‰¯å¥½ï¼Œä½¿ç”¨ä¼˜åŒ–åçš„å‚æ•°

âœ… è¶…çŸ­çº¿ä¼˜åŒ–å®Œæˆ:  # åº”ç”¨é˜¶æ®µ
   æ•è·ç‡: 45% â†’ 68% (+23%)
   å¹³å‡åˆ©æ¶¦: 0.5% â†’ 1.8% (+1.3%)

# åœºæ™¯2ï¼šéªŒè¯æœŸå¤±è´¥
ğŸ” ã€V8.4.5å‰å‘éªŒè¯ã€‘åœ¨éªŒè¯æœŸæµ‹è¯•ä¼˜åŒ–åçš„å‚æ•°...
   è¶…çŸ­çº¿éªŒè¯æœŸè¡¨ç°:
     å¹³å‡åˆ©æ¶¦: -1.5%
     æ•è·ç‡: 70.0%
     âš ï¸  éªŒè¯æœŸäºæŸä¸¥é‡ï¼Œå›é€€åˆ°ä¿å®ˆå‚æ•°

â­ï¸  è·³è¿‡åº”ç”¨ä¼˜åŒ–åçš„å‚æ•°ï¼ˆéªŒè¯æœŸå·²å›é€€ï¼‰  # åº”ç”¨é˜¶æ®µ
```

---

## âœ… æ€»ç»“

### **å‘ç°çš„é—®é¢˜**

1. âœ… **é˜¶æ®µ4ç»Ÿè®¡å£å¾„ä¸ä¸€è‡´**ï¼ˆP0ï¼‰ï¼šåªç»Ÿè®¡TP/SLï¼Œæ’é™¤time_exit
2. âœ… **éªŒè¯æœŸå†³ç­–å¯èƒ½è¢«è¦†ç›–**ï¼ˆP1ï¼‰ï¼šç¼ºå°‘æ ‡è®°å’Œæ£€æŸ¥
3. âœ… **è¶…çŸ­çº¿ç¼ºå°‘æ•è·ç‡å¯¹æ¯”**ï¼ˆP2ï¼‰ï¼šæ—¥å¿—ä¸å®Œæ•´
4. âœ… **ç¼ºå°‘å‚æ•°åˆç†æ€§æ£€æŸ¥**ï¼ˆP2ï¼‰ï¼šæœ€åé˜²çº¿ç¼ºå¤±

### **å»ºè®®ä¿®å¤**

- **ä¿®å¤1**ï¼šç»Ÿä¸€é˜¶æ®µ4çš„ç»Ÿè®¡å£å¾„ï¼ˆP0ï¼‰
- **ä¿®å¤2**ï¼šæ·»åŠ éªŒè¯æœŸå†³ç­–æ ‡è®°ï¼ˆP1ï¼‰
- **ä¿®å¤3**ï¼šç»Ÿä¸€æ˜¾ç¤ºæ•è·ç‡ï¼ˆP2ï¼‰
- **ä¿®å¤4**ï¼šæ·»åŠ å‚æ•°åˆç†æ€§æ£€æŸ¥ï¼ˆP2ï¼‰

### **ä¿®å¤ä¼˜å…ˆçº§**

**P0ï¼ˆç«‹å³ä¿®å¤ï¼‰**ï¼šé—®é¢˜1 - é˜¶æ®µ4ç»Ÿè®¡å£å¾„ä¸ä¸€è‡´

**P1ï¼ˆé‡è¦ï¼‰**ï¼šé—®é¢˜2 - éªŒè¯æœŸå†³ç­–å¯èƒ½è¢«è¦†ç›–

**P2ï¼ˆä¼˜åŒ–ï¼‰**ï¼šé—®é¢˜3å’Œé—®é¢˜4 - æ—¥å¿—æ”¹è¿›å’Œå‚æ•°æ£€æŸ¥

---

**æ—¥æœŸ**: 2025-11-14  
**ç‰ˆæœ¬**: V8.4.5  
**çŠ¶æ€**: ğŸ” å¾…ä¿®å¤ï¼ˆ4ä¸ªé—®é¢˜ï¼‰  
**ä¼˜å…ˆçº§**: P0ï¼ˆ1ä¸ªï¼‰+ P1ï¼ˆ1ä¸ªï¼‰+ P2ï¼ˆ2ä¸ªï¼‰

