═══════════════════════════════════════════════════
V8.2.6.7 终极修复 - 立即部署指令
═══════════════════════════════════════════════════

修复内容（完整版本历史）：
1. ✅ V8.2.6.4: AI不测试 consensus=1
2. ✅ V8.2.6.5: 波段 min_risk_reward: 3.0 → 2.0
3. ✅ V8.2.6.6: 同一时间点生成独立机会
4. 🔴 V8.2.6.7: 基于"达到目标时间"分类（终极修复）

核心改进（V8.2.6.7）：
  - 之前：看时间窗口内是否达到目标（1小时内是否≥1.5%）
  - 现在：看达到目标所需的时间（达到1.5%用了多少分钟）
  
  示例：入场后45分钟达到1.5%，2小时达到3%
  - 旧逻辑：超短线+波段（重复计数）
  - 新逻辑：只是超短线（更准确）✅

用户发现的问题：
  ❌ 很多单子"波段入场、1小时平仓"（不匹配）
  ✅ 应该看"达到目标的时间"，而非"时间窗口"

预期效果：
  - ⚡ 超短线机会：700-1000个
  - 🌊 波段机会：3000-4000个（去除假波段）
  - ⚡ 超短线捕捉率：75-80%
  - 🌊 波段捕捉率：30-50%（提高）
  - 🎯 交易匹配度：优秀（不再出现波段1小时平仓）

═══════════════════════════════════════════════════
【步骤1】本地Mac - 上传新代码
═══════════════════════════════════════════════════

cd ~/Downloads/10-23-bot/ds
scp deepseek_多币种智能版.py admin@服务器IP:/home/admin/10-23-bot/ds/
scp qwen_多币种智能版.py admin@服务器IP:/home/admin/10-23-bot/ds/

═══════════════════════════════════════════════════
【步骤2】SSH到服务器 - 清理旧配置
═══════════════════════════════════════════════════

cd ~/10-23-bot/ds

# 删除旧配置（让AI使用新的默认值）
rm -f trading_data/deepseek/learning_config.json
rm -f trading_data/qwen/learning_config.json

echo "✅ 已清理旧配置"

═══════════════════════════════════════════════════
【步骤3】重启AI
═══════════════════════════════════════════════════

ps aux | grep '多币种智能版.py' | grep -v grep | awk '{print $2}' | xargs -r kill -9
nohup venv/bin/python deepseek_多币种智能版.py > logs/deepseek_trading.log 2>&1 &
nohup venv/bin/python qwen_多币种智能版.py > logs/qwen_trading.log 2>&1 &
ps aux | grep '多币种智能版.py' | grep -v grep

═══════════════════════════════════════════════════
【步骤4】验证（明天早上2025-11-08 08:05）
═══════════════════════════════════════════════════

检查邮件报告：

预期结果（V8.2.6.7）：
  ✅ 机会数量：
     - 超短线：700-1000个（比V8.2.6.6略高）
     - 波段：3000-4000个（比V8.2.6.6略低）
  
  ✅ 捕捉率：
     - 超短线：75-80%
     - 波段：30-50%（比V8.2.6.6略高）
  
  ✅ 交易匹配度（最重要！）：
     - 波段交易的实际持仓时间：主要在6小时以上
     - 超短线交易的实际持仓时间：主要在2小时以内
     - ❌ 不再出现"波段入场、1小时平仓"的情况

═══════════════════════════════════════════════════
【关键改进】基于时间的分类逻辑
═══════════════════════════════════════════════════

旧逻辑（V8.2.6.6）：
```
看1小时内最高价是否≥1.5% → 是 → 超短线
看24小时内最高价是否≥3% → 是 → 波段
```

问题：
- 45分钟达到1.5%，2小时达到3%
- 被同时归类为超短线+波段（重复）
- AI判断为波段，但1小时就平仓了（不匹配）

新逻辑（V8.2.6.7）：
```
找到达到1.5%的时间点 → 45分钟
找到达到3%的时间点 → 120分钟

判断：
- 45分钟 <= 60分钟 → 超短线 ✅
- 120分钟 > 60分钟 → （本应是波段，但已归类为超短线）
```

效果：
- 只归类为超短线（更准确）
- AI使用超短线参数（匹配实际持仓时间）
- 数据更科学，统计更准确

═══════════════════════════════════════════════════
部署完成！ 等待明天早上验证结果
═══════════════════════════════════════════════════

