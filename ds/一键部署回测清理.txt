━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
一键部署 + 清理 + 回测（完整流程）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🚨 重要：必须按顺序执行！

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【步骤 1/4】拉取最新代码并清理
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# 在服务器执行
cd /root/10-23-bot && git pull origin main

# 清理服务器临时文件
cd ds && bash 清理服务器临时文件.sh

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【步骤 2/4】测试导入（验证语法）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# 测试 DeepSeek
python3 -c "from ds.deepseek_多币种智能版 import calculate_signal_score; print('✅ DeepSeek导入成功')"

# 测试 Qwen
python3 -c "from ds.qwen_多币种智能版 import calculate_signal_score; print('✅ Qwen导入成功')"

# 测试历史数据生成（验证语法修复）
cd ds && python3 export_historical_data.py 20251111

# 预期输出：
# ✓ 20251111市场快照已保存: XXX条记录
# ✓ 导出完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【步骤 3/4】重启 AI（使用新代码）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

supervisorctl restart deepseek qwen

# 等待5秒，检查状态
sleep 5 && supervisorctl status

# 预期输出：
# deepseek                         RUNNING   pid XXXX, uptime 0:00:05
# qwen                             RUNNING   pid XXXX, uptime 0:00:05
# web                              RUNNING   pid XXXX, uptime X:XX:XX

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【步骤 4/4】运行手动回测
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

cd /root/10-23-bot/ds && bash 手动回测.sh

# 预期输出（V8.3.21）：
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# V8.3.21 手动回测
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#
# 🚀 【V8.3.21】使用增强优化器（XXX个机会）
#    • 11维度参数搜索
#    • 4层上下文过滤
#    • 成本优化（节省89%）
#
# ✅ V8.3.21优化完成
#    最优分数: X.XXX
#    捕获率: XX%
#    平均利润: X.X%
#    胜率: XX%
#    💰 成本节省: $X.XXXX

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️  如果出现问题：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. AI启动失败：
   # 查看 DeepSeek 日志
   tail -50 /root/10-23-bot/ds/trading_data/deepseek/ai_trading.log
   
   # 查看 Qwen 日志
   tail -50 /root/10-23-bot/ds/trading_data/qwen/ai_trading.log

2. 回测失败：
   # 检查是否有报错
   # 确保两个AI都是RUNNING状态

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 本地清理（可选）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# 在本地执行
cd /Users/mac-bauyu/Downloads/10-23-bot/ds
bash 清理临时文件.sh

# 提交清理后的代码
git add -A
git commit -m "清理临时文件和文档"
git push origin main

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 完成后的文件结构：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ds/
├── deepseek_多币种智能版.py          # DeepSeek主程序
├── qwen_多币种智能版.py              # Qwen主程序
├── backtest_optimizer_v8321.py       # V8.3.21优化器
├── export_historical_data.py         # 历史数据导出
├── fix_timezone_data.py              # 时区修复工具
├── requirements.txt                  # 依赖列表
├── ai_trading_web.py                 # Web界面
├── 手动回测.sh                       # 手动回测脚本
├── 安装所有依赖.sh                   # 依赖安装脚本
├── .env                              # DeepSeek配置
├── .env.qwen                         # Qwen配置
└── trading_data/                     # 交易数据目录

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 说明：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 保留的核心文件：
   - 两个主程序（deepseek + qwen）
   - V8.3.21回测优化器
   - 历史数据导出工具
   - 时区修复工具
   - 手动回测脚本
   - 依赖安装脚本
   - 配置文件

🗑️ 删除的文件：
   - 所有 V8.3.21_*.md 文档（50+ 个）
   - 所有临时说明文件（立即*.txt）
   - 所有临时脚本（检查*.sh, 修复*.sh等）
   - expect脚本、patch文件等

📦 节省空间：约 5-10 MB

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

