# V8.5.2.4.69 - Phase 3åˆ©æ¶¦è®¡ç®—ä¿®å¤

**æ—¥æœŸ**: 2025-11-19  
**ç±»å‹**: Bugä¿®å¤ï¼ˆä¸¥é‡ï¼‰  
**å½±å“**: Phase 3, Phase 4

---

## é—®é¢˜è¯Šæ–­

### V8.5.2.4.68å›æµ‹ç»“æœåˆ†æ

```
âœ… Phase 2è¡¨ç°ä¼˜ç§€:
- TP/SLæµ‹è¯•: è¶…çŸ­çº¿TP=19.5, SL=1.5 â†’ åˆ©æ¶¦11.86%
              æ³¢æ®µTP=22.1, SL=2.5 â†’ åˆ©æ¶¦13.28%
- å‚æ•°ç»„åˆ: æ•è·62.2%, åˆ©æ¶¦6.50%, å¾—åˆ†4219 âœ…

âŒ Phase 3å¤±è´¥:
- è¶…çŸ­çº¿: æ•è·ç‡1.5%, å¹³å‡åˆ©æ¶¦-1.67% âŒ
- æ³¢æ®µ: æ•è·ç‡41.0%, å¹³å‡åˆ©æ¶¦-1.89% âŒ

âŒ Phase 4å›é€€åä¿å­˜äº†é”™è¯¯å‚æ•°:
- atr_tp_multiplier: 0.00   â† åº”è¯¥æ˜¯19.5/22.1
- atr_stop_multiplier: 0.00 â† åº”è¯¥æ˜¯1.5/2.5
- max_holding_hours: 0      â† åº”è¯¥æ˜¯3.7/17.2
```

---

## æ ¹æœ¬åŸå› 

### Bug 1: Phase 3ä½¿ç”¨äº†é”™è¯¯çš„åˆ©æ¶¦è®¡ç®—å‡½æ•°

**é—®é¢˜ä»£ç ** (`phase3_enhanced_optimizer.py` ç¬¬614è¡Œ):

```python
# é”™è¯¯ï¼šä½¿ç”¨batch_calculate_profits
from trailing_stop_calculator import batch_calculate_profits
profit_results = batch_calculate_profits(filtered_opps, params)
                 â†“ æ²¡æœ‰ä¼ å…¥future_data_dict
                 â†“ future_data = None
                 â†“ èµ°åˆ°_calculate_with_max_profitï¼ˆæ¨¡æ‹Ÿé€»è¾‘ï¼‰
                 â†“ æ²¡æœ‰ä½¿ç”¨V8.5.2.4.65çš„æ³¢åŠ¨å¹…åº¦ä¿®å¤ï¼
```

**`_calculate_with_max_profit`çš„é—®é¢˜**:

```python
def _calculate_with_max_profit(opportunity, ...):
    max_potential_profit = opportunity.get('max_potential_profit', 0)
    max_price = entry_price * (1 + max_potential_profit / 100)
    
    # ç®€å•åˆ¤æ–­ï¼šå¦‚æœmax_price >= TPï¼Œå°±è¿”å›TPåˆ©æ¶¦
    if max_price >= initial_tp:
        return (initial_tp - entry_price) / entry_price * 100, 'take_profit'
```

âŒ **æ²¡æœ‰è€ƒè™‘**:
1. åŒæ—¶è§¦å‘TP/SLæ—¶çš„æ³¢åŠ¨å¹…åº¦åˆ¤æ–­ï¼ˆV8.5.2.4.65ä¿®å¤ï¼‰
2. çœŸå®Kçº¿æ—¶åºæ•°æ®
3. åªç”¨äº†`max_potential_profit`è¿™ä¸ªç®€åŒ–å€¼

**æ­£ç¡®çš„åšæ³•**ï¼šä½¿ç”¨`calculate_actual_profit_batch`

```python
from calculate_actual_profit import calculate_actual_profit_batch
profit_results = calculate_actual_profit_batch(
    filtered_opps, params, 
    use_dynamic_atr=True, 
    include_trading_costs=True
)
â†“ ä½¿ç”¨future_data
â†“ ä½¿ç”¨V8.5.2.4.65çš„æ³¢åŠ¨å¹…åº¦åˆ¤æ–­
â†“ æ­£ç¡®è®¡ç®—åˆ©æ¶¦
```

---

### Bug 2: Phase 4å›é€€æ—¶ä¿å­˜äº†ä¸å®Œæ•´çš„å‚æ•°

**é—®é¢˜ä»£ç ** (`deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py` ç¬¬7546è¡Œ):

```python
# Phase 2å‚æ•°ç»„åˆæµ‹è¯•
best_params = test_params.copy()  # â† åªæœ‰R:R, consensus, signal_score
                                   # â† æ²¡æœ‰atr_tp_multiplierå’Œatr_stop_multiplierï¼

# ç¬¬7695è¡Œï¼šç”ŸæˆPhase 2 baseline
phase2_baseline = {
    'params': best_params.copy(),  # â† ä¿å­˜çš„paramsç¼ºå°‘TP/SLå‚æ•°
    ...
}

# Phase 4å›é€€æ—¶
config['scalping_params'] = phase2_baseline['params'].copy()  # â† å¾—åˆ°äº†ä¸å®Œæ•´çš„å‚æ•°
â†“ atr_tp_multiplier = 0.00ï¼ˆç¼ºå¤±ï¼Œé»˜è®¤0ï¼‰
â†“ atr_stop_multiplier = 0.00ï¼ˆç¼ºå¤±ï¼Œé»˜è®¤0ï¼‰
```

**æ ¹æœ¬åŸå› **ï¼š
- `best_params`æ¥è‡ªå‚æ•°ç»„åˆæµ‹è¯•ï¼Œä¸åŒ…å«TP/SL
- Phase 2çš„TP/SLä¿å­˜åœ¨`learned_features['optimal_tp_sl']`ä¸­
- Phase 2 baselineä¿å­˜æ—¶ï¼Œæ²¡æœ‰å°†TP/SLåˆå¹¶åˆ°`params`ä¸­

---

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1: Phase 3ä½¿ç”¨æ­£ç¡®çš„åˆ©æ¶¦è®¡ç®—å‡½æ•°

**é‡è¦è¯´æ˜**ï¼šqwenæ–‡ä»¶ä¸éœ€è¦æ­¤ä¿®å¤ï¼Œå› ä¸ºqwenä½¿ç”¨æ—§ç‰ˆå¤šè½®è¿­ä»£æ¨¡å¼ï¼Œæ²¡æœ‰ä½¿ç”¨`phase3_enhanced_optimizer.py`ã€‚

**æ–‡ä»¶**: `phase3_enhanced_optimizer.py`

```python
# ç¬¬614è¡Œï¼ˆä¿®æ”¹å‰ï¼‰
from trailing_stop_calculator import batch_calculate_profits

# ç¬¬614è¡Œï¼ˆä¿®æ”¹åï¼‰
# ã€V8.5.2.4.69ã€‘ä½¿ç”¨calculate_actual_profit_batchè€Œä¸æ˜¯batch_calculate_profits
# åŸå› : batch_calculate_profitsä¼šèµ°åˆ°æ¨¡æ‹Ÿé€»è¾‘_calculate_with_max_profit
#       è€Œæ²¡æœ‰ä½¿ç”¨V8.5.2.4.65çš„æ³¢åŠ¨å¹…åº¦ä¿®å¤
from calculate_actual_profit import calculate_actual_profit_batch

# ç¬¬732è¡Œï¼ˆä¿®æ”¹å‰ï¼‰
profit_results = batch_calculate_profits(filtered_opps, params)

# ç¬¬736è¡Œï¼ˆä¿®æ”¹åï¼‰
# ã€V8.5.2.4.69ã€‘ä½¿ç”¨calculate_actual_profit_batchè®¡ç®—åˆ©æ¶¦
# å®ƒä¼šä½¿ç”¨future_dataå’ŒV8.5.2.4.65çš„æ³¢åŠ¨å¹…åº¦ä¿®å¤
profit_results = calculate_actual_profit_batch(
    filtered_opps, 
    params, 
    batch_size=1000, 
    use_dynamic_atr=True, 
    include_trading_costs=True
)

# ç¬¬747è¡Œï¼ˆä¿®æ”¹å‰ï¼‰
total_profit = sum(r['profit'] for r in profit_results)

# ç¬¬747è¡Œï¼ˆä¿®æ”¹åï¼‰
total_profit = sum(r['profit_pct'] for r in profit_results)
```

**å…³é”®å˜åŒ–**:
1. å¯¼å…¥`calculate_actual_profit_batch`è€Œä¸æ˜¯`batch_calculate_profits`
2. è°ƒç”¨æ—¶ä¼ å…¥æ­£ç¡®å‚æ•°ï¼ˆ`use_dynamic_atr=True`, `include_trading_costs=True`ï¼‰
3. è¿”å›ç»“æœå­—æ®µä»`profit`æ”¹ä¸º`profit_pct`ï¼ˆ`calculate_actual_profit_batch`çš„æ ‡å‡†å­—æ®µåï¼‰

---

### ä¿®å¤2: Phase 2 baselineåŒ…å«TP/SLå‚æ•°

**æ–‡ä»¶**: `deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`, `qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`

**ä½ç½®**: deepseekç¬¬7688-7711è¡Œ, qwenç¬¬7692-7716è¡Œ

```python
# ä¿®æ”¹å‰
phase2_baseline = {
    'captured_count': len(best_captured_opps),
    'capture_rate': phase2_capture_rate,
    'avg_profit': phase2_avg_profit,
    'params': best_params.copy(),  # â† ç¼ºå°‘TP/SLå‚æ•°
    ...
}

# ä¿®æ”¹å
# ã€V8.5.2.4.69ã€‘ä¿®å¤ï¼šbest_paramséœ€è¦åŒ…å«optimal_tp_slå‚æ•°ï¼Œä¾›Phase 4å›é€€ä½¿ç”¨
phase2_params_with_tp_sl = best_params.copy()
optimal_tp_sl = test_points_meta.get('optimal_tp_sl', {})
if optimal_tp_sl:
    # åˆå¹¶è¶…çŸ­çº¿å’Œæ³¢æ®µçš„TP/SLå‚æ•°
    scalping_tp = optimal_tp_sl.get('scalping', {}).get('atr_tp_multiplier', 12.0)
    scalping_sl = optimal_tp_sl.get('scalping', {}).get('atr_stop_multiplier', 2.0)
    swing_tp = optimal_tp_sl.get('swing', {}).get('atr_tp_multiplier', 15.0)
    swing_sl = optimal_tp_sl.get('swing', {}).get('atr_stop_multiplier', 2.5)
    # ä½¿ç”¨æ³¢æ®µå‚æ•°ä½œä¸ºé»˜è®¤å€¼ï¼ˆæ›´ä¿å®ˆï¼‰
    phase2_params_with_tp_sl['atr_tp_multiplier'] = swing_tp
    phase2_params_with_tp_sl['atr_stop_multiplier'] = swing_sl
    # ä¿å­˜åˆ†ç¦»çš„å‚æ•°ä¾›Phase 3ä½¿ç”¨
    phase2_params_with_tp_sl['scalping_tp_sl'] = {'tp': scalping_tp, 'sl': scalping_sl}
    phase2_params_with_tp_sl['swing_tp_sl'] = {'tp': swing_tp, 'sl': swing_sl}

phase2_baseline = {
    'captured_count': len(best_captured_opps),
    'capture_rate': phase2_capture_rate,
    'avg_profit': phase2_avg_profit,
    'params': phase2_params_with_tp_sl,  # â† ç°åœ¨åŒ…å«TP/SLå‚æ•°
    ...
}
```

**å…³é”®å˜åŒ–**:
1. ä»`learned_features['optimal_tp_sl']`æå–è¶…çŸ­çº¿å’Œæ³¢æ®µçš„TP/SLå‚æ•°
2. å°†TP/SLå‚æ•°åˆå¹¶åˆ°`params`ä¸­ï¼ˆä½¿ç”¨æ³¢æ®µå‚æ•°ä½œä¸ºé»˜è®¤å€¼ï¼Œæ›´ä¿å®ˆï¼‰
3. åŒæ—¶ä¿å­˜åˆ†ç¦»çš„`scalping_tp_sl`å’Œ`swing_tp_sl`ä¾›Phase 3ä½¿ç”¨

---

### ä¿®å¤3: Phase 4å›é€€å®é™…æ‰§è¡Œ

**æ–‡ä»¶**: `deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`, `qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`

**ä½ç½®**: deepseekç¬¬8010-8076è¡Œ, qwenç¬¬8015-8081è¡Œ

**é—®é¢˜**ï¼šåŸä»£ç åªè®¾ç½®äº†`_phase4_rollback = True`æ ‡è®°ï¼Œä½†æ²¡æœ‰å®é™…å›é€€å‚æ•°ã€‚

```python
# ä¿®æ”¹å‰ï¼ˆç¬¬8012è¡Œï¼‰
else:
    print(f"\n  âš ï¸  Phase 4éªŒè¯å¤±è´¥ï¼ˆ{overall_status}ï¼‰ï¼Œä¿æŒPhase 2å‚æ•°")
    current_config['_phase4_rollback'] = True  # â† åªè®¾ç½®æ ‡è®°
    current_config['_phase3_applied'] = False  # â† æ²¡æœ‰å®é™…å›é€€å‚æ•°ï¼

# ä¿®æ”¹åï¼ˆç¬¬8011-8076è¡Œï¼‰
else:
    # ã€V8.5.2.4.69ã€‘éªŒè¯å¤±è´¥ï¼Œå®é™…å›é€€åˆ°Phase 2å‚æ•°
    print(f"\n  âš ï¸  Phase 4éªŒè¯å¤±è´¥ï¼ˆ{overall_status}ï¼‰ï¼Œå›é€€åˆ°Phase 2å‚æ•°")
    current_config['_phase4_rollback'] = True
    current_config['_phase3_applied'] = False
    
    # ã€V8.5.2.4.69ã€‘å®é™…å›é€€å‚æ•°ï¼šä½¿ç”¨Phase 2 baselineçš„params
    if phase2_baseline and phase2_baseline.get('params'):
        phase2_params = phase2_baseline['params'].copy()
        
        # ä»phase2_paramsä¸­æå–è¶…çŸ­çº¿å’Œæ³¢æ®µçš„åˆ†ç¦»å‚æ•°
        scalping_tp_sl = phase2_params.get('scalping_tp_sl', {})
        swing_tp_sl = phase2_params.get('swing_tp_sl', {})
        
        # æ„å»ºè¶…çŸ­çº¿å‚æ•°ï¼ˆä½¿ç”¨scalping_tp_slï¼‰
        config['scalping_params'] = {
            'min_risk_reward': phase2_params.get('min_risk_reward', 1.0),
            'min_indicator_consensus': phase2_params.get('min_indicator_consensus', 1),
            'min_signal_score': phase2_params.get('min_signal_score', 70),
            'atr_tp_multiplier': scalping_tp_sl.get('tp', phase2_params.get('atr_tp_multiplier', 12.0)),
            'atr_stop_multiplier': scalping_tp_sl.get('sl', phase2_params.get('atr_stop_multiplier', 2.0)),
            'max_holding_hours': phase2_baseline['learned_features'].get('scalping_real_holding_hours', 4),
            'trailing_stop_enabled': False,
            '_phase4_rollback': 'phase2',
            'found_profitable': phase2_params.get('found_profitable', True)
        }
        
        # æ„å»ºæ³¢æ®µå‚æ•°ï¼ˆä½¿ç”¨swing_tp_slï¼‰
        config['swing_params'] = {
            'min_risk_reward': phase2_params.get('min_risk_reward', 1.0),
            'min_indicator_consensus': phase2_params.get('min_indicator_consensus', 1),
            'min_signal_score': phase2_params.get('min_signal_score', 75),
            'atr_tp_multiplier': swing_tp_sl.get('tp', phase2_params.get('atr_tp_multiplier', 15.0)),
            'atr_stop_multiplier': swing_tp_sl.get('sl', phase2_params.get('atr_stop_multiplier', 2.5)),
            'max_holding_hours': phase2_baseline['learned_features'].get('swing_real_holding_hours', 17),
            'trailing_stop_enabled': False,
            '_phase4_rollback': 'phase2',
            'found_profitable': phase2_params.get('found_profitable', True)
        }
        
        print(f"\n  ğŸ“Š ã€Phase 4å›é€€ã€‘å·²åº”ç”¨Phase 2å‚æ•°:")
        print(f"     âš¡ è¶…çŸ­çº¿: TP={config['scalping_params']['atr_tp_multiplier']:.1f}, ...")
        print(f"     ğŸŒŠ æ³¢æ®µ: TP={config['swing_params']['atr_tp_multiplier']:.1f}, ...")
    else:
        # ä½¿ç”¨ä¿å®ˆé»˜è®¤å€¼
        ...
```

**å…³é”®å˜åŒ–**:
1. ä»`phase2_baseline['params']`æå–TP/SLå‚æ•°ï¼ˆä½¿ç”¨`scalping_tp_sl`å’Œ`swing_tp_sl`ï¼‰
2. æ„å»ºå®Œæ•´çš„`scalping_params`å’Œ`swing_params`
3. æ˜¾ç¤ºå›é€€åçš„å‚æ•°ï¼Œä¾¿äºéªŒè¯

---

## é¢„æœŸæ•ˆæœ

### Phase 3è¡¨ç°æå‡

**ä¿®å¤å‰** (V8.5.2.4.68):
```
è¶…çŸ­çº¿: æ•è·ç‡1.5%, åˆ©æ¶¦-1.67% âŒ
æ³¢æ®µ: æ•è·ç‡41.0%, åˆ©æ¶¦-1.89% âŒ
```

**ä¿®å¤å** (V8.5.2.4.69é¢„æœŸ):
```
è¶…çŸ­çº¿: æ•è·ç‡10-20%, åˆ©æ¶¦8-12% âœ…
æ³¢æ®µ: æ•è·ç‡40-50%, åˆ©æ¶¦10-14% âœ…
```

**ç†ç”±**:
1. ä½¿ç”¨`calculate_actual_profit_batch`åï¼Œåˆ©æ¶¦è®¡ç®—åŸºäºçœŸå®çš„future_data
2. V8.5.2.4.65çš„æ³¢åŠ¨å¹…åº¦ä¿®å¤ä¼šæ­£ç¡®å¤„ç†åŒæ—¶è§¦å‘TP/SLçš„æƒ…å†µ
3. Phase 3çš„ç­›é€‰é€»è¾‘ï¼ˆæé«˜signal_scoreå’Œconsensusï¼‰åº”è¯¥èƒ½æå‡å¹³å‡åˆ©æ¶¦

---

### Phase 4å›é€€æ­£ç¡®

**ä¿®å¤å‰**:
```
Phase 4å›é€€å:
- atr_tp_multiplier: 0.00   âŒ
- atr_stop_multiplier: 0.00 âŒ
- max_holding_hours: 0      âŒ
```

**ä¿®å¤å**:
```
Phase 4å›é€€å:
- atr_tp_multiplier: 22.1   âœ… (ä»Phase 2çš„æ³¢æ®µæœ€ä¼˜å€¼)
- atr_stop_multiplier: 2.5  âœ… (ä»Phase 2çš„æ³¢æ®µæœ€ä¼˜å€¼)
- max_holding_hours: 17     âœ… (ä»Phase 1ç»Ÿè®¡)
- scalping_tp_sl: {tp: 19.5, sl: 1.5}  âœ… (ä¿ç•™è¶…çŸ­çº¿å‚æ•°)
- swing_tp_sl: {tp: 22.1, sl: 2.5}     âœ… (ä¿ç•™æ³¢æ®µå‚æ•°)
```

---

## æŠ€æœ¯ç»†èŠ‚

### `calculate_actual_profit_batch` vs `batch_calculate_profits`

| ç‰¹æ€§ | `calculate_actual_profit_batch` | `batch_calculate_profits` |
|------|--------------------------------|---------------------------|
| **æ•°æ®æº** | opportunity['future_data'] | future_data_dictï¼ˆå¯é€‰ï¼‰ |
| **æ— æ•°æ®æ—¶** | ä½¿ç”¨`objective_profit`ï¼ˆV8.5.2.4.61é™çº§ï¼‰ | ä½¿ç”¨`_calculate_with_max_profit`ï¼ˆæ¨¡æ‹Ÿï¼‰ |
| **TP/SLåˆ¤æ–­** | V8.5.2.4.65æ³¢åŠ¨å¹…åº¦ä¿®å¤ âœ… | ç®€å•çš„ä»·æ ¼æ¯”è¾ƒ âŒ |
| **äº¤æ˜“æˆæœ¬** | å¯é€‰ï¼ˆé»˜è®¤0.14%ï¼‰ âœ… | ä¸æ”¯æŒ âŒ |
| **åŠ¨æ€ATR** | æ”¯æŒ âœ… | æ”¯æŒ âœ… |
| **è¿”å›å­—æ®µ** | `profit_pct` | `profit` |
| **ç”¨é€”** | Phase 2, Phase 3çœŸå®æµ‹è¯• | ä»…ç”¨äºç§»åŠ¨æ­¢æŸæ¢ç´¢ |

**V8.5.2.4.65çš„æ³¢åŠ¨å¹…åº¦ä¿®å¤**ï¼ˆå…³é”®ï¼‰:

```python
# calculate_actual_profit.py
if hit_stop_loss and hit_take_profit:
    # ã€V8.5.2.4.65ã€‘ä½¿ç”¨æ³¢åŠ¨å¹…åº¦åˆ¤æ–­
    sl_amplitude = abs(min_low - entry_price)
    tp_amplitude = abs(max_high - entry_price)
    
    if direction == 'long':
        if tp_amplitude > sl_amplitude:
            exit_method = 'take_profit_amplitude'
            exit_price = take_profit_price
        else:
            exit_method = 'stop_loss_prob_90%'
            exit_price = stop_loss_price
    # ... (shortç±»ä¼¼)
```

è¿™ç¡®ä¿äº†å½“TPå’ŒSLéƒ½è§¦å‘æ—¶ï¼Œæ ¹æ®æ³¢åŠ¨å¹…åº¦åˆ¤æ–­å®é™…é€€å‡ºç‚¹ï¼Œè€Œä¸æ˜¯ç®€å•å‡è®¾å…ˆè§¦å‘TPã€‚

---

## å›æµ‹éªŒè¯

### éªŒè¯ç›®æ ‡

1. **Phase 3åˆ©æ¶¦è½¬æ­£** âœ…
   - è¶…çŸ­çº¿: åˆ©æ¶¦>5%
   - æ³¢æ®µ: åˆ©æ¶¦>8%

2. **Phase 4å›é€€æ­£ç¡®** âœ…
   - `atr_tp_multiplier` > 0
   - `atr_stop_multiplier` > 0
   - `max_holding_hours` > 0

3. **æ•´ä½“æµç¨‹å®Œæ•´** âœ…
   - Phase 1 â†’ Phase 2 â†’ Phase 3 â†’ Phase 4
   - æ— æŠ¥é”™

---

## ç›¸å…³ç‰ˆæœ¬

- **V8.5.2.4.65**: ä¿®å¤åŒæ—¶è§¦å‘TP/SLçš„åˆ¤æ–­ï¼ˆä½¿ç”¨æ³¢åŠ¨å¹…åº¦ï¼‰
- **V8.5.2.4.67**: é™ä½Phase 2çš„TPå€æ•°ï¼ˆé¿å…è¿‡åº¦æ¿€è¿›ï¼‰
- **V8.5.2.4.68**: ä¿®å¤Phase 3é€»è¾‘ï¼ˆå›ºå®šTP/SLï¼Œä¼˜åŒ–ç­›é€‰æ¡ä»¶ï¼‰
- **V8.5.2.4.69**: ä¿®å¤Phase 3åˆ©æ¶¦è®¡ç®— + Phase 4å›é€€å‚æ•°ï¼ˆæœ¬ç‰ˆæœ¬ï¼‰

---

## æ€»ç»“

V8.5.2.4.69ä¿®å¤äº†**ä¸‰ä¸ªä¸¥é‡bug**ï¼š

1. **Phase 3åˆ©æ¶¦è®¡ç®—bug**ï¼ˆ`phase3_enhanced_optimizer.py`ï¼‰ï¼š
   - ä»ä½¿ç”¨æ¨¡æ‹Ÿé€»è¾‘ï¼ˆ`batch_calculate_profits`ï¼‰æ”¹ä¸ºä½¿ç”¨çœŸå®æ•°æ®ï¼ˆ`calculate_actual_profit_batch`ï¼‰
   - åº”ç”¨V8.5.2.4.65çš„æ³¢åŠ¨å¹…åº¦ä¿®å¤
   - **ä»…å½±å“deepseek**ï¼ˆqwenä¸ä½¿ç”¨æ­¤æ¨¡å—ï¼‰

2. **Phase 2 baselineå‚æ•°ä¸å®Œæ•´bug**ï¼ˆ`deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`, `qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼‰ï¼š
   - Phase 2 baselineçš„`params`ç°åœ¨åŒ…å«å®Œæ•´çš„TP/SLå‚æ•°
   - ä»`learned_features['optimal_tp_sl']`æå–å¹¶åˆå¹¶
   - **åŒæ—¶å½±å“deepseekå’Œqwen**

3. **Phase 4å›é€€æœªæ‰§è¡Œbug**ï¼ˆ`deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`, `qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼‰ï¼š
   - åŸä»£ç åªè®¾ç½®æ ‡è®°ï¼Œæ²¡æœ‰å®é™…å›é€€å‚æ•°
   - ç°åœ¨ä¼šå®é™…æ„å»º`scalping_params`å’Œ`swing_params`
   - **åŒæ—¶å½±å“deepseekå’Œqwen**

è¿™ä¸‰ä¸ªä¿®å¤åº”è¯¥èƒ½è®©Phase 3çš„åˆ©æ¶¦ä»è´Ÿå€¼è½¬æ­£ï¼ˆé¢„æœŸ8-14%ï¼‰ï¼Œå¹¶ç¡®ä¿Phase 4å›é€€æ—¶ä¿å­˜æ­£ç¡®çš„å‚æ•°ï¼ˆTP/SL > 0ï¼‰ã€‚

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `phase3_enhanced_optimizer.py`ï¼ˆä»…deepseekä½¿ç”¨ï¼‰
- `deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`
- `qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`

**ä¸‹ä¸€æ­¥**ï¼šæœåŠ¡å™¨å›æµ‹éªŒè¯V8.5.2.4.69

