# V8.3.17 超短线优化方案 - 联合优化

## 🎯 核心思想

用户洞察：**信号分阈值应该参与优化，而非固定值**

## ✅ 优化策略

### 决策变量优先级

1. **第一层**（核心）：止盈止损+持仓时间
   - `atr_tp_multiplier`: [0.5, 0.8, 1.2]
   - `atr_stop_multiplier`: [0.8, 1.0]
   - `max_holding_hours`: [0.5, 1.0, 1.5]

2. **第二层**（关键）：信号质量阈值
   - `min_signal_score`: [65, 75, 85] ← **关键：纳入优化！**
   - `min_risk_reward`: [1.5, 2.0, 2.5]

### Grid Search设计

**总组合数控制**：162组（3×3×2×3×3）→ **分层采样54组**

**分层策略**：
```python
# 策略1：高质量低数量（信号分85）- 4组
for tp in [0.8, 1.2]:
    for time in [1.0, 1.5]:
        test(tp, time, sl=1.0, rr=2.5, score=85)

# 策略2：中等质量中等数量（信号分75）- 18组
for tp in [0.5, 0.8, 1.2]:
    for sl in [0.8, 1.0]:
        for time in [0.5, 1.0, 1.5]:
            test(tp, time, sl, rr=2.0, score=75)

# 策略3：低质量高数量（信号分65）- 4组
for tp in [0.5, 0.8]:
    for time in [0.5, 1.0]:
        test(tp, time, sl=0.8, rr=1.5, score=65)

# 策略4：边界情况 - 补充到54组
for rr in [1.5, 2.0]:
    for score in [70, 80]:
        for tp in [0.6, 1.0]:
            test(tp, 1.0, 0.9, rr, score)
```

## 📊 预期效果

| 指标 | 当前 | 目标 |
|------|------|------|
| 捕捉率 | 79% | 30-60%（由数据决定）|
| 盈亏比 | 0.52:1 ❌ | 1.5-2.5:1 ✅ |
| 信号分 | 固定60 | 动态65-85 |

## 🔬 优化目标函数

```python
score = weighted_winrate × 盈亏比 × capture_rate

其中：
- weighted_winrate: 加权胜率（考虑盈亏幅度）
- 盈亏比: avg_profit / abs(avg_loss)
- capture_rate: 捕获的机会 / 总客观机会
```

## 💡 核心优势

1. ✅ **让数据说话**：不预设信号分=75，让Grid Search找最优值
2. ✅ **平衡质量与数量**：自动找到盈利最大化的平衡点
3. ✅ **控制计算成本**：分层采样，54组可控（vs 162组全组合）
4. ✅ **覆盖全场景**：高质量/中等/低质量三种策略都测试

## 📋 实施状态

- ✅ Grid Search参数范围已更新
- ✅ 分层采样逻辑已实现
- ✅ 默认配置改为动态优化
- ⚠️ 等待语法错误修复后部署测试

## 🚀 下一步

1. 修复所有缩进错误
2. 同步到Qwen
3. 部署并运行回测
4. 分析结果：找到最优信号分阈值

---

**核心理念**：不预设"宁缺毋滥"，让数据告诉我们最优的质量-数量平衡点！

