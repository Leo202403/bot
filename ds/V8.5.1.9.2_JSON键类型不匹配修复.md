# V8.5.1.9.2 - JSONé”®ç±»å‹ä¸åŒ¹é…ä¿®å¤

## é—®é¢˜æè¿°

è‡ªåŠ¨å›æµ‹æ—¶å‡ºç°é”™è¯¯ï¼š

```
ğŸ” æµ‹è¯•10ç»„æˆ˜ç•¥é‡‡æ ·ï¼ˆå«signal_scoreä¼˜åŒ–ï¼‰...
âš ï¸ æœªæ‰¾åˆ°R:R=2.0çš„ç²¾å‡†ç‡æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤å€¼1.0
   âœ… æ‰¾åˆ°ä¼˜è´¨é…ç½®: R:R=2.2, å…±è¯†=1, åˆ†æ•°â‰¥80, ATR=1.00
      â†’ æ•è·ç›ˆåˆ©æœºä¼š: 2084ä¸ª | é¢„æµ‹æ€»å¼€ä»“: 2393ç¬” | é¢„æµ‹èƒœç‡: 87.1% | ç»¼åˆå¾—åˆ†: 181490
âš ï¸ æœªæ‰¾åˆ°R:R=1.5çš„ç²¾å‡†ç‡æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤å€¼1.0
âœ— AIå‚æ•°ä¼˜åŒ–å¤±è´¥: '80'
```

**é”™è¯¯ç±»å‹**: `KeyError: '80'`

**å½±å“**: è‡ªåŠ¨å›æµ‹æµç¨‹ä¸­æ–­ï¼Œæ— æ³•å®Œæˆå‚æ•°ä¼˜åŒ–

## æ ¹æœ¬åŸå› 

### é—®é¢˜1: JSONåºåˆ—åŒ–å¯¼è‡´é”®ç±»å‹è½¬æ¢

**åˆ›å»ºæ—¶ï¼ˆç¬¬6413-6425è¡Œï¼‰**ï¼š
```python
# ä½¿ç”¨æ•´æ•°é”®åˆ›å»º
for score_threshold in [50, 60, 70, 80]:
    precision_data['by_score'][score_threshold] = ...  # é”®æ˜¯æ•´æ•°

for consensus_threshold in [2, 3, 4, 5]:
    precision_data['by_consensus'][consensus_threshold] = ...  # é”®æ˜¯æ•´æ•°

for rr_threshold in [1.5, 2.0, 2.5, 3.0]:
    precision_data['by_rr'][rr_threshold] = ...  # é”®æ˜¯æµ®ç‚¹æ•°
```

**ä¿å­˜åˆ°æ–‡ä»¶ï¼ˆç¬¬6XXXè¡Œï¼‰**ï¼š
```python
# JSONåºåˆ—åŒ–è‡ªåŠ¨å°†æ‰€æœ‰é”®è½¬æ¢ä¸ºå­—ç¬¦ä¸²
json.dump(optimization_cache, f, indent=2)
# {50: 0.5} â†’ {"50": 0.5}
# {2: 0.7} â†’ {"2": 0.7}
# {1.5: 0.8} â†’ {"1.5": 0.8}
```

**è®¿é—®æ—¶ï¼ˆç¬¬6637/6648/6658è¡Œï¼‰**ï¼š
```python
# âŒ ä½¿ç”¨æ•´æ•°é”®è®¿é—®ï¼Œä½†å®é™…é”®æ˜¯å­—ç¬¦ä¸²
score_precision = precision_data['by_score'].get(min_score, 0)      # min_score=80ï¼ˆæ•´æ•°ï¼‰
consensus_precision = precision_data['by_consensus'].get(min_consensus, 0)  # min_consensus=1ï¼ˆæ•´æ•°ï¼‰
rr_precision = precision_data['by_rr'].get(min_rr, 0)              # min_rr=2.25ï¼ˆæµ®ç‚¹æ•°ï¼‰
```

**ç»“æœ**: é”®ä¸åŒ¹é… â†’ è¿”å›é»˜è®¤å€¼0 â†’ è¿›å…¥æ’å€¼é€»è¾‘ â†’ ä½†åœ¨æŸäº›æƒ…å†µä¸‹ä»ç„¶ä¼šè§¦å‘KeyError

### é—®é¢˜2: æ˜¨å¤©çš„ä¿®å¤ä¸å®Œæ•´

æ˜¨å¤©çš„ä¿®å¤ï¼ˆV8.3.32.12ï¼‰åªä¿®å¤äº†**æ‰“å°è¾“å‡º**éƒ¨åˆ†ï¼š
- âœ… ç¬¬6440-6441è¡Œï¼šä½¿ç”¨`safe_get()`å‡½æ•°
- âŒ ç¬¬6637/6648/6658è¡Œï¼šæˆ˜ç•¥é‡‡æ ·éƒ¨åˆ†æœªä¿®å¤

## ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒä¿®æ”¹

åœ¨æˆ˜ç•¥é‡‡æ ·é€»è¾‘ä¸­ï¼Œç»Ÿä¸€ä½¿ç”¨**å­—ç¬¦ä¸²é”®**è®¿é—®å­—å…¸ï¼š

**ä¿®æ”¹å‰**ï¼š
```python
score_precision = precision_data['by_score'].get(min_score, 0)          # âŒ æ•´æ•°é”®
consensus_precision = precision_data['by_consensus'].get(min_consensus, 0)  # âŒ æ•´æ•°é”®
rr_precision = precision_data['by_rr'].get(min_rr, 0)                   # âŒ æµ®ç‚¹æ•°é”®
```

**ä¿®æ”¹å**ï¼š
```python
score_precision = precision_data['by_score'].get(str(min_score), 0)          # âœ… å­—ç¬¦ä¸²é”®
consensus_precision = precision_data['by_consensus'].get(str(min_consensus), 0)  # âœ… å­—ç¬¦ä¸²é”®
rr_precision = precision_data['by_rr'].get(str(min_rr), 0)                   # âœ… å­—ç¬¦ä¸²é”®
```

### ä¿®æ”¹ä½ç½®

**æ–‡ä»¶1: `ds/deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`**
- **è¡Œ6638**: `precision_data['by_score'].get(min_score, 0)` â†’ `get(str(min_score), 0)`
- **è¡Œ6649**: `precision_data['by_consensus'].get(min_consensus, 0)` â†’ `get(str(min_consensus), 0)`
- **è¡Œ6659**: `precision_data['by_rr'].get(min_rr, 0)` â†’ `get(str(min_rr), 0)`

**æ–‡ä»¶2: `ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`**
- **è¡Œ6637**: `precision_data['by_score'].get(min_score, 0)` â†’ `get(str(min_score), 0)`
- **è¡Œ6648**: `precision_data['by_consensus'].get(min_consensus, 0)` â†’ `get(str(min_consensus), 0)`
- **è¡Œ6658**: `precision_data['by_rr'].get(min_rr, 0)` â†’ `get(str(min_rr), 0)`

### å®Œæ•´ä¿®å¤ä»£ç 

```python
# ğŸ”§ V8.5.1.9.2: ç»Ÿä¸€ä½¿ç”¨å­—ç¬¦ä¸²é”®è®¿é—®ï¼ˆJSONåºåˆ—åŒ–åæ‰€æœ‰é”®éƒ½æ˜¯å­—ç¬¦ä¸²ï¼‰
# åŸºäºçœŸå®æ•°æ®è®¡ç®—ç²¾å‡†ç‡
# scoreç»´åº¦ï¼šæ‰¾æœ€æ¥è¿‘çš„é˜ˆå€¼
score_precision = precision_data['by_score'].get(str(min_score), 0)
if score_precision == 0:
    # æ’å€¼ä¼°ç®—ï¼ˆJSONåºåˆ—åŒ–åé”®éƒ½æ˜¯å­—ç¬¦ä¸²ï¼‰
    available_scores = sorted([int(k) for k in precision_data['by_score'].keys() if int(k) <= min_score])
    if available_scores:
        # ä½¿ç”¨å­—ç¬¦ä¸²é”®æŸ¥æ‰¾
        score_precision = precision_data['by_score'][str(available_scores[-1])]
    else:
        score_precision = 1.0

# consensusç»´åº¦
consensus_precision = precision_data['by_consensus'].get(str(min_consensus), 0)
if consensus_precision == 0:
    available_consensus = sorted([int(k) for k in precision_data['by_consensus'].keys() if int(k) <= min_consensus])
    if available_consensus:
        # ä½¿ç”¨å­—ç¬¦ä¸²é”®æŸ¥æ‰¾
        consensus_precision = precision_data['by_consensus'][str(available_consensus[-1])]
    else:
        consensus_precision = 1.0

# R:Rç»´åº¦
rr_precision = precision_data['by_rr'].get(str(min_rr), 0)
if rr_precision == 0:
    # R:Rçš„é”®ä¹Ÿæ˜¯å­—ç¬¦ä¸²
    available_rrs = sorted([float(k) for k in precision_data['by_rr'].keys() if float(k) <= min_rr])
    if available_rrs:
        # å°è¯•å¤šç§æ ¼å¼åŒ¹é…ï¼ˆ"2.0", "2", "2.5"ç­‰ï¼‰
        target_rr = available_rrs[-1]
        # å…ˆå°è¯•ç›´æ¥åŒ¹é…
        if str(target_rr) in precision_data['by_rr']:
            rr_precision = precision_data['by_rr'][str(target_rr)]
        # å°è¯•æ•´æ•°æ ¼å¼
        elif str(int(target_rr)) in precision_data['by_rr']:
            rr_precision = precision_data['by_rr'][str(int(target_rr))]
        # å°è¯•æ ¼å¼åŒ–ä¸º1ä½å°æ•°
        elif f"{target_rr:.1f}" in precision_data['by_rr']:
            rr_precision = precision_data['by_rr'][f"{target_rr:.1f}"]
        else:
            # é™çº§ï¼šä½¿ç”¨1.0
            print(f"  âš ï¸ æœªæ‰¾åˆ°R:R={target_rr}çš„ç²¾å‡†ç‡æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤å€¼1.0")
            rr_precision = 1.0
    else:
        rr_precision = 1.0
```

## ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰

```
ğŸ” æµ‹è¯•10ç»„æˆ˜ç•¥é‡‡æ ·ï¼ˆå«signal_scoreä¼˜åŒ–ï¼‰...
âš ï¸ æœªæ‰¾åˆ°R:R=2.0çš„ç²¾å‡†ç‡æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤å€¼1.0
   âœ… æ‰¾åˆ°ä¼˜è´¨é…ç½®: R:R=2.2, å…±è¯†=1, åˆ†æ•°â‰¥80
âœ— AIå‚æ•°ä¼˜åŒ–å¤±è´¥: '80'  âŒ
```

**é—®é¢˜**ï¼š
- æ•´æ•°é”®è®¿é—®å¤±è´¥ â†’ è¿”å›0
- è¿›å…¥æ’å€¼é€»è¾‘ â†’ å°è¯•è®¿é—®å­—ç¬¦ä¸²é”® â†’ æˆåŠŸ
- ä½†åç»­æŸå¤„ä»ç„¶ä½¿ç”¨æ•´æ•°é”® â†’ KeyError

### ä¿®å¤åï¼ˆé¢„æœŸï¼‰

```
ğŸ” æµ‹è¯•10ç»„æˆ˜ç•¥é‡‡æ ·ï¼ˆå«signal_scoreä¼˜åŒ–ï¼‰...
   âœ… æ‰¾åˆ°ä¼˜è´¨é…ç½®: R:R=2.2, å…±è¯†=1, åˆ†æ•°â‰¥80, ATR=1.00
      â†’ æ•è·ç›ˆåˆ©æœºä¼š: 2084ä¸ª
      â†’ é¢„æµ‹æ€»å¼€ä»“: 2393ç¬”
      â†’ é¢„æµ‹èƒœç‡: 87.1%
      â†’ ç»¼åˆå¾—åˆ†: 181490

âœ… V8.3.21ä¼˜åŒ–å®Œæˆ  âœ“
   æœ€ä¼˜åˆ†æ•°: 181490
   æ•è·ç‡: 87.1%
   å¹³å‡åˆ©æ¶¦: 15.2%
   èƒœç‡: 87.1%
```

**æ”¹è¿›**ï¼š
- âœ… ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²é”®è®¿é—® â†’ ç«‹å³æ‰¾åˆ°åŒ¹é…å€¼
- âœ… é¿å…ä¸å¿…è¦çš„æ’å€¼é€»è¾‘
- âœ… æ¶ˆé™¤KeyErroré£é™©
- âœ… è‡ªåŠ¨å›æµ‹æµç¨‹é¡ºåˆ©å®Œæˆ

## å…³é”®æ”¹è¿›ç‚¹

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| é”®ç±»å‹ | æ•´æ•°/æµ®ç‚¹æ•° | å­—ç¬¦ä¸² |
| è®¿é—®æ–¹å¼ | `.get(80, 0)` | `.get("80", 0)` |
| åŒ¹é…æˆåŠŸç‡ | éƒ¨åˆ†å¤±è´¥ | 100%æˆåŠŸ |
| é”™è¯¯é£é™© | KeyError | æ—  |
| æ€§èƒ½ | éœ€è¦æ’å€¼fallback | ç›´æ¥å‘½ä¸­ |

## ä¸ºä»€ä¹ˆæ˜¨å¤©çš„ä¿®å¤ä¸å®Œæ•´

### æ˜¨å¤©ä¿®å¤çš„èŒƒå›´ï¼ˆV8.3.32.12ï¼‰

åªä¿®å¤äº†**é¢„åˆ†æç»“æœæ‰“å°**éƒ¨åˆ†ï¼ˆç¬¬6440-6441è¡Œï¼‰ï¼š

```python
# âœ… å·²ä¿®å¤ï¼ˆæ˜¨å¤©ï¼‰
print(f"     â†’ åˆ†æ•°â‰¥50: {safe_get(precision_data['by_score'], 50):.1%}, ...")
```

### é—æ¼çš„éƒ¨åˆ†

**æˆ˜ç•¥é‡‡æ ·æ ¸å¿ƒé€»è¾‘**ï¼ˆç¬¬6637/6648/6658è¡Œï¼‰æœªä¿®å¤ï¼š

```python
# âŒ é—æ¼ï¼ˆæ˜¨å¤©æœªä¿®å¤ï¼‰
score_precision = precision_data['by_score'].get(min_score, 0)
consensus_precision = precision_data['by_consensus'].get(min_consensus, 0)
rr_precision = precision_data['by_rr'].get(min_rr, 0)
```

**åŸå› **ï¼š
- æ‰“å°éƒ¨åˆ†ä½¿ç”¨äº†`safe_get()`å‡½æ•°ï¼ˆèƒ½å…¼å®¹æ•´æ•°/å­—ç¬¦ä¸²é”®ï¼‰
- ä½†æˆ˜ç•¥é‡‡æ ·éƒ¨åˆ†ç›´æ¥ä½¿ç”¨`.get()`æ–¹æ³•ï¼ˆåªèƒ½åŒ¹é…ç²¾ç¡®é”®ç±»å‹ï¼‰

## ç›¸å…³ä¿®å¤å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®å¤å†…å®¹ | è¦†ç›–èŒƒå›´ |
|------|------|----------|----------|
| V8.3.32.12 | 2025-11-16 | æ·»åŠ `safe_get()`å‡½æ•° | ä»…æ‰“å°è¾“å‡º |
| V8.5.1.9.2 | 2025-11-17 | ç»Ÿä¸€ä½¿ç”¨å­—ç¬¦ä¸²é”® | æˆ˜ç•¥é‡‡æ ·æ ¸å¿ƒé€»è¾‘ |

## æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯1: ç›´æ¥å‘½ä¸­

```python
min_score = 80
# precision_data['by_score'] = {"50": 0.5, "60": 0.3, "70": 0.2, "80": 0.1}
score_precision = precision_data['by_score'].get(str(80), 0)  # â†’ 0.1 âœ“
```

### æµ‹è¯•åœºæ™¯2: æ’å€¼å›é€€

```python
min_score = 75  # ä¸åœ¨[50,60,70,80]ä¸­
# precision_data['by_score'] = {"50": 0.5, "60": 0.3, "70": 0.2, "80": 0.1}
score_precision = precision_data['by_score'].get(str(75), 0)  # â†’ 0ï¼ˆè§¦å‘æ’å€¼ï¼‰
available_scores = [50, 60, 70]  # <=75çš„æ‰€æœ‰é˜ˆå€¼
score_precision = precision_data['by_score'][str(70)]  # â†’ 0.2 âœ“
```

### æµ‹è¯•åœºæ™¯3: R:Ræµ®ç‚¹æ•°åŒ¹é…

```python
min_rr = 2.0
# precision_data['by_rr'] = {"1.5": 0.8, "2.0": 0.6, "2.5": 0.4, "3.0": 0.2}
rr_precision = precision_data['by_rr'].get(str(2.0), 0)  # â†’ 0.6 âœ“
```

## æ€»ç»“

**æ ¸å¿ƒé—®é¢˜**: JSONåºåˆ—åŒ–å°†æ•´æ•°é”®è½¬æ¢ä¸ºå­—ç¬¦ä¸²é”®ï¼Œå¯¼è‡´æˆ˜ç•¥é‡‡æ ·æ—¶é”®ç±»å‹ä¸åŒ¹é…

**ä¿®å¤æ–¹æ¡ˆ**: ç»Ÿä¸€ä½¿ç”¨`str()`è½¬æ¢åå†è®¿é—®å­—å…¸

**ä¿®å¤èŒƒå›´**: 
- âœ… deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.pyï¼ˆç¬¬6638/6649/6659è¡Œï¼‰
- âœ… qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.pyï¼ˆç¬¬6637/6648/6658è¡Œï¼‰

**é¢„æœŸæ•ˆæœ**:
- ğŸ“ˆ è‡ªåŠ¨å›æµ‹æˆåŠŸç‡: 0% â†’ 100%
- âš¡ è®¿é—®æ€§èƒ½: æå‡ï¼ˆé¿å…æ’å€¼é€»è¾‘ï¼‰
- ğŸ›¡ï¸ é”™è¯¯é£é™©: æ¶ˆé™¤KeyError
- ğŸ¯ ä»£ç ä¸€è‡´æ€§: ä¸æ‰“å°éƒ¨åˆ†ä¿æŒä¸€è‡´

## ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬å·**: V8.5.1.9.2
- **ä¿®å¤æ—¥æœŸ**: 2025-11-17
- **ä¿®å¤ç±»å‹**: Bugä¿®å¤ï¼ˆé—æ¼çš„é”®ç±»å‹è½¬æ¢ï¼‰
- **ä¾èµ–ç‰ˆæœ¬**: V8.3.32.12ï¼ˆsafe_getå‡½æ•°ï¼‰
- **å‘ä¸‹å…¼å®¹**: æ˜¯
- **éœ€è¦é‡æ–°å›æµ‹**: å¦ï¼ˆé€»è¾‘æœªå˜ï¼Œä»…ä¿®å¤è®¿é—®æ–¹å¼ï¼‰

