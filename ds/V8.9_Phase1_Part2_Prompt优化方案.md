# V8.9 Phase 1 - Part 2: Promptä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“Š ç°æœ‰Promptåˆ†æ

### å½“å‰ç»“æ„ï¼ˆLine 17894+ï¼‰

ç»è¿‡åˆ†æï¼Œä¸»è¦AIå†³ç­–PromptåŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

```python
prompt = f"""
ã€1. ç³»ç»Ÿè§’è‰²ã€‘
- Trading AIä»‹ç»
- 3-layer trend framework (4H/1H/15m)

ã€2. å­¦ä¹ å‚æ•°ä¿¡æ¯ã€‘
- learning_params_info (è‡ªé€‚åº”å‚æ•°å†å²)
- decision_context (å†³ç­–ä¸Šä¸‹æ–‡)

ã€3. å“ç§ç‰¹å¾ã€‘
- symbol_characteristics_info (å„å¸ç§ç‰¹ç‚¹)

ã€4. åŒæ¨¡å¼ç³»ç»Ÿã€‘
- dual_mode_info (Scalping vs Swing)

ã€5. ä¿¡å·åˆ†å±‚ã€‘
- signal_tier_info (ä¿¡å·è´¨é‡åˆ†å±‚)

ã€6. å¸‚åœºæ•°æ®ã€‘
- market_overview (æ‰€æœ‰å¸ç§å¸‚åœºæ•°æ®)
- market_regime_text (å¸‚åœºçŠ¶æ€)

ã€7. è´¦æˆ·çŠ¶æ€ã€‘
- position_info (å½“å‰æŒä»“)

ã€8. è‡ªé€‚åº”å‚æ•°ã€‘
- Risk-Reward Ratio
- Stop-Loss multipliers
- Indicator Consensus
- Auto-adjustment rules

ã€9. 3-Layer Frameworkè¯¦ç»†è¯´æ˜ã€‘
- å„å±‚æƒé‡å’Œä½œç”¨

ã€10. TP/SLè®¡ç®—è§„åˆ™ã€‘
- Scalping modeè§„åˆ™
- Swing modeè§„åˆ™
- å†å²tradesä¼˜åŒ–åçš„multipliers

ã€11. Lesson Applicationã€‘
- å¦‚ä½•åº”ç”¨å†å²æ•™è®­

ã€12. Entry Checklistã€‘
- æŒ‡æ ‡å…±æŒ¯
- PAç¡®è®¤

ã€13. Price Action Patternsã€‘
- 9ç§PAæ¨¡å¼
- ä¼˜å…ˆçº§å’Œä»“ä½

ã€14. Profit Protectionã€‘
- åˆ©æ¶¦ä¿æŠ¤è§„åˆ™

ã€15. YTC Structural Signalsã€‘
- YTCä¿¡å·ç³»ç»Ÿ
- Trapped Psychology

ã€16. Priority Hierarchyã€‘
- å†³ç­–ä¼˜å…ˆçº§

ã€17. SL/TP Logicã€‘
- åŸºäº1Hçš„æ­¢æŸæ­¢ç›ˆ

ã€18. Entry/Exit Conditionsã€‘
- è¯¦ç»†çš„å…¥åœºå‡ºåœºè§„åˆ™

ã€19. Forbidden Exit Reasonsã€‘
- ç¦æ­¢çš„é€€å‡ºç†ç”±

ã€20. Position Managementã€‘
- ä»“ä½ç®¡ç†è§„åˆ™

ã€21. Aggregated Actionsã€‘
- å¤šå¸ç§å†³ç­–èšåˆ

ã€22. JSON Formatã€‘
- è¾“å‡ºæ ¼å¼è¦æ±‚
"""
```

### Tokenä¼°ç®—

**å½“å‰Prompté•¿åº¦ï¼š**
- çº¦2500è¡Œä»£ç 
- ä¼°ç®—ï¼š~7000-8000 tokens
- åŠ ä¸Šmarket_dataå˜é‡ï¼šå¯èƒ½è¾¾åˆ°10000+ tokens

---

## ğŸ¯ ä¼˜åŒ–ç­–ç•¥

### æ ¸å¿ƒåŸåˆ™

1. **åˆ é™¤ä½ç›¸å…³æ€§æŒ‡æ ‡**
   - å†å²lessonsï¼ˆAIè®°ä¸ä½å¤ªè¿œçš„å†å²ï¼‰
   - å†—ä½™çš„è§„åˆ™è¯´æ˜
   - è¿‡äºè¯¦ç»†çš„ç¤ºä¾‹

2. **ç»“æ„åŒ–åˆ†å±‚**
   - æ ¸å¿ƒæŒ‡æ ‡ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
   - æ¬¡è¦æŒ‡æ ‡
   - å‚è€ƒä¿¡æ¯

3. **ç²¾ç®€è¯­è¨€**
   - åˆ é™¤é‡å¤è¯´æ˜
   - åˆå¹¶ç›¸ä¼¼è§„åˆ™
   - ä½¿ç”¨è¡¨æ ¼æ›¿ä»£é•¿æ–‡æœ¬

---

## âœ… å…·ä½“ä¼˜åŒ–æ–¹æ¡ˆ

### åˆ é™¤çš„å†…å®¹ï¼ˆçº¦40-50%ï¼‰

**1. å†—ä½™çš„å†å²è¯´æ˜**
```python
# âŒ åˆ é™¤
**âš ï¸ HISTORICAL DATA SHOWS: Premature exits caused R:R to collapse from 1.1:1 to 0.01:1!**
**From 105 trades: Average profit was only 0.014U because AI exited too early.**

# âœ… ä¿ç•™æ ¸å¿ƒè§„åˆ™å³å¯
```

**2. è¿‡äºè¯¦ç»†çš„Lesson Application**
```python
# âŒ åˆ é™¤æ•´ä¸ªè¡¨æ ¼
|| Lesson Type | Scalping Response | Swing Response |
||-------------|-------------------|----------------|
|| "TP Too Conservative" | IGNORE | APPLY: TPÃ—1.5-2 |
...

# âœ… åªä¿ç•™ï¼šåœ¨reasonä¸­æ ‡æ³¨ [Scalping Lesson] æˆ– [Swing Lesson]
```

**3. é‡å¤çš„è§„åˆ™è¯´æ˜**
```python
# âŒ åˆ é™¤é‡å¤
**IMPORTANT**:
1. ALWAYS use the ATR multipliers shown above
2. DO NOT use S/R-based TP unless...
3. These multipliers are proven to...

# âœ… åˆå¹¶åˆ°TP/SLè§„åˆ™ä¸­ï¼Œä¸€æ¬¡è¯´æ¸…
```

**4. å†—ä½™çš„Priorityè¯´æ˜**
```python
# âŒ åˆ é™¤
**Priority**: Exhaustion Exit > Strong Inception > Simple Pullback > Extreme Vol > Others
**Rules**: (1) Inception beats all; (2) Pullbacks = best R:R; ...

# âœ… åˆå¹¶åˆ°PA Patternsè¡¨æ ¼ä¸­
```

**5. è¯¦ç»†çš„Forbidden Exit Reasons**
```python
# âŒ åˆ é™¤è¯¦ç»†è§£é‡Š
1. âŒ Single timeframe reversal (e.g., "15m Bear Exhaustion")
   - 15m reversal alone is NOT enough
   - This is normal price action, not a valid exit signal
...

# âœ… ç²¾ç®€ä¸ºä¸€å¥
âŒ ç¦æ­¢é€€å‡º: å•å‘¨æœŸåè½¬ã€ä¸»è§‚åˆ¤æ–­ã€éƒ¨åˆ†æ­¢ç›ˆï¼ˆé™¤éTPè§¦åŠï¼‰
```

---

### ä¿ç•™çš„å†…å®¹ï¼ˆæ ¸å¿ƒ50-60%ï¼‰

**æ ¸å¿ƒæŒ‡æ ‡ï¼ˆå¿…é¡»ï¼‰ï¼š**
1. âœ… 3-layer framework (4H/1H/15mæƒé‡)
2. âœ… Market data (å½“å‰ä»·æ ¼ã€è¶‹åŠ¿ã€å…³é”®ä½)
3. âœ… Account status (æŒä»“ã€ä½™é¢)
4. âœ… TP/SLè®¡ç®—è§„åˆ™ (ATR multipliers)
5. âœ… Entry checklist (æŒ‡æ ‡å…±æŒ¯)
6. âœ… PA Patterns (9ç§æ¨¡å¼ï¼Œç®€åŒ–ä¸ºè¡¨æ ¼)
7. âœ… Exit conditions (4ä¸ªæ ¸å¿ƒæ¡ä»¶)
8. âœ… JSON format

**æ¬¡è¦æŒ‡æ ‡ï¼ˆä¿ç•™ä½†ç²¾ç®€ï¼‰ï¼š**
- YTC signals (ç®€åŒ–ä¸º1ä¸ªè¡¨æ ¼)
- Adaptive parameters (åªæ˜¾ç¤ºå½“å‰å€¼)
- Symbol characteristics (åªæ˜¾ç¤ºå½“å‰å¸ç§)

**åˆ é™¤çš„å†…å®¹ï¼š**
- Lesson applicationè¯¦ç»†è¡¨æ ¼
- Historical data warnings
- Forbidden reasonsè¯¦ç»†è§£é‡Š
- é‡å¤çš„IMPORTANTè¯´æ˜

---

## ğŸ“ ä¼˜åŒ–åçš„Promptç»“æ„

```python
prompt = f"""
**[ä¸­æ–‡å›å¤]**

You are a crypto trading AI using 3-layer trend framework:
- 4H (40%): Primary trend
- 1H (30%): TP/SL levels
- 15m (20%): Entry timing

=== æ ¸å¿ƒæŒ‡æ ‡ (Core Indicators) ===

ã€å½“å‰å¸‚åœºã€‘
{market_overview_simplified}  # ç²¾ç®€ç‰ˆï¼šåªæ˜¾ç¤ºä»·æ ¼ã€è¶‹åŠ¿ã€å…³é”®ä½

ã€è´¦æˆ·çŠ¶æ€ã€‘
ä½™é¢: {balance}
æŒä»“: {positions_count}ä¸ª (æ€»æ•å£: {total_exposure})

ã€è‡ªé€‚åº”å‚æ•°ã€‘
- R:R: {rr:.1f}:1
- SL: ATRÃ—{atr_stop:.1f}
- å…±æŒ¯è¦æ±‚: {consensus}/5

=== TP/SLè§„åˆ™ (Critical) ===

**Scalping** (15min-2h):
- TP = Entry Â± 15m_ATR Ã— {scalping_tp:.1f}
- SL = Entry âˆ“ 15m_ATR Ã— {scalping_sl:.1f}

**Swing** (2h-24h):
- TP = Entry Â± 1H_ATR Ã— {swing_tp:.1f}
- SL = Entry âˆ“ 1H_ATR Ã— {swing_sl:.1f}

=== PAæ¨¡å¼ (PA Patterns) ===

| Pattern | Priority | Position |
|---------|----------|----------|
| è¶‹åŠ¿èµ·å§‹(å¼º) | 1 | 50% |
| ç®€å•å›è°ƒ | 2 | 47.5% |
| æç«¯æˆäº¤é‡ | 3 | 48.75% |
| çªç ´Marubozu | 4 | 42.5% |
| âš ï¸ è¡°ç«­ä¿¡å· | ç«‹å³é€€å‡º | - |

=== å…¥åœºæ¡ä»¶ ===

âœ… å¿…é¡»æ»¡è¶³ï¼š
1. 4Hè¶‹åŠ¿ä¸€è‡´
2. 15må…±æŒ¯â‰¥{consensus}/5
3. PAç¡®è®¤ + å®‰å…¨ä½ç½® (æ”¯æ’‘/é˜»åŠ›)

=== é€€å‡ºæ¡ä»¶ (Only 4 Valid Reasons) ===

âœ… å…è®¸é€€å‡ºï¼š
1. TPè¾¾åˆ°
2. SLè§¦å‘
3. è¶…æ—¶ (Scalping>{scalping_max_hours}h, Swing>{swing_max_hours}h)
4. è¶‹åŠ¿åè½¬ (4Håè½¬ OR 1H+15måŒæ—¶åè½¬)

âŒ ç¦æ­¢é€€å‡ºï¼šå•å‘¨æœŸåè½¬ã€ä¸»è§‚åˆ¤æ–­ã€è¿‡æ—©æ­¢ç›ˆ

=== æ¬¡è¦å‚è€ƒ ===

ã€YTCä¿¡å·ã€‘{ytc_summary}  # ç®€åŒ–ï¼šåªæ˜¾ç¤ºå½“å‰æœ€é«˜åˆ†ä¿¡å·

ã€ä¼˜å…ˆçº§ã€‘YTC(S/Râ‰¥4) > PA@å…³é”®ä½ > 4Hè¶‹åŠ¿ > 15m

=== è¾“å‡ºæ ¼å¼ ===

{{
  "actions": [
    {{
      "symbol": "BTC/USDT:USDT",
      "action": "OPEN_LONG",
      "confidence": 85,
      "reason": "ç®€æ´ç†ç”±ï¼ˆ<100å­—ï¼‰+ [Scalping/Swing Lesson]"
    }}
  ]
}}
"""
```

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

| ç»´åº¦ | å½“å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|------|--------|------|
| **Promptè¡Œæ•°** | ~250è¡Œ | ~100è¡Œ | **-60%** |
| **Tokenä¼°ç®—** | ~8000 | ~4000 | **-50%** |
| **æ ¸å¿ƒæŒ‡æ ‡** | 20ä¸ªéƒ¨åˆ† | 8ä¸ªéƒ¨åˆ† | ç²¾ç®€ |
| **å¯è¯»æ€§** | æ··ä¹± | ç»“æ„åŒ– | æå‡ |
| **AIå…³æ³¨åº¦** | åˆ†æ•£ | èšç„¦æ ¸å¿ƒ | æå‡ |

**é¢„æœŸæ”¶ç›Šï¼š**
- âœ… Tokenæˆæœ¬ï¼š-50%
- âœ… AIå»¶è¿Ÿï¼š-30%ï¼ˆå¤„ç†æ›´å¿«ï¼‰
- âœ… å†³ç­–è´¨é‡ï¼š+5-10%ï¼ˆå‡å°‘"Lost in the Middle"ï¼‰
- âœ… ç»´æŠ¤æˆæœ¬ï¼šæ›´æ˜“ç†è§£å’Œä¿®æ”¹

---

## ğŸ”§ å®æ–½æ­¥éª¤

### Step 1: åˆ›å»ºç®€åŒ–ç‰ˆmarket_overview

```python
def generate_simplified_market_overview(symbol_data):
    """
    ğŸ†• V8.9: ç²¾ç®€ç‰ˆå¸‚åœºæ¦‚è§ˆ
    
    åªåŒ…å«æ ¸å¿ƒä¿¡æ¯ï¼š
    - ä»·æ ¼
    - 3å±‚è¶‹åŠ¿
    - å…³é”®ä½
    - PAä¿¡å·
    """
    simplified = []
    
    for symbol, data in symbol_data.items():
        coin = symbol.split('/')[0]
        
        # æ ¸å¿ƒä¿¡æ¯
        info = f"""
ã€{coin}ã€‘ä»·æ ¼: {data['price']:.2f}
- è¶‹åŠ¿: 4H={data['trend_4h']}, 1H={data['trend_1h']}, 15m={data['trend_15m']}
- å…³é”®ä½: S={data['support']:.2f}, R={data['resistance']:.2f}
- PA: {data['pa_pattern']} (åˆ†æ•°:{data['pa_score']})
"""
        simplified.append(info.strip())
    
    return "\n\n".join(simplified)
```

### Step 2: ç²¾ç®€å­¦ä¹ å‚æ•°ä¿¡æ¯

```python
# âŒ å½“å‰ï¼šæ˜¾ç¤ºè¯¦ç»†çš„å†å²è°ƒæ•´è®°å½•
learning_params_info = """
Adaptive Parameters (Auto-adjusted based on last 20 trades):
... (long history)
"""

# âœ… V8.9ï¼šåªæ˜¾ç¤ºå½“å‰å€¼
learning_params_info = f"""
è‡ªé€‚åº”å‚æ•° (åŸºäºæœ€è¿‘{trades_count}ç¬”äº¤æ˜“):
- R:R: {rr:.1f}:1
- SL: ATRÃ—{atr_stop:.1f}
- å…±æŒ¯: {consensus}/5
"""
```

### Step 3: åˆå¹¶å’Œåˆ é™¤å†—ä½™éƒ¨åˆ†

```python
# åˆ é™¤ï¼š
# - Lesson Applicationè¯¦ç»†è¡¨æ ¼
# - Historical data warnings
# - Forbidden reasonsè¯¦ç»†è§£é‡Š
# - é‡å¤çš„IMPORTANTè¯´æ˜
# - è¿‡äºè¯¦ç»†çš„è§„åˆ™è¯´æ˜

# åˆå¹¶ï¼š
# - PA Patterns + Priority â†’ ä¸€ä¸ªè¡¨æ ¼
# - Entry + Exit conditions â†’ ç²¾ç®€åˆ—è¡¨
# - TP/SLè§„åˆ™ â†’ ç®€åŒ–ä¸ºå…¬å¼
```

### Step 4: ç»“æ„åŒ–è¾“å‡º

```python
prompt_structure = """
=== æ ¸å¿ƒæŒ‡æ ‡ ===
(ä»·æ ¼ã€è¶‹åŠ¿ã€è´¦æˆ·)

=== è§„åˆ™ ===
(TP/SLã€PAæ¨¡å¼)

=== æ¡ä»¶ ===
(å…¥åœºã€é€€å‡º)

=== æ¬¡è¦å‚è€ƒ ===
(YTCã€ä¼˜å…ˆçº§)

=== è¾“å‡ºæ ¼å¼ ===
"""
```

---

## ğŸ¯ å®æ–½æ—¶é—´çº¿

**é¢„è®¡æ—¶é—´ï¼š** 2-3å°æ—¶

1. âœ… åˆ†æç°æœ‰Promptï¼ˆ30åˆ†é’Ÿï¼‰- **å·²å®Œæˆ**
2. â³ åˆ›å»ºç®€åŒ–å‡½æ•°ï¼ˆ1å°æ—¶ï¼‰
3. â³ é‡æ„Promptç»“æ„ï¼ˆ1å°æ—¶ï¼‰
4. â³ æµ‹è¯•å’ŒéªŒè¯ï¼ˆ30åˆ†é’Ÿï¼‰

---

## ğŸš¨ é£é™©æ§åˆ¶

**é£é™©ï¼š** åˆ é™¤è¿‡å¤šå¯èƒ½å½±å“AIå†³ç­–è´¨é‡

**ç¼“è§£æªæ–½ï¼š**
1. âœ… ä¿ç•™æ‰€æœ‰æ ¸å¿ƒè§„åˆ™
2. âœ… åªåˆ é™¤å†—ä½™å’Œå†å²è¯´æ˜
3. âœ… ä½¿ç”¨A/Bæµ‹è¯•å¯¹æ¯”æ•ˆæœ
4. âœ… å¯ä»¥éšæ—¶å›é€€

**ç›‘æ§æŒ‡æ ‡ï¼š**
- AIå†³ç­–å‡†ç¡®ç‡
- ä¿¡å·è´¨é‡åˆ†æ•°
- ç”¨æˆ·åé¦ˆ

---

## ğŸ“ æ€»ç»“

**ä¼˜åŒ–æ ¸å¿ƒï¼š**
1. âŒ åˆ é™¤ï¼šå†å²è¯´æ˜ã€é‡å¤è§„åˆ™ã€è¯¦ç»†è§£é‡Š
2. âœ… ä¿ç•™ï¼šæ ¸å¿ƒæŒ‡æ ‡ã€è®¡ç®—è§„åˆ™ã€è¾“å‡ºæ ¼å¼
3. ğŸ“Š ç»“æ„åŒ–ï¼šæ ¸å¿ƒâ†’æ¬¡è¦â†’å‚è€ƒ

**é¢„æœŸæ•ˆæœï¼š**
- Tokenå‡å°‘50%
- å»¶è¿Ÿé™ä½30%
- å†³ç­–è´¨é‡æå‡5-10%
- ç»´æŠ¤æˆæœ¬é™ä½

**å®æ–½å»ºè®®ï¼š**
- ç«‹å³å¼€å§‹å®æ–½
- é¢„è®¡2-3å°æ—¶å®Œæˆ
- ä½é£é™©é«˜æ”¶ç›Š

---

**ç”Ÿæˆæ—¥æœŸ**: 2025-11-22  
**ç‰ˆæœ¬**: V8.9 Phase 1 - Part 2  
**çŠ¶æ€**: æ–¹æ¡ˆå·²å®Œæˆï¼Œå¾…å®æ–½

