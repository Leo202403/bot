#!/bin/bash
# V8.3.21 æœåŠ¡å™¨å®Œæ•´æ£€æŸ¥å’Œå›æµ‹è„šæœ¬ï¼ˆAIä¸åœæ­¢ï¼‰

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "V8.3.21 æœåŠ¡å™¨å®Œæ•´æ£€æŸ¥å’Œå›æµ‹ï¼ˆAIä¿æŒè¿è¡Œï¼‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# ==========================================
# ç¬¬1æ­¥ï¼šæ£€æŸ¥è¿›ç¨‹çŠ¶æ€
# ==========================================
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ç¬¬1æ­¥ï¼šæ£€æŸ¥è¿›ç¨‹çŠ¶æ€"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "ğŸ“Š Supervisorç®¡ç†çš„æœåŠ¡ï¼š"
supervisorctl status

echo ""
echo "ğŸ” Pythonè¿›ç¨‹ï¼š"
ps aux | grep -E "qwen|deepseek|å‰ç«¯|frontend" | grep -v grep

echo ""

# ==========================================
# ç¬¬2æ­¥ï¼šæ›´æ–°ä»£ç 
# ==========================================
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ç¬¬2æ­¥ï¼šæ›´æ–°ä»£ç "
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

cd /root/10-23-bot

echo "ğŸ“ å½“å‰ç‰ˆæœ¬ï¼š"
git log --oneline -1

echo ""
echo "ğŸ”„ æ‹‰å–æœ€æ–°ä¿®å¤..."
git pull origin main

echo ""
echo "ğŸ“ æ›´æ–°åç‰ˆæœ¬ï¼š"
git log --oneline -1

# ==========================================
# ç¬¬3æ­¥ï¼šéªŒè¯ä¿®å¤
# ==========================================
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ç¬¬3æ­¥ï¼šéªŒè¯ä¿®å¤å·²åº”ç”¨"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

cd /root/10-23-bot/ds

echo "âœ… Qwenä¿®å¤éªŒè¯ï¼š"
if grep -q "V8.3.21ä¿®å¤.*æ¸…ç†NaN" qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py; then
    echo "   âœ“ Qwenå·²åŒ…å«NaNä¿®å¤"
    grep "V8.3.21ä¿®å¤" qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py | head -1
else
    echo "   âŒ Qwenç¼ºå°‘NaNä¿®å¤"
fi

echo ""
echo "âœ… DeepSeekä¿®å¤éªŒè¯ï¼š"
if grep -q "V8.3.21ä¿®å¤.*æ¸…ç†NaN" deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py; then
    echo "   âœ“ DeepSeekå·²åŒ…å«NaNä¿®å¤"
    grep "V8.3.21ä¿®å¤" deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py | head -1
else
    echo "   âŒ DeepSeekç¼ºå°‘NaNä¿®å¤"
fi

# ==========================================
# ç¬¬4æ­¥ï¼šè¿è¡Œå›æµ‹ï¼ˆä¸¤ä¸ªæ¨¡å‹ï¼ŒAIä¸åœæ­¢ï¼‰
# ==========================================
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ç¬¬4æ­¥ï¼šè¿è¡Œå›æµ‹ï¼ˆQwen + DeepSeekï¼‰- AIä¿æŒè¿è¡Œ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

cd /root/10-23-bot/ds

# è®¾ç½®å›æµ‹æ¨¡å¼
export MANUAL_BACKTEST=true

# å›æµ‹ Qwen
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "å›æµ‹æ¨¡å‹1: Qwen"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

timeout 600 python3 qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py 2>&1 | tee /tmp/qwen_backtest.log

QWEN_EXIT=${PIPESTATUS[0]}

echo ""
if [ $QWEN_EXIT -eq 0 ]; then
    echo "âœ… Qwenå›æµ‹å®Œæˆ"
else
    echo "âŒ Qwenå›æµ‹å¼‚å¸¸ï¼ˆé€€å‡ºç : $QWEN_EXITï¼‰"
    echo "ğŸ“„ æœ€å50è¡Œæ—¥å¿—ï¼š"
    tail -50 /tmp/qwen_backtest.log
fi

# å›æµ‹ DeepSeek
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "å›æµ‹æ¨¡å‹2: DeepSeek"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

timeout 600 python3 deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py 2>&1 | tee /tmp/deepseek_backtest.log

DEEPSEEK_EXIT=${PIPESTATUS[0]}

echo ""
if [ $DEEPSEEK_EXIT -eq 0 ]; then
    echo "âœ… DeepSeekå›æµ‹å®Œæˆ"
else
    echo "âŒ DeepSeekå›æµ‹å¼‚å¸¸ï¼ˆé€€å‡ºç : $DEEPSEEK_EXITï¼‰"
    echo "ğŸ“„ æœ€å50è¡Œæ—¥å¿—ï¼š"
    tail -50 /tmp/deepseek_backtest.log
fi

# ==========================================
# ç¬¬5æ­¥ï¼šæ£€æŸ¥AIæœåŠ¡çŠ¶æ€
# ==========================================
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ç¬¬5æ­¥ï¼šæ£€æŸ¥AIæœåŠ¡çŠ¶æ€"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

supervisorctl status

echo ""
echo "ğŸ” Pythonè¿›ç¨‹ï¼š"
ps aux | grep -E "qwen|deepseek" | grep -v grep

# ==========================================
# æ€»ç»“
# ==========================================
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… å®Œæˆï¼"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "ğŸ“Š å›æµ‹ç»“æœï¼š"
if [ $QWEN_EXIT -eq 0 ]; then
    echo "  âœ“ Qwen: æˆåŠŸ"
else
    echo "  âœ— Qwen: å¼‚å¸¸ï¼ˆé€€å‡ºç  $QWEN_EXITï¼‰"
fi

if [ $DEEPSEEK_EXIT -eq 0 ]; then
    echo "  âœ“ DeepSeek: æˆåŠŸ"
else
    echo "  âœ— DeepSeek: å¼‚å¸¸ï¼ˆé€€å‡ºç  $DEEPSEEK_EXITï¼‰"
fi

echo ""
echo "ğŸ“§ è¯·æ£€æŸ¥é‚®ç®±æŸ¥çœ‹å›æµ‹æŠ¥å‘Š"
echo "ğŸ“± è¯·æ£€æŸ¥æ‰‹æœºæŸ¥çœ‹Barké€šçŸ¥"
echo ""
echo "ğŸ’¡ æŸ¥çœ‹æ–°å‚æ•°ï¼š"
echo "   cat /root/10-23-bot/ds/trading_data/qwen/config.json | grep -A 10 scalping_params"
echo "   cat /root/10-23-bot/ds/trading_data/deepseek/config.json | grep -A 10 scalping_params"
echo ""
