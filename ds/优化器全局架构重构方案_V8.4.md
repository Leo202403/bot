# ğŸ—ï¸ ä¼˜åŒ–å™¨å…¨å±€æ¶æ„é‡æ„æ–¹æ¡ˆ V8.4

## ğŸ“‹ å½“å‰é—®é¢˜è¯Šæ–­

### é—®é¢˜1ï¼šconsensusè®¾è®¡æ··ä¹±
- **ç°çŠ¶**ï¼šconsensusæ˜¯5ä¸ªæŒ‡æ ‡çš„ç®€å•è®¡æ•°ï¼ˆ0-5ï¼‰
- **é—®é¢˜**ï¼š
  - ä¸signal_scoreæœ‰é‡å ï¼ˆå¦‚å¤šå‘¨æœŸè¶‹åŠ¿ï¼‰
  - consensus=0ä¸ä»£è¡¨ä¿¡å·æ— æ•ˆï¼Œåªæ˜¯"æŒ‡æ ‡æœªæç«¯å…±æŒ¯"
  - é«˜signal_score + ä½consensusçš„æœºä¼šå¯èƒ½å¾ˆæœ‰æ•ˆï¼ˆå½¢æ€é©±åŠ¨å‹ï¼‰

### é—®é¢˜2ï¼šä¼˜åŒ–å™¨è¾“å…¥æ•°æ®ä¸ä¸€è‡´
- **ç°çŠ¶**ï¼š
  - æ•°æ®æºï¼š`export_historical_data.py`ç”Ÿæˆå¿«ç…§
  - consensusï¼šåœ¨å¿«ç…§æ—¶è®¡ç®—ï¼ˆ5ç»´ï¼‰
  - signal_scoreï¼šåœ¨å¿«ç…§æ—¶è®¡ç®—ï¼ˆå¤šç»´ï¼‰
  - actual_profitï¼šåœ¨`calculate_actual_profit.py`ä¸­äº‹åè®¡ç®—
- **é—®é¢˜**ï¼š
  - å¿«ç…§ç”Ÿæˆæ—¶consensuså¯èƒ½ä¸º0
  - ä½†è¿™äº›æœºä¼šçš„actual_profitå¯èƒ½ä¸ºæ­£
  - ä¼˜åŒ–å™¨ç”¨`min_consensus>=1`è¿‡æ»¤æ‰äº†å®ƒä»¬

### é—®é¢˜3ï¼šåˆ†ç¦»ä¼˜åŒ–çš„è¾¹ç•Œä¸æ¸…
- **ç°çŠ¶**ï¼šè¶…çŸ­çº¿å’Œæ³¢æ®µåˆ†ç¦»ä¼˜åŒ–ï¼ˆåˆç†ï¼‰
- **é—®é¢˜**ï¼šä¸¤è€…å…±äº«åŸºç¡€è¿‡æ»¤å‚æ•°ï¼ˆsignal_score, consensusï¼‰ï¼Œä½†è¿™äº›å‚æ•°å¯èƒ½åº”è¯¥ç‹¬ç«‹

---

## âœ… å…¨å±€é‡æ„æ–¹æ¡ˆï¼ˆV8.4ï¼‰

### æ ¸å¿ƒåŸåˆ™
1. **æ•°æ®é©±åŠ¨**ï¼šè®©actual_profitæ•°æ®æŒ‡å¯¼è¿‡æ»¤é€»è¾‘ï¼Œè€Œä¸æ˜¯ä¸»è§‚è®¾å®šé˜ˆå€¼
2. **ä¿¡å·åˆ†ç±»**ï¼šæ‰¿è®¤ä¸¤ç§æœ‰æ•ˆä¿¡å·ç±»å‹ï¼ˆå½¢æ€é©±åŠ¨ vs æŒ‡æ ‡é©±åŠ¨ï¼‰
3. **åˆ†å±‚è¿‡æ»¤**ï¼šå¿…é¡»å±‚ï¼ˆæ•è·ç‡ï¼‰+ ç²¾ç»†å±‚ï¼ˆè´¨é‡ï¼‰

---

## ğŸ¯ æ–¹æ¡ˆAï¼šåŒè·¯å¾„è¿‡æ»¤ï¼ˆçŸ­æœŸï¼Œ1-2å¤©å®æ–½ï¼‰

### æ ¸å¿ƒæ€è·¯
æ‰¿è®¤ä¸¤ç§æœ‰æ•ˆä¿¡å·ç±»å‹ï¼Œå…è®¸ä¸¤ç§è¿‡æ»¤è·¯å¾„ï¼š

```python
def passes_filter_v8_4(opp: Dict, params: Dict) -> bool:
    """V8.4åŒè·¯å¾„è¿‡æ»¤"""
    
    # è·¯å¾„1ï¼šå½¢æ€é©±åŠ¨å‹ï¼ˆé«˜signal_score + ä½consensusï¼‰
    # é€‚ç”¨ï¼šçªç ´ã€åè½¬ã€å¼ºæ”¯æ’‘é˜»åŠ›ä½
    path1_pattern_driven = (
        opp['signal_score'] >= params.get('min_signal_score_solo', 80) and
        opp['consensus'] <= 1 and  # å…è®¸ä½consensus
        opp.get('actual_risk_reward', opp.get('risk_reward', 0)) >= params.get('min_risk_reward', 1.5)
    )
    
    # è·¯å¾„2ï¼šæŒ‡æ ‡é©±åŠ¨å‹ï¼ˆä¸­signal_score + é«˜consensusï¼‰
    # é€‚ç”¨ï¼šå¤šæŒ‡æ ‡å…±æŒ¯ç¡®è®¤çš„è¶‹åŠ¿å»¶ç»­
    path2_indicator_driven = (
        opp['signal_score'] >= params.get('min_signal_score_with_consensus', 60) and
        opp['consensus'] >= params.get('min_consensus', 2) and
        opp.get('actual_risk_reward', opp.get('risk_reward', 0)) >= params.get('min_risk_reward', 1.5)
    )
    
    return path1_pattern_driven or path2_indicator_driven
```

### ä¼˜åŒ–å™¨å‚æ•°ç©ºé—´
```python
grid = {
    # è·¯å¾„1å‚æ•°ï¼ˆå½¢æ€é©±åŠ¨ï¼‰
    'min_signal_score_solo': [75, 80, 85],
    
    # è·¯å¾„2å‚æ•°ï¼ˆæŒ‡æ ‡é©±åŠ¨ï¼‰
    'min_signal_score_with_consensus': [60, 65, 70],
    'min_consensus': [2, 3, 4],
    
    # å…±äº«å‚æ•°
    'min_risk_reward': [1.0, 1.5, 2.0],
    'atr_tp_multiplier': [2.0, 3.0, 4.0],
    'atr_stop_multiplier': [1.0, 1.5, 2.0],
    ...
}
```

### ä¼˜ç‚¹
- âœ… è§£å†³consensus=0è¢«è¿‡æ»¤çš„é—®é¢˜
- âœ… æ‰¿è®¤ä¸¤ç§æœ‰æ•ˆä¿¡å·ç±»å‹
- âœ… å¿«é€Ÿå®æ–½ï¼ˆä¿®æ”¹è¿‡æ»¤å‡½æ•°å³å¯ï¼‰

### ç¼ºç‚¹
- âš ï¸ å‚æ•°ç©ºé—´å˜å¤§ï¼ˆ11ç»´ â†’ 13ç»´ï¼‰
- âš ï¸ æ²¡æœ‰æ ¹æœ¬è§£å†³consensusè®¾è®¡é—®é¢˜

---

## ğŸ¯ æ–¹æ¡ˆBï¼šé‡æ„consensusä¸ºåŠ æƒç¡®è®¤åº¦ï¼ˆä¸­æœŸï¼Œ3-5å¤©å®æ–½ï¼‰

### æ ¸å¿ƒæ€è·¯
å°†consensusä»"è®¡æ•°å™¨"æ”¹ä¸º"åŠ æƒè¯„åˆ†"ï¼ˆ0-100åˆ†ï¼‰

### æ–°consensusè®¡ç®—é€»è¾‘

```python
def calculate_consensus_score_v8_4(row: pd.Series, full_df: pd.DataFrame, position: int) -> int:
    """
    ã€V8.4ã€‘è®¡ç®—ç»¼åˆç¡®è®¤åº¦è¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰
    
    ç»´åº¦åˆ†ç±»ï¼š
    - æŒ‡æ ‡ç¡®è®¤ï¼ˆ40åˆ†ï¼‰ï¼šEMAã€MACDã€RSIã€æˆäº¤é‡
    - è¶‹åŠ¿ç¡®è®¤ï¼ˆ30åˆ†ï¼‰ï¼šå¤šå‘¨æœŸè¶‹åŠ¿ä¸€è‡´æ€§
    - å½¢æ€ç¡®è®¤ï¼ˆ30åˆ†ï¼‰ï¼šä»·æ ¼å½¢æ€ã€Kçº¿ç»“æ„ã€æ”¯æ’‘é˜»åŠ›
    """
    score = 0
    
    # === æŒ‡æ ‡ç¡®è®¤å±‚ï¼ˆ40åˆ†ï¼‰ ===
    # 1. EMAå‘æ•£ï¼ˆ10åˆ†ï¼‰
    ema20 = row.ema_20
    ema50 = row.ema_50
    if ema20 > 0 and ema50 > 0:
        divergence = abs(ema20 - ema50) / ema50 * 100
        if divergence >= 5.0:
            score += 10  # å¼ºå‘æ•£
        elif divergence >= 2.0:
            score += 5   # ä¸­å‘æ•£
    
    # 2. MACDå¼ºåº¦ï¼ˆ10åˆ†ï¼‰
    macd_hist = row.macd_histogram if pd.notna(row.macd_histogram) else 0
    if abs(macd_hist) >= 0.05:
        score += 10  # å¼ºä¿¡å·
    elif abs(macd_hist) >= 0.01:
        score += 5   # ä¸­ä¿¡å·
    
    # 3. RSIæç«¯å€¼ï¼ˆ10åˆ†ï¼‰
    rsi = row.rsi_14 if pd.notna(row.rsi_14) else 50
    if rsi > 75 or rsi < 25:
        score += 10  # è¶…å¼ºæç«¯
    elif rsi > 70 or rsi < 30:
        score += 7   # å¼ºæç«¯
    elif 45 <= rsi <= 55:
        score += 3   # ä¸­æ€§ï¼ˆè½»å¾®åŠ åˆ†ï¼‰
    
    # 4. æˆäº¤é‡æ”¾é‡ï¼ˆ10åˆ†ï¼‰
    if position >= 20:
        recent_avg_vol = full_df.iloc[max(0, position-20):position]['volume'].mean()
        if recent_avg_vol > 0:
            vol_ratio = row.volume / recent_avg_vol
            if vol_ratio >= 2.0:
                score += 10  # å¼ºæ”¾é‡
            elif vol_ratio >= 1.5:
                score += 5   # ä¸­æ”¾é‡
    
    # === è¶‹åŠ¿ç¡®è®¤å±‚ï¼ˆ30åˆ†ï¼‰ ===
    # 5. å¤šå‘¨æœŸè¶‹åŠ¿ä¸€è‡´æ€§ï¼ˆ30åˆ†ï¼‰
    is_all_bullish = ("å¤šå¤´" in str(row.trend_15m) and 
                      "å¤šå¤´" in str(row.trend_1h) and 
                      "å¤šå¤´" in str(row.trend_4h))
    is_all_bearish = ("ç©ºå¤´" in str(row.trend_15m) and 
                      "ç©ºå¤´" in str(row.trend_1h) and 
                      "ç©ºå¤´" in str(row.trend_4h))
    
    if is_all_bullish or is_all_bearish:
        score += 30  # ä¸‰å±‚å¯¹é½
    elif ("å¤šå¤´" in str(row.trend_1h) and "å¤šå¤´" in str(row.trend_4h)) or \
         ("ç©ºå¤´" in str(row.trend_1h) and "ç©ºå¤´" in str(row.trend_4h)):
        score += 15  # ä¸¤å±‚å¯¹é½
    
    # === å½¢æ€ç¡®è®¤å±‚ï¼ˆ30åˆ†ï¼‰ ===
    # 6. ä»·æ ¼å½¢æ€å¼ºåº¦ï¼ˆ15åˆ†ï¼‰
    # ä»signal_scoreçš„å½¢æ€ç»´åº¦æå–
    # å¦‚ï¼špin_bar_score, engulfing_score, breakout_score
    pattern_score = 0
    if hasattr(row, 'pin_bar_score'):
        pattern_score += min(5, row.pin_bar_score / 20)  # æœ€å¤š5åˆ†
    if hasattr(row, 'engulfing_score'):
        pattern_score += min(5, row.engulfing_score / 20)
    if hasattr(row, 'breakout_score'):
        pattern_score += min(5, row.breakout_score / 20)
    score += int(pattern_score)
    
    # 7. Kçº¿åºåˆ—ä¸€è‡´æ€§ï¼ˆ10åˆ†ï¼‰
    # æ£€æŸ¥æœ€è¿‘3-5æ ¹Kçº¿çš„æ–¹å‘ä¸€è‡´æ€§
    if position >= 3:
        recent_closes = full_df.iloc[position-3:position+1]['close'].values
        if len(recent_closes) >= 3:
            is_bullish_seq = all(recent_closes[i] < recent_closes[i+1] 
                                for i in range(len(recent_closes)-1))
            is_bearish_seq = all(recent_closes[i] > recent_closes[i+1] 
                                for i in range(len(recent_closes)-1))
            if is_bullish_seq or is_bearish_seq:
                score += 10
            elif (recent_closes[-1] > recent_closes[-2]) or \
                 (recent_closes[-1] < recent_closes[-2]):
                score += 5
    
    # 8. æ”¯æ’‘é˜»åŠ›æ˜ç¡®æ€§ï¼ˆ5åˆ†ï¼‰
    support = row.support if pd.notna(row.support) else 0
    resistance = row.resistance if pd.notna(row.resistance) else 0
    if support > 0 and resistance > 0:
        sr_gap = abs(resistance - support) / row.close * 100
        if sr_gap >= 3.0:
            score += 5  # æ”¯æ’‘é˜»åŠ›æ˜ç¡®
        elif sr_gap >= 1.5:
            score += 3
    
    return min(100, score)  # æœ€å¤š100åˆ†
```

### ä¼˜åŒ–å™¨ä½¿ç”¨æ–¹å¼

```python
def passes_filter_v8_4_consensus_score(opp: Dict, params: Dict) -> bool:
    """V8.4ä½¿ç”¨consensus_scoreï¼ˆ0-100ï¼‰"""
    return (
        opp['signal_score'] >= params.get('min_signal_score', 60) and
        opp['consensus_score'] >= params.get('min_consensus_score', 30) and  # æ–°å­—æ®µ
        opp.get('actual_risk_reward', opp.get('risk_reward', 0)) >= params.get('min_risk_reward', 1.5)
    )

# å‚æ•°ç©ºé—´
grid = {
    'min_signal_score': [50, 60, 70, 80],
    'min_consensus_score': [20, 30, 40, 50],  # 0-100åˆ†
    'min_risk_reward': [1.0, 1.5, 2.0],
    ...
}
```

### ä¼˜ç‚¹
- âœ… consensusæ›´ç§‘å­¦ã€æ›´å…¨é¢
- âœ… è§£å†³äº†consensus=0çš„åˆç†æ€§é—®é¢˜ï¼ˆåˆ†æ•°ä½ä½†ä¸ä¸º0ï¼‰
- âœ… é¿å…"å½¢æ€å¼ºä½†æŒ‡æ ‡å¼±"è¢«è¿‡æ»¤

### ç¼ºç‚¹
- âš ï¸ éœ€è¦ä¿®æ”¹`export_historical_data.py`ï¼ˆé‡æ–°ç”Ÿæˆå¿«ç…§ï¼‰
- âš ï¸ éœ€è¦é‡æ–°å¯¼å‡ºå†å²æ•°æ®ï¼ˆ14å¤©ï¼‰
- âš ï¸ å®æ–½å‘¨æœŸè¾ƒé•¿

---

## ğŸ¯ æ–¹æ¡ˆCï¼šä¿¡å·è´¨é‡ç»¼åˆè¯„åˆ†ï¼ˆé•¿æœŸï¼Œ1-2å‘¨å®æ–½ï¼‰

### æ ¸å¿ƒæ€è·¯
å½»åº•åºŸå¼ƒconsensusï¼Œå°†å…¶èå…¥signal_scoreï¼Œåˆ›å»º**å•ä¸€ç»¼åˆè¯„åˆ†**ã€‚

### æ–°signal_scoreè®¡ç®—ï¼ˆ0-100åˆ†ï¼‰

```python
def calculate_unified_signal_score_v8_4(row, full_df, position) -> Dict:
    """
    ã€V8.4ã€‘ç»Ÿä¸€ä¿¡å·è¯„åˆ†ï¼ˆæ•´åˆåŸsignal_score + consensusï¼‰
    
    è¯„åˆ†ç»´åº¦ï¼ˆ100åˆ†ï¼‰ï¼š
    - è¶‹åŠ¿å¼ºåº¦ï¼ˆ25åˆ†ï¼‰
    - æŒ‡æ ‡ç¡®è®¤ï¼ˆ25åˆ†ï¼‰
    - ä»·æ ¼å½¢æ€ï¼ˆ25åˆ†ï¼‰
    - æ”¯æ’‘é˜»åŠ›ï¼ˆ15åˆ†ï¼‰
    - æˆäº¤é‡ï¼ˆ10åˆ†ï¼‰
    """
    score = 0
    details = {}
    
    # 1. è¶‹åŠ¿å¼ºåº¦ï¼ˆ25åˆ†ï¼‰
    # ... (åŸsignal_scoreçš„trend_alignment_score + æ–°å¢çš„å¤šå‘¨æœŸä¸€è‡´æ€§)
    
    # 2. æŒ‡æ ‡ç¡®è®¤ï¼ˆ25åˆ†ï¼‰
    # ... (åŸconsensusçš„EMAã€MACDã€RSI)
    
    # 3. ä»·æ ¼å½¢æ€ï¼ˆ25åˆ†ï¼‰
    # ... (åŸsignal_scoreçš„pin_barã€engulfingã€breakout)
    
    # 4. æ”¯æ’‘é˜»åŠ›ï¼ˆ15åˆ†ï¼‰
    # ... (åŸsignal_scoreçš„R:Rç›¸å…³)
    
    # 5. æˆäº¤é‡ï¼ˆ10åˆ†ï¼‰
    # ... (åŸconsensusçš„æˆäº¤é‡æ”¾é‡)
    
    return {
        'signal_score': score,
        'details': details,
        'signal_type': 'scalping' or 'swing'
    }
```

### ä¼˜åŒ–å™¨ä½¿ç”¨æ–¹å¼

```python
def passes_filter_v8_4_unified(opp: Dict, params: Dict) -> bool:
    """V8.4ç»Ÿä¸€è¯„åˆ†è¿‡æ»¤"""
    return (
        opp['signal_score'] >= params.get('min_signal_score', 60) and
        opp.get('actual_risk_reward', opp.get('risk_reward', 0)) >= params.get('min_risk_reward', 1.5)
    )

# å‚æ•°ç©ºé—´ï¼ˆç®€åŒ–ï¼‰
grid = {
    'min_signal_score': [50, 60, 70, 80, 85],  # 0-100åˆ†
    'min_risk_reward': [1.0, 1.5, 2.0, 2.5],
    ...
}
```

### ä¼˜ç‚¹
- âœ… æœ€å½»åº•çš„ç®€åŒ–
- âœ… é¿å…é‡å¤è¯„ä¼°ï¼ˆæ— consensus vs signal_scoreé‡å ï¼‰
- âœ… å•ä¸€è¯„åˆ†ä½“ç³»ï¼Œæ›´æ˜“ç†è§£å’Œä¼˜åŒ–

### ç¼ºç‚¹
- âš ï¸ éœ€è¦å®Œå…¨é‡æ„è¯„åˆ†é€»è¾‘
- âš ï¸ éœ€è¦é‡æ–°è®­ç»ƒ/è°ƒæ•´æƒé‡
- âš ï¸ å®æ–½å‘¨æœŸæœ€é•¿

---

## ğŸ¯ æ¨èå®æ–½è·¯å¾„

### é˜¶æ®µ1ï¼šç«‹å³ä¿®å¤ï¼ˆä»Šå¤©ï¼‰
**é‡‡ç”¨æ–¹æ¡ˆAå‰ç½®ç‰ˆ**ï¼šåœ¨ä¼˜åŒ–å™¨ä¸­å…ˆå…è®¸`min_consensus=0`ï¼Œè§‚å¯Ÿæ•ˆæœã€‚

```python
# ä¿®æ”¹backtest_optimizer_v8321.pyçš„å‚æ•°ç½‘æ ¼
'min_consensus': [0, 1, 2]  # âœ… å·²å®Œæˆ
```

### é˜¶æ®µ2ï¼šçŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
**é‡‡ç”¨æ–¹æ¡ˆAå®Œæ•´ç‰ˆ**ï¼šå®ç°åŒè·¯å¾„è¿‡æ»¤ã€‚

ä¿®æ”¹æ–‡ä»¶ï¼š
- `ds/backtest_optimizer_v8321.py`ï¼šä¿®æ”¹`passes_basic_filter`ä¸ºåŒè·¯å¾„
- å‚æ•°ç©ºé—´å¢åŠ è·¯å¾„1å’Œè·¯å¾„2çš„ç‹¬ç«‹å‚æ•°

### é˜¶æ®µ3ï¼šä¸­æœŸé‡æ„ï¼ˆ3-5å¤©ï¼‰
**é‡‡ç”¨æ–¹æ¡ˆB**ï¼šé‡æ„consensusä¸ºåŠ æƒè¯„åˆ†ã€‚

ä¿®æ”¹æ–‡ä»¶ï¼š
- `ds/export_historical_data.py`ï¼šä¿®æ”¹consensusè®¡ç®—é€»è¾‘
- é‡æ–°å¯¼å‡º14å¤©å†å²æ•°æ®
- æ›´æ–°ä¼˜åŒ–å™¨ä½¿ç”¨æ–°çš„`consensus_score`

### é˜¶æ®µ4ï¼šé•¿æœŸæ¶æ„ï¼ˆ1-2å‘¨ï¼‰
**é‡‡ç”¨æ–¹æ¡ˆC**ï¼šç»Ÿä¸€signal_scoreã€‚

ä¿®æ”¹æ–‡ä»¶ï¼š
- `ds/export_historical_data.py`ï¼šå®Œå…¨é‡æ„è¯„åˆ†ç³»ç»Ÿ
- åºŸå¼ƒconsensuså­—æ®µ
- é‡æ–°è®­ç»ƒæƒé‡
- æ›´æ–°æ‰€æœ‰ç›¸å…³æ¨¡å—

---

## ğŸ“Š å…³é”®å†³ç­–çŸ©é˜µ

| æ–¹æ¡ˆ | å®æ–½éš¾åº¦ | å®æ–½å‘¨æœŸ | æ•ˆæœ | é£é™© | æ¨èä¼˜å…ˆçº§ |
|------|---------|---------|------|------|-----------|
| A - åŒè·¯å¾„ | â­â­ | 1-2å¤© | â­â­â­ | ä½ | **é«˜** |
| B - é‡æ„consensus | â­â­â­â­ | 3-5å¤© | â­â­â­â­ | ä¸­ | ä¸­ |
| C - ç»Ÿä¸€è¯„åˆ† | â­â­â­â­â­ | 1-2å‘¨ | â­â­â­â­â­ | é«˜ | ä½ |

---

## âœ… ç«‹å³è¡ŒåŠ¨ï¼šå…ˆéªŒè¯æ–¹æ¡ˆAçš„å‰ç½®æ¡ä»¶

å½“å‰å·²å®Œæˆï¼š
- âœ… å…è®¸`min_consensus=0`
- âœ… æ”¾å®½ç¡¬çº¦æŸï¼ˆå…è®¸è´Ÿåˆ©æ¶¦é…ç½®è·å¾—ä½åˆ†ï¼‰

**ä¸‹ä¸€æ­¥**ï¼š
1. è¿è¡Œå›æµ‹ï¼Œè§‚å¯Ÿ`consensus=0`çš„æœºä¼šæ˜¯å¦è¢«æ•è·
2. æ£€æŸ¥è¿™äº›æœºä¼šçš„`actual_profit_pct`åˆ†å¸ƒ
3. å¦‚æœæ•ˆæœå¥½ â†’ ç»§ç»­æ–¹æ¡ˆAå®Œæ•´ç‰ˆ
4. å¦‚æœæ•ˆæœä¸€èˆ¬ â†’ ç›´æ¥è·³åˆ°æ–¹æ¡ˆB

---

## ğŸ¯ æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§

### å…³é”®æŒ‡æ ‡
1. **æ•è·ç‡**ï¼šç›®æ ‡ä»0%æå‡åˆ°15-25%
2. **å¹³å‡åˆ©æ¶¦**ï¼šç›®æ ‡ä»è´Ÿå€¼è½¬æ­£ï¼ˆ>0.5%ï¼‰
3. **consensus=0çš„å æ¯”**ï¼šäº†è§£æœ‰å¤šå°‘æœºä¼šä¹‹å‰è¢«é”™è¯¯è¿‡æ»¤
4. **è·¯å¾„1 vs è·¯å¾„2çš„æ•ˆæœå¯¹æ¯”**ï¼ˆæ–¹æ¡ˆAï¼‰

### æˆåŠŸæ ‡å‡†
- è¶…çŸ­çº¿ï¼šæ•è·ç‡â‰¥15%ï¼Œå¹³å‡åˆ©æ¶¦â‰¥1.0%
- æ³¢æ®µï¼šæ•è·ç‡â‰¥10%ï¼Œå¹³å‡åˆ©æ¶¦â‰¥2.0%
- æ•´ä½“ï¼šä¼˜åŒ–å™¨è¾“å‡ºä¸ºæ­£

---

## ğŸ’¡ å…³é”®æ´å¯Ÿ

1. **consensusä¸æ˜¯ä¿¡å·è´¨é‡çš„å”¯ä¸€æ ‡å‡†**
   - å½¢æ€å¼ºä½†æŒ‡æ ‡å¼±çš„æœºä¼šå¯èƒ½å¾ˆæœ‰æ•ˆ
   - ä¸åº”è¯¥ç”¨ç¡¬æ€§`min_consensus>=1`è¿‡æ»¤

2. **æ•°æ®é©±åŠ¨ > ä¸»è§‚ç»éªŒ**
   - è®©`actual_profit_pct`æŒ‡å¯¼è¿‡æ»¤é€»è¾‘
   - ä¼˜åŒ–å™¨åº”è¯¥æµ‹è¯•æ‰€æœ‰å¯èƒ½æ€§

3. **åˆ†å±‚è®¾è®¡å¾ˆé‡è¦**
   - å¿…é¡»å±‚ï¼šç¡®ä¿æ•è·ç‡ï¼ˆå®½æ¾ï¼‰
   - ç²¾ç»†å±‚ï¼šæå‡ä¿¡å·è´¨é‡ï¼ˆä¸¥æ ¼ä½†å¤šè·¯å¾„ï¼‰

