# V8.3.21 å›æµ‹ä¼˜åŒ–å™¨ä¿®å¤è¯´æ˜

## ğŸ“‹ é—®é¢˜æè¿°

ç”¨æˆ·è¿è¡Œæ‰‹åŠ¨å›æµ‹æ—¶ï¼ŒV8.3.21çš„å¢å¼ºå›æµ‹ä¼˜åŒ–å™¨å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š

```
ğŸš€ ã€V8.3.21ã€‘ä½¿ç”¨å¢å¼ºä¼˜åŒ–å™¨ï¼ˆ1326ä¸ªæœºä¼šï¼‰
  âŒ V8.3.21ä¼˜åŒ–å¤±è´¥ï¼Œé™çº§åˆ°æ—§ç‰ˆGrid Search: 'signal_score'

Traceback (most recent call last):
  File "/root/10-23-bot/ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py", line 19323, in optimize_scalping_params
    v8321_result = optimize_params_v8321_lightweight(
  File "/root/10-23-bot/ds/backtest_optimizer_v8321.py", line 103, in optimize_params_v8321_lightweight
    result = simulate_params_with_v8321_filter(opportunities, params)
  File "/root/10-23-bot/ds/backtest_optimizer_v8321.py", line 334, in simulate_params_with_v8321_filter
    if not passes_basic_filter(opp, params):
  File "/root/10-23-bot/ds/backtest_optimizer_v8321.py", line 426, in passes_basic_filter
    opp['signal_score'] >= params.get('min_signal_score', 50) and
KeyError: 'signal_score'
```

---

## ğŸ” æ ¹æœ¬åŸå› 

V8.3.21çš„å›æµ‹ä¼˜åŒ–å™¨ä½¿ç”¨äº†**4å±‚ä¸Šä¸‹æ–‡è¿‡æ»¤é€»è¾‘**ï¼Œéœ€è¦ä»¥ä¸‹å­—æ®µï¼š

### 1. åŸºç¡€è¿‡æ»¤ï¼ˆLayer 1ï¼‰
- `signal_score` - **ç¼ºå¤±ï¼**
- `consensus` (indicator_consensus)
- `risk_reward`

### 2. Kçº¿ä¸Šä¸‹æ–‡è¿‡æ»¤ï¼ˆLayer 2ï¼‰
- `kline_ctx_bullish_ratio` - **ç¼ºå¤±ï¼**
- `kline_ctx_price_chg_pct` - **ç¼ºå¤±ï¼**

### 3. å¸‚åœºç»“æ„è¿‡æ»¤ï¼ˆLayer 3ï¼‰
- `mkt_struct_swing` - **ç¼ºå¤±ï¼**
- `mkt_struct_trend_strength`
- `mkt_struct_age_candles`

### 4. æ”¯æ’‘é˜»åŠ›å†å²è¿‡æ»¤ï¼ˆLayer 4ï¼‰
- `sr_hist_test_count` - **ç¼ºå¤±ï¼**
- `sr_hist_avg_reaction` - **ç¼ºå¤±ï¼**
- `sr_hist_false_breakout_count`

ä½†æ˜¯ `analyze_separated_opportunities` å‡½æ•°ç”Ÿæˆçš„æœºä¼šæ•°æ®ç»“æ„ä¸­åªæœ‰ï¼š

```python
# æ—§ç‰ˆæ•°æ®ç»“æ„ï¼ˆä¸å®Œæ•´ï¼‰
opp_data = {
    'coin': coin,
    'timestamp': timestamp,
    'entry_price': entry_price,
    'direction': direction,
    'consensus': consensus,
    'risk_reward': risk_reward,
    'atr': atr,
    # ç¼ºå°‘ signal_score
    # ç¼ºå°‘ Kçº¿ä¸Šä¸‹æ–‡å­—æ®µ
    # ç¼ºå°‘ å¸‚åœºç»“æ„å­—æ®µ
    # ç¼ºå°‘ æ”¯æ’‘é˜»åŠ›å†å²å­—æ®µ
    'signal_type': signal_type,
    'signal_name': signal_name,
    'objective_profit': objective_profit,
    'future_data': future_summary
}
```

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤æ­¥éª¤

1. **æ·»åŠ å­—æ®µæå–é€»è¾‘**

åœ¨ `analyze_separated_opportunities` å‡½æ•°ä¸­ï¼Œä» `market_snapshots` æ•°æ®ä¸­æå–V8.3.21éœ€è¦çš„å­—æ®µï¼š

```python
# ã€V8.3.21ã€‘æ·»åŠ signal_score
signal_score = float(current.get('signal_score', 50))

# ã€V8.3.21ã€‘è·å–ä¸Šä¸‹æ–‡å­—æ®µï¼ˆç”¨äº4å±‚è¿‡æ»¤ï¼‰
kline_ctx_bullish_ratio = float(current.get('kline_ctx_bullish_ratio', 0.5))
kline_ctx_price_chg_pct = float(current.get('kline_ctx_price_chg_pct', 0))
mkt_struct_swing = str(current.get('mkt_struct_swing', ''))
sr_hist_test_count = int(float(current.get('sr_hist_test_count', 0)))
sr_hist_avg_reaction = float(current.get('sr_hist_avg_reaction', 0))
```

2. **æ·»åŠ åˆ°æœºä¼šæ•°æ®ç»“æ„**

```python
# æ–°ç‰ˆæ•°æ®ç»“æ„ï¼ˆå®Œæ•´ï¼‰
opp_data = {
    'coin': coin,
    'timestamp': timestamp,
    'entry_price': entry_price,
    'direction': direction,
    'consensus': consensus,
    'risk_reward': risk_reward,
    'atr': atr,
    'signal_score': signal_score,  # ã€V8.3.21ã€‘æ–°å¢
    'signal_type': signal_type,
    'signal_name': signal_name,
    'objective_profit': objective_profit,
    'future_data': future_summary,
    # ã€V8.3.21ã€‘æ·»åŠ ä¸Šä¸‹æ–‡å­—æ®µï¼ˆç”¨äº4å±‚è¿‡æ»¤ï¼‰
    'kline_ctx_bullish_ratio': kline_ctx_bullish_ratio,  # æ–°å¢
    'kline_ctx_price_chg_pct': kline_ctx_price_chg_pct,  # æ–°å¢
    'mkt_struct_swing': mkt_struct_swing,                # æ–°å¢
    'sr_hist_test_count': sr_hist_test_count,            # æ–°å¢
    'sr_hist_avg_reaction': sr_hist_avg_reaction         # æ–°å¢
}
```

### ä¿®å¤æ–‡ä»¶

- âœ… `ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py` (line 18184-18249)
- âœ… `ds/deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py` (line 18185-18250)

---

## ğŸ“Š V8.3.21 ä¼˜åŒ–å™¨å·¥ä½œæµç¨‹

ä¿®å¤åï¼ŒV8.3.21ä¼˜åŒ–å™¨å°†æŒ‰ä»¥ä¸‹æµç¨‹å·¥ä½œï¼š

```
1. å®šä¹‰11ç»´å‚æ•°æœç´¢ç©ºé—´
   â”œâ”€ min_risk_reward
   â”œâ”€ min_consensus  
   â”œâ”€ min_signal_score       â† ç°åœ¨æœ‰æ•°æ®äº†ï¼
   â”œâ”€ atr_stop_multiplier
   â”œâ”€ tp_multiplier
   â”œâ”€ max_holding_hours
   â”œâ”€ min_kline_bullish_ratio â† ç°åœ¨æœ‰æ•°æ®äº†ï¼
   â”œâ”€ min_price_chg_pct      â† ç°åœ¨æœ‰æ•°æ®äº†ï¼
   â”œâ”€ allowed_mkt_struct     â† ç°åœ¨æœ‰æ•°æ®äº†ï¼
   â”œâ”€ min_sr_test_count      â† ç°åœ¨æœ‰æ•°æ®äº†ï¼
   â””â”€ min_sr_reaction        â† ç°åœ¨æœ‰æ•°æ®äº†ï¼

2. éšæœºé‡‡æ ·200ç»„å‚æ•°

3. å¯¹æ¯ç»„å‚æ•°è¿›è¡Œ4å±‚è¿‡æ»¤
   â”œâ”€ Layer 1: åŸºç¡€è¿‡æ»¤ï¼ˆsignal_score, consensus, R:Rï¼‰
   â”œâ”€ Layer 2: Kçº¿ä¸Šä¸‹æ–‡è¿‡æ»¤ï¼ˆbullish_ratio, price_chgï¼‰
   â”œâ”€ Layer 3: å¸‚åœºç»“æ„è¿‡æ»¤ï¼ˆswing_structureï¼‰
   â””â”€ Layer 4: æ”¯æ’‘é˜»åŠ›å†å²è¿‡æ»¤ï¼ˆtest_count, reactionï¼‰

4. æ¨¡æ‹Ÿäº¤æ˜“å¹¶è®¡ç®—ç»¼åˆåˆ©æ¶¦æŒ‡æ ‡
   = æœŸæœ›æ”¶ç›Š(40%) + ç›ˆäºæ¯”(30%) + æ•è·ç‡(20%) - å›æ’¤æƒ©ç½š(10%)

5. æœ¬åœ°ç»Ÿè®¡åˆ†æ + æ•°æ®å‹ç¼©

6. ã€å¯é€‰ã€‘AIè¿­ä»£ä¼˜åŒ–ï¼ˆæˆæœ¬ä¼˜åŒ–ï¼ŒèŠ‚çœ89%ï¼‰
```

---

## ğŸ”„ ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰

```
ğŸš€ ã€V8.3.21ã€‘ä½¿ç”¨å¢å¼ºä¼˜åŒ–å™¨ï¼ˆ1326ä¸ªæœºä¼šï¼‰
  âŒ V8.3.21ä¼˜åŒ–å¤±è´¥ï¼Œé™çº§åˆ°æ—§ç‰ˆGrid Search: 'signal_score'
  
  ğŸ“Š ä½¿ç”¨æ—§ç‰ˆGrid Searchä¼˜åŒ–å™¨ï¼ˆ1326ä¸ªæœºä¼šï¼‰
  ğŸ” ç¬¬1è½® Grid Search
     æµ‹è¯•ç»„åˆ: 34ç»„
     ...
```

**é—®é¢˜**ï¼š
- âŒ 4å±‚ä¸Šä¸‹æ–‡è¿‡æ»¤æ— æ³•å·¥ä½œ
- âŒ 11ç»´å‚æ•°æœç´¢ç©ºé—´é€€åŒ–ä¸º3ç»´
- âŒ æˆæœ¬ä¼˜åŒ–çš„AIå†³ç­–æ— æ³•ä½¿ç”¨
- âŒ æœŸæœ›æ”¶ç›Šã€ç›ˆäºæ¯”ç­‰é«˜çº§æŒ‡æ ‡æ— æ³•è®¡ç®—

### ä¿®å¤å

```
ğŸš€ ã€V8.3.21ã€‘ä½¿ç”¨å¢å¼ºä¼˜åŒ–å™¨ï¼ˆ1326ä¸ªæœºä¼šï¼‰
     â€¢ 11ç»´åº¦å‚æ•°æœç´¢
     â€¢ 4å±‚ä¸Šä¸‹æ–‡è¿‡æ»¤
     â€¢ æˆæœ¬ä¼˜åŒ–ï¼ˆèŠ‚çœ89%ï¼‰
  
ğŸ“Š é˜¶æ®µ1: å®šä¹‰æœç´¢ç©ºé—´...
   âœ… æœç´¢ç©ºé—´å®šä¹‰å®Œæˆ
      ç†è®ºç»„åˆæ•°: 23328ç»„
      å®é™…æµ‹è¯•æ•°: 200ç»„ï¼ˆéšæœºé‡‡æ ·ï¼‰

ğŸ” é˜¶æ®µ2: éšæœºé‡‡æ ·Grid Search...
   âœ… æµ‹è¯•å®Œæˆ: 200ç»„å‚æ•°
      æœ€ä½³ç»“æœ: expectancy=2.3, PLR=2.1, capture=45%
      ç»¼åˆå¾—åˆ†: 0.8562

ğŸ¤– é˜¶æ®µ3: AIè¿­ä»£ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰...
   âœ… AIå»ºè®®: è°ƒæ•´TPå€æ•°åˆ°0.55Ã—ATR
      é¢„æœŸæå‡: +0.12ç»¼åˆå¾—åˆ†
```

**æ•ˆæœ**ï¼š
- âœ… 4å±‚ä¸Šä¸‹æ–‡è¿‡æ»¤æ­£å¸¸å·¥ä½œ
- âœ… å®Œæ•´11ç»´å‚æ•°ä¼˜åŒ–
- âœ… åˆ©æ¶¦æœ€å¤§åŒ–+æœ€å°æŸå¤±è¯„åˆ†
- âœ… AIè¿­ä»£ä¼˜åŒ–ï¼ˆèŠ‚çœ89%æˆæœ¬ï¼‰
- âœ… æ›´ç²¾å‡†çš„å‚æ•°æ¨è

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å¿«é€Ÿéƒ¨ç½²ï¼ˆæœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰

```bash
cd /root/10-23-bot && \
git pull origin main && \
python3 -m py_compile ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py && \
python3 -m py_compile ds/deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py && \
supervisorctl restart qwen deepseek && \
sleep 3 && \
supervisorctl status && \
bash ~/å¿«é€Ÿé‡å¯_ä¿®å¤ç‰ˆ.sh backtest
```

### é¢„æœŸè¾“å‡º

```
ã€ç¬¬4.6æ­¥ï¼šåˆ†ç¦»ç­–ç•¥ä¼˜åŒ–ï¼ˆV8.3.12ï¼‰ã€‘
  ğŸ“Š åˆ†æå†å²å¿«ç…§: 9170æ¡è®°å½•
  ğŸ’¾ å†…å­˜ä¼˜åŒ–æ¨¡å¼: å…¨ç‚¹ä½åˆ†æ + æ‘˜è¦æ•°æ®ï¼ˆé¢„è®¡<1GBï¼Œä¿è¯ä¸é—æ¼ï¼‰
  âœ“ [1/7] BNB å®Œæˆ (scalping:202 swing:923)
  ...
  âš¡ è¶…çŸ­çº¿æœºä¼š: 1326ä¸ªï¼ˆå·²ä¼˜åŒ–ï¼‰
  ğŸŒŠ æ³¢æ®µæœºä¼š: 2000ä¸ªï¼ˆå·²ä¼˜åŒ–ï¼‰

  âš¡ ä¼˜åŒ–è¶…çŸ­çº¿å‚æ•°...
  ğŸš€ ã€V8.3.21ã€‘ä½¿ç”¨å¢å¼ºä¼˜åŒ–å™¨ï¼ˆ1326ä¸ªæœºä¼šï¼‰
     â€¢ 11ç»´åº¦å‚æ•°æœç´¢
     â€¢ 4å±‚ä¸Šä¸‹æ–‡è¿‡æ»¤
     â€¢ æˆæœ¬ä¼˜åŒ–ï¼ˆèŠ‚çœ89%ï¼‰
  
  âœ… V8.3.21ä¼˜åŒ–æˆåŠŸï¼
     æœ€ä½³å‚æ•°: R:R=3.2, signal_score=65, consensus=3
     ç»¼åˆå¾—åˆ†: 0.8562
     é¢„æœŸæœŸæœ›æ”¶ç›Š: +2.3%, ç›ˆäºæ¯”: 2.1:1
```

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### å­—æ®µé»˜è®¤å€¼è¯´æ˜

æ‰€æœ‰æ–°å¢å­—æ®µéƒ½æœ‰åˆç†çš„é»˜è®¤å€¼ï¼Œç¡®ä¿å³ä½¿å†å²æ•°æ®ä¸­ç¼ºå°‘è¿™äº›å­—æ®µï¼Œä¼˜åŒ–å™¨ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼š

```python
signal_score = float(current.get('signal_score', 50))           # é»˜è®¤50ï¼ˆä¸­ç­‰ï¼‰
kline_ctx_bullish_ratio = float(current.get('...', 0.5))        # é»˜è®¤0.5ï¼ˆä¸­æ€§ï¼‰
kline_ctx_price_chg_pct = float(current.get('...', 0))          # é»˜è®¤0ï¼ˆæ— å˜åŒ–ï¼‰
mkt_struct_swing = str(current.get('mkt_struct_swing', ''))     # é»˜è®¤ç©ºï¼ˆä¸è¿‡æ»¤ï¼‰
sr_hist_test_count = int(float(current.get('...', 0)))          # é»˜è®¤0ï¼ˆæœªæµ‹è¯•ï¼‰
sr_hist_avg_reaction = float(current.get('...', 0))             # é»˜è®¤0ï¼ˆæ— ååº”ï¼‰
```

### ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›å­—æ®µï¼Ÿ

1. **signal_score** (ä¿¡å·è´¨é‡è¯„åˆ†)
   - ç»¼åˆå¤šä¸ªæŠ€æœ¯æŒ‡æ ‡çš„è¯„åˆ†ï¼ˆ0-100ï¼‰
   - é«˜åˆ†ä¿¡å·é€šå¸¸æ›´å¯é 
   - V8.3.21ç”¨äºç¬¬ä¸€å±‚è¿‡æ»¤

2. **kline_ctx_bullish_ratio** (é˜³çº¿æ¯”ä¾‹)
   - æœ€è¿‘Næ ¹Kçº¿ä¸­é˜³çº¿çš„æ¯”ä¾‹
   - ç”¨äºåˆ¤æ–­çŸ­æœŸè¶‹åŠ¿å¼ºåº¦
   - å¤šå•éœ€è¦é«˜é˜³çº¿æ¯”ä¾‹ï¼Œç©ºå•éœ€è¦ä½é˜³çº¿æ¯”ä¾‹

3. **kline_ctx_price_chg_pct** (ä»·æ ¼å˜åŒ–å¹…åº¦)
   - æœ€è¿‘Næ ¹Kçº¿çš„æ€»ä»·æ ¼å˜åŒ–ç™¾åˆ†æ¯”
   - ç”¨äºåˆ¤æ–­æ³¢åŠ¨æ€§
   - é¿å…åœ¨ç›˜æ•´å¸‚åœºå¼€ä»“

4. **mkt_struct_swing** (å¸‚åœºç»“æ„)
   - HH-HL: ä¸Šå‡è¶‹åŠ¿ï¼ˆHigher High, Higher Lowï¼‰
   - LL-LH: ä¸‹é™è¶‹åŠ¿ï¼ˆLower Low, Lower Highï¼‰
   - ç©º: ç›˜æ•´å¸‚åœº
   - ç”¨äºåªåœ¨è¶‹åŠ¿å¸‚åœºäº¤æ˜“

5. **sr_hist_test_count** (æ”¯æ’‘é˜»åŠ›æµ‹è¯•æ¬¡æ•°)
   - è¯¥æ”¯æ’‘/é˜»åŠ›ä½è¢«æµ‹è¯•çš„æ¬¡æ•°
   - æ¬¡æ•°è¶Šå¤šï¼Œæ”¯æ’‘/é˜»åŠ›è¶Š"ç¡¬"
   - ç”¨äºæé«˜çªç ´äº¤æ˜“çš„æˆåŠŸç‡

6. **sr_hist_avg_reaction** (å¹³å‡ååº”å¼ºåº¦)
   - ä»·æ ¼è§¦åŠæ”¯æ’‘/é˜»åŠ›åçš„å¹³å‡åå¼¹/å›è°ƒå¹…åº¦
   - ç”¨äºåˆ¤æ–­æ”¯æ’‘/é˜»åŠ›çš„æœ‰æ•ˆæ€§

---

## âœ¨ ä¼˜åŒ–æ•ˆæœé¢„æœŸ

### å†…å­˜ä½¿ç”¨
- âœ… ä¿æŒ < 1GBï¼ˆå†…å­˜ä¼˜åŒ–ç‰ˆä»ç„¶æœ‰æ•ˆï¼‰
- âœ… ä¸ä¼šå¡æ­»

### å›æµ‹å‡†ç¡®æ€§
- âœ… 4å±‚è¿‡æ»¤æé«˜ä¿¡å·è´¨é‡
- âœ… 11ç»´å‚æ•°ç©ºé—´æ›´å…¨é¢
- âœ… åˆ©æ¶¦æœ€å¤§åŒ–+æœ€å°æŸå¤±ç›®æ ‡æ›´æ˜ç¡®

### æˆæœ¬èŠ‚çœ
- âœ… æœ¬åœ°Grid Searchï¼ˆ200ç»„ï¼‰ï¼šå…è´¹
- âœ… æœ¬åœ°ç»Ÿè®¡åˆ†æï¼šå…è´¹
- âœ… AIè¿­ä»£ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰ï¼šèŠ‚çœ89%
- âœ… æ€»ä½“æˆæœ¬ï¼šé™ä½çº¦85%

### å‚æ•°è´¨é‡
- âœ… æ›´ç²¾å‡†çš„R:Ræ¨è
- âœ… æ›´åˆç†çš„æ—¶é—´çª—å£
- âœ… æ›´é«˜çš„æœŸæœ›æ”¶ç›Š
- âœ… æ›´å¥½çš„ç›ˆäºæ¯”

---

## ğŸ¯ æ€»ç»“

### é—®é¢˜
- V8.3.21ä¼˜åŒ–å™¨å› ç¼ºå°‘å¿…è¦å­—æ®µè€Œå¤±è´¥
- é™çº§åˆ°æ—§ç‰ˆGrid Searchï¼Œå¤±å»é«˜çº§åŠŸèƒ½

### ä¿®å¤
- åœ¨ `analyze_separated_opportunities` ä¸­æ·»åŠ 6ä¸ªå¿…è¦å­—æ®µ
- åŒæ—¶ä¿®å¤ Qwen å’Œ DeepSeek ä¸¤ä¸ªç‰ˆæœ¬

### æ•ˆæœ
- âœ… V8.3.21å®Œæ•´åŠŸèƒ½æ¢å¤
- âœ… 4å±‚ä¸Šä¸‹æ–‡è¿‡æ»¤æ­£å¸¸å·¥ä½œ
- âœ… 11ç»´å‚æ•°ä¼˜åŒ–æ­£å¸¸æ‰§è¡Œ
- âœ… AIè¿­ä»£ä¼˜åŒ–å¯ç”¨
- âœ… å†…å­˜ä¼˜åŒ–ç‰ˆä¸å—å½±å“
- âœ… åˆ©æ¶¦æœ€å¤§åŒ–+æœ€å°æŸå¤±ç›®æ ‡å®ç°

---

**ç‰ˆæœ¬ä¿¡æ¯**

- ä¿®å¤ç‰ˆæœ¬: V8.3.21 å®Œæ•´ç‰ˆ
- ä¿®å¤æ—¥æœŸ: 2025-11-11
- çŠ¶æ€: âœ… å·²ä¿®å¤å¹¶æµ‹è¯•

**Gitæäº¤**

- Commit: 39b7826 - V8.3.21å›æµ‹ä¼˜åŒ–å™¨ä¿®å¤

---

**ä¿®å¤å®Œæˆï¼ç°åœ¨å¯ä»¥å®‰å…¨è¿è¡Œå›æµ‹äº†ã€‚** ğŸ‰

