#!/bin/bash
# æœåŠ¡å™¨æ—¶åŒºä¿®å¤ - ç»§ç»­æ‰§è¡Œ
# åœ¨æœåŠ¡å™¨ 43.100.52.142 ä¸Šè¿è¡Œ

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "V8.3.21 æ—¶åŒºä¿®å¤ - ç»§ç»­æ‰§è¡Œ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

cd /root/10-23-bot/ds

# æ£€æŸ¥å¹¶å®‰è£…ä¾èµ–
echo "ðŸ“¦ æ­¥éª¤1: æ£€æŸ¥ä¾èµ–"
echo "----------------------------------------"

python3 -c "import pandas" 2>/dev/null
if [ $? -ne 0 ]; then
    echo "âš ï¸  pandasæœªå®‰è£…ï¼Œå°è¯•å®‰è£…..."
    pip3 install pandas -q
    if [ $? -eq 0 ]; then
        echo "âœ… pandaså®‰è£…æˆåŠŸ"
    else
        echo "âŒ pandaså®‰è£…å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ç³»ç»ŸåŒ…ç®¡ç†å™¨"
        apt-get update -qq && apt-get install -y python3-pandas -qq
    fi
fi

python3 -c "import pandas" 2>/dev/null
if [ $? -ne 0 ]; then
    echo "âŒ æ— æ³•å®‰è£…pandasï¼Œè¯·æ‰‹åŠ¨å®‰è£…: pip3 install pandas"
    exit 1
fi

echo "âœ… ä¾èµ–æ£€æŸ¥å®Œæˆ"
echo ""

# æ£€æŸ¥æ•°æ®
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥éª¤2: æ£€æŸ¥æ•°æ®ï¼ˆä¸ä¼šä¿®æ”¹ï¼‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

python3 fix_timezone_data.py --dry-run

if [ $? -ne 0 ]; then
    echo "âŒ æ£€æŸ¥å¤±è´¥"
    exit 1
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# è¯¢é—®æ˜¯å¦ä¿®å¤
read -p "â“ æ˜¯å¦ç»§ç»­ä¿®å¤æ•°æ®ï¼Ÿ(yes/no): " answer

if [ "$answer" != "yes" ]; then
    echo "âŒ å·²å–æ¶ˆä¿®å¤"
    exit 0
fi

# ä¿®å¤æ•°æ®
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥éª¤3: ä¿®å¤æ•°æ®"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

echo "yes" | python3 fix_timezone_data.py

if [ $? -ne 0 ]; then
    echo "âŒ ä¿®å¤å¤±è´¥"
    exit 1
fi

echo "âœ… ä¿®å¤å®Œæˆ"
echo ""

# éªŒè¯
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥éª¤4: éªŒè¯ä¿®å¤ç»“æžœ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

python3 fix_timezone_data.py --dry-run

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… æ—¶åŒºä¿®å¤å®Œæˆï¼"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ðŸ“ å¤‡ä»½æ–‡ä»¶ï¼š"
ls -lh /root/10-23-bot/ds/trading_data/*/*.bak_before_timezone_fix 2>/dev/null
echo ""

