# æœåŠ¡å™¨æ£€æŸ¥å‘½ä»¤

## ğŸ“‹ é—®é¢˜è¯Šæ–­

### é—®é¢˜1ï¼šæŒä»“æ—¶é—´å¼‚å¸¸
**ç°è±¡**ï¼šæ³¢æ®µ0.5h < è¶…çŸ­çº¿0.6hï¼ˆæ³¢æ®µåè€Œæ›´çŸ­ï¼‰  
**è¯Šæ–­**ï¼šå·²æ·»åŠ DEBUGæ—¥å¿—ï¼Œä¸‹æ¬¡å›æµ‹ä¼šè‡ªåŠ¨è¾“å‡º

### é—®é¢˜2ï¼šå…±æŒ¯æŒ‡æ ‡ä¸º0
**ç°è±¡**ï¼šé‚®ä»¶æ˜¾ç¤ºæ‰€æœ‰å…±æŒ¯æŒ‡æ ‡éƒ½æ˜¯0  
**è¯Šæ–­**ï¼šéœ€è¦æ£€æŸ¥å†å²æ•°æ®

---

## ğŸ” æ£€æŸ¥å…±æŒ¯æ•°æ®

### å‘½ä»¤1ï¼šè¿è¡Œè¯Šæ–­è„šæœ¬

```bash
cd ~/10-23-bot/ds
python3 check_consensus_data.py
```

**è¯¥è„šæœ¬ä¼šæ£€æŸ¥**ï¼š
1. âœ… å¸‚åœºå¿«ç…§CSVä¸­çš„indicator_consensuså­—æ®µ
2. âœ… æ˜¨æ—¥è®¢å•CSVä¸­çš„å…±æŒ¯å­—æ®µï¼ˆä¸­æ–‡+è‹±æ–‡ï¼‰
3. âœ… æ˜¾ç¤ºå®é™…æ•°æ®æ ·æœ¬
4. âœ… ç»Ÿè®¡å…±æŒ¯å€¼åˆ†å¸ƒ

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ” å…±æŒ¯æ•°æ®è¯Šæ–­å·¥å…·
======================================================================

ğŸ“Š æ£€æŸ¥1ï¼šå¸‚åœºå¿«ç…§CSVæ–‡ä»¶
----------------------------------------------------------------------
âœ“ æ‰¾åˆ°æ–‡ä»¶: trading_data/deepseek/market_snapshots/kline_snapshots_20251118.csv
  æ€»è¡Œæ•°: 672
  
  å…³é”®å­—æ®µæ£€æŸ¥:
    âœ“ indicator_consensus      : å­˜åœ¨ (éé›¶: 320/672)
    âœ“ trend_15m                : å­˜åœ¨
    âœ“ trend_1h                 : å­˜åœ¨
    
  å‰3è¡Œindicator_consensuså€¼:
    [1] BNB      00:00      consensus=2
    [2] BTC      00:00      consensus=3
    [3] ETH      00:00      consensus=0
    
  å…±æŒ¯å€¼åˆ†å¸ƒ:
    0: 352ç¬” (52.4%)  â¬…ï¸ å¦‚æœ>80%è¯´æ˜æœ‰é—®é¢˜
    1: 120ç¬” (17.9%)
    2:  80ç¬” (11.9%)
    3:  60ç¬” ( 8.9%)

ğŸ“Š æ£€æŸ¥2ï¼šæ˜¨æ—¥è®¢å•CSVæ–‡ä»¶
----------------------------------------------------------------------
âœ“ æ‰¾åˆ°æ–‡ä»¶: trading_data/deepseek/orders_20251118.csv
  æ€»è¡Œæ•°: 20
  
  å…³é”®å­—æ®µæ£€æŸ¥:
    âœ“ å…±æŒ¯æŒ‡æ ‡æ•°               : å­˜åœ¨ â¬…ï¸ å…³é”®ï¼
    âœ“ indicator_consensus      : å­˜åœ¨
    âœ“ ä¿¡å·åˆ†æ•°                 : å­˜åœ¨
    
  å‰3ç¬”è®¢å•æ•°æ®:
    [1] å¸ç§: BNB
        å…±æŒ¯æŒ‡æ ‡æ•°: 3  â¬…ï¸ å¦‚æœæ˜¯0æˆ–N/Aï¼Œå°±æ˜¯é—®é¢˜
        indicator_consensus: 3
        ä¿¡å·åˆ†æ•°: 85

ğŸ¯ è¯Šæ–­å®Œæˆï¼
```

---

### å‘½ä»¤2ï¼šç›´æ¥æŸ¥çœ‹CSVæ–‡ä»¶

**æŸ¥çœ‹å¸‚åœºå¿«ç…§**ï¼ˆæ–‡ä»¶åæ ¼å¼ï¼šYYYYMMDD.csvï¼‰ï¼š
```bash
cd ~/10-23-bot/ds/trading_data/deepseek/market_snapshots
ls -lh *.csv | tail -5  # æœ€æ–°5ä¸ªæ–‡ä»¶
head -1 20251118.csv  # æŸ¥çœ‹å­—æ®µå
head -5 20251118.csv | cut -d',' -f1,2,30-35  # æŸ¥çœ‹å‰5è¡Œï¼ˆåŒ…å«å…±æŒ¯ç­‰å­—æ®µï¼‰
```

**æŸ¥çœ‹äº¤æ˜“å†å²**ï¼ˆå•ä¸ªæ–‡ä»¶ï¼štrades_history.csvï¼‰ï¼š
```bash
cd ~/10-23-bot/ds/trading_data/deepseek
head -1 trades_history.csv  # æŸ¥çœ‹å­—æ®µå
tail -20 trades_history.csv  # æŸ¥çœ‹æœ€è¿‘20ç¬”äº¤æ˜“
grep -i "consensus\|å…±æŒ¯" trades_history.csv | head -5  # æŸ¥æ‰¾å…±æŒ¯ç›¸å…³å­—æ®µ
```

---

### å‘½ä»¤3ï¼šç»Ÿè®¡å…±æŒ¯åˆ†å¸ƒ

**å¸‚åœºå¿«ç…§ä¸­çš„å…±æŒ¯åˆ†å¸ƒ**ï¼š
```bash
cd ~/10-23-bot/ds/trading_data/deepseek/market_snapshots
python3 -c "
import pandas as pd
df = pd.read_csv('20251118.csv')
if 'indicator_consensus' in df.columns:
    print('å…±æŒ¯å€¼åˆ†å¸ƒ:')
    print(df['indicator_consensus'].value_counts().sort_index())
else:
    print('indicator_consensuså­—æ®µä¸å­˜åœ¨ï¼')
"
```

**äº¤æ˜“å†å²ä¸­çš„å…±æŒ¯åˆ†å¸ƒ**ï¼ˆç­›é€‰æ˜¨æ—¥äº¤æ˜“ï¼‰ï¼š
```bash
cd ~/10-23-bot/ds/trading_data/deepseek
python3 -c "
import pandas as pd
df = pd.read_csv('trades_history.csv', encoding='utf-8-sig')
# ç­›é€‰æ˜¨æ—¥äº¤æ˜“
yesterday = '2025-11-18'  # ä¿®æ”¹ä¸ºå®é™…æ—¥æœŸ
yesterday_trades = df[
    (df['å¼€ä»“æ—¶é—´'].astype(str).str.contains(yesterday, na=False)) |
    (df['å¹³ä»“æ—¶é—´'].astype(str).str.contains(yesterday, na=False))
]
print(f'æ˜¨æ—¥äº¤æ˜“: {len(yesterday_trades)}ç¬”')
print('äº¤æ˜“å­—æ®µ:', list(df.columns)[:20])
if 'å…±æŒ¯æŒ‡æ ‡æ•°' in df.columns:
    print('\nå…±æŒ¯å€¼åˆ†å¸ƒ:')
    print(yesterday_trades['å…±æŒ¯æŒ‡æ ‡æ•°'].value_counts().sort_index())
elif 'indicator_consensus' in df.columns:
    print('\nå…±æŒ¯å€¼åˆ†å¸ƒ:')
    print(yesterday_trades['indicator_consensus'].value_counts().sort_index())
else:
    print('å…±æŒ¯å­—æ®µä¸å­˜åœ¨ï¼')
"
```

---

## ğŸ“Š ä¸‹æ¬¡å›æµ‹ä¼šè‡ªåŠ¨è¾“å‡ºçš„è¯Šæ–­ä¿¡æ¯

### è¯Šæ–­1ï¼šPhase 2æƒé‡æµ‹è¯•
```
ğŸ” ã€DEBUGã€‘è¶…çŸ­çº¿æœºä¼šæ•°æ®æ£€æŸ¥:
   æ€»æ•°: 1978
   ç¬¬ä¸€ä¸ªæœºä¼šå­—æ®µ: ['coin', 'timestamp', ..., 'snapshot']
   æ˜¯å¦æœ‰snapshot: True  â¬…ï¸ åº”è¯¥æ˜¯True
   snapshotç±»å‹: <class 'dict'>

âš¡ æµ‹è¯•è¶…çŸ­çº¿æƒé‡å€™é€‰ï¼ˆå…±5ç»„ï¼‰...
   #1 é»˜è®¤ : æ•è·???/1978(20-60%) â¬…ï¸ ä¸å†æ˜¯0%
```

### è¯Šæ–­2ï¼šæŒä»“æ—¶é—´ï¼ˆæ¯1000ä¸ªæœºä¼šè¾“å‡ºä¸€æ¬¡ï¼‰
```
ğŸ” ã€æŒä»“æ—¶é—´è¯Šæ–­ã€‘ç¬¬1000ä¸ªæœºä¼š:
   å¸ç§: BTC, åˆ†ç±»: æ³¢æ®µ
   åˆ©æ¶¦é˜ˆå€¼: 10.0%
   æœ€ç»ˆåˆ©æ¶¦: 12.35%
   è§¦å‘bar: 15
   æŒä»“bars: 16
   æŒä»“å°æ—¶: 4.0h  â¬…ï¸ è§‚å¯Ÿè¿™ä¸ªå€¼
```

### è¯Šæ–­3ï¼šå…±æŒ¯æ•°æ®ï¼ˆé‚®ä»¶ç”Ÿæˆå‰ï¼‰
```
ğŸ” ã€å…±æŒ¯æ•°æ®è¯Šæ–­ã€‘æ˜¨æ—¥è®¢å•å­—æ®µ:
   å­—æ®µåˆ—è¡¨: ['å¸ç§', 'æ–¹å‘', 'å¼€ä»“ä»·æ ¼', 'å…±æŒ¯æŒ‡æ ‡æ•°', ...]
   ç¬¬ä¸€ç¬”è®¢å•:
     'å…±æŒ¯æŒ‡æ ‡æ•°': 3  â¬…ï¸ å¦‚æœæ˜¯N/Aå°±æ˜¯é—®é¢˜
     'indicator_consensus': 3
     'ä¿¡å·åˆ†æ•°': 85
     'signal_score': 85
```

---

## ğŸš€ å®Œæ•´å›æµ‹æµç¨‹

### æ­¥éª¤1ï¼šè¿è¡Œå›æµ‹
```bash
bash ~/å¿«é€Ÿé‡å¯_ä¿®å¤ç‰ˆ.sh backtest-deepseek
```

### æ­¥éª¤2ï¼šè§‚å¯Ÿå›æµ‹æ—¥å¿—
å…³æ³¨ä»¥ä¸‹éƒ¨åˆ†ï¼š
1. Phase 2æƒé‡æµ‹è¯•ï¼ˆæ˜¯å¦æœ‰snapshotï¼‰
2. æŒä»“æ—¶é—´è¯Šæ–­ï¼ˆæ¯1000ä¸ªæœºä¼šï¼‰
3. å…±æŒ¯æ•°æ®è¯Šæ–­ï¼ˆé‚®ä»¶ç”Ÿæˆå‰ï¼‰

### æ­¥éª¤3ï¼šè¿è¡Œè¯Šæ–­è„šæœ¬ï¼ˆå›æµ‹å®Œæˆåï¼‰
```bash
cd ~/10-23-bot/ds
python3 check_consensus_data.py
```

### æ­¥éª¤4ï¼šæŸ¥çœ‹å›æµ‹ç»“æœ
```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -100 ~/10-23-bot/logs/deepseek_*.log

# æŸ¥çœ‹é‚®ä»¶å†…å®¹
cat ~/10-23-bot/ds/trading_data/deepseek/last_email_content.txt
```

---

## ğŸ“ é—®é¢˜åˆ¤æ–­

### æŒä»“æ—¶é—´é—®é¢˜

**å¦‚æœè¯Šæ–­æ˜¾ç¤º**ï¼š
```
ğŸ” ã€æŒä»“æ—¶é—´è¯Šæ–­ã€‘ç¬¬1000ä¸ªæœºä¼š:
   åˆ†ç±»: æ³¢æ®µ
   æŒä»“å°æ—¶: 0.3h  â¬…ï¸ æ³¢æ®µåªæœ‰0.3å°æ—¶
```

**ç»“è®º**ï¼šå¸‚åœºç¡®å®åœ¨å¾ˆçŸ­æ—¶é—´å†…è¾¾åˆ°10%é˜ˆå€¼ï¼ˆå¼ºè¶‹åŠ¿å¸‚åœºï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æé«˜æ³¢æ®µé˜ˆå€¼ï¼ˆ12-15%ï¼‰
- æˆ–æ·»åŠ æ—¶é—´çº¦æŸ

---

### å…±æŒ¯æ•°æ®é—®é¢˜

**æƒ…å†µAï¼šå¸‚åœºå¿«ç…§ä¸­å…±æŒ¯å€¼éƒ½æ˜¯0**
```
å…±æŒ¯å€¼åˆ†å¸ƒ:
    0: 670ç¬” (99.7%)  â¬…ï¸ å‡ ä¹å…¨æ˜¯0
    1:   2ç¬” ( 0.3%)
```
**ç»“è®º**ï¼šindicator_consensusè®¡ç®—æœ‰é—®é¢˜  
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥`recalculate_consensus_from_snapshot`å‡½æ•°

---

**æƒ…å†µBï¼šå¸‚åœºå¿«ç…§æ­£å¸¸ï¼Œä½†äº¤æ˜“å†å²ä¸­æ²¡æœ‰å…±æŒ¯å­—æ®µ**
```
äº¤æ˜“å­—æ®µ: ['å¸ç§', 'æ–¹å‘', 'å¼€ä»“ä»·æ ¼', ...]  â¬…ï¸ æ²¡æœ‰å…±æŒ¯å­—æ®µ
```
**ç»“è®º**ï¼šå¼€ä»“æ—¶æ²¡æœ‰ä¿å­˜å…±æŒ¯æ•°æ®  
**è§£å†³æ–¹æ¡ˆ**ï¼šä¿®å¤å¼€ä»“é€»è¾‘ï¼Œç¡®ä¿ä¿å­˜indicator_consensus

---

**æƒ…å†µCï¼šäº¤æ˜“å†å²ä¸­æœ‰å…±æŒ¯å­—æ®µä½†å€¼éƒ½æ˜¯0**
```
[1] å¸ç§: BNB
    å…±æŒ¯æŒ‡æ ‡æ•°: 0  â¬…ï¸ éƒ½æ˜¯0
    indicator_consensus: 0
```
**ç»“è®º**ï¼šå¼€ä»“æ—¶è¯»å–çš„indicator_consensuså°±æ˜¯0  
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥å¼€ä»“æ—¶çš„æ•°æ®æ¥æº

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤æ€»ç»“

```bash
# 1. è¿è¡Œå›æµ‹
bash ~/å¿«é€Ÿé‡å¯_ä¿®å¤ç‰ˆ.sh backtest-deepseek

# 2. è¿è¡Œå…±æŒ¯è¯Šæ–­è„šæœ¬ï¼ˆæ¨èï¼‰
cd ~/10-23-bot/ds && python3 check_consensus_data.py

# 3. æŸ¥çœ‹å¸‚åœºå¿«ç…§å­—æ®µï¼ˆæ–‡ä»¶åï¼šYYYYMMDD.csvï¼‰
cd ~/10-23-bot/ds/trading_data/deepseek/market_snapshots
ls -lh *.csv | tail -3  # æœ€æ–°3ä¸ªæ–‡ä»¶
head -1 20251118.csv     # æŸ¥çœ‹å­—æ®µå

# 4. æŸ¥çœ‹äº¤æ˜“å†å²æ–‡ä»¶ï¼ˆæ–‡ä»¶åï¼štrades_history.csvï¼‰
cd ~/10-23-bot/ds/trading_data/deepseek
head -1 trades_history.csv  # æŸ¥çœ‹å­—æ®µå
tail -10 trades_history.csv  # æŸ¥çœ‹æœ€è¿‘10ç¬”äº¤æ˜“

# 5. ç»Ÿè®¡æ˜¨æ—¥äº¤æ˜“å…±æŒ¯åˆ†å¸ƒ
cd ~/10-23-bot/ds/trading_data/deepseek
python3 -c "
import pandas as pd
from datetime import datetime, timedelta
df = pd.read_csv('trades_history.csv', encoding='utf-8-sig')
yesterday = (datetime.now() - timedelta(days=1)).strftime('%Y-%m-%d')
yt = df[(df['å¼€ä»“æ—¶é—´'].astype(str).str.contains(yesterday, na=False)) | (df['å¹³ä»“æ—¶é—´'].astype(str).str.contains(yesterday, na=False))]
print(f'æ˜¨æ—¥äº¤æ˜“: {len(yt)}ç¬”')
if 'å…±æŒ¯æŒ‡æ ‡æ•°' in df.columns:
    print(yt['å…±æŒ¯æŒ‡æ ‡æ•°'].value_counts().sort_index())
else:
    print('å…±æŒ¯å­—æ®µä¸å­˜åœ¨')
"
```

---

**âœ… è¯Šæ–­å·¥å…·å·²å°±ç»ªï¼** ğŸ”

