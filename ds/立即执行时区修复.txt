━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
V8.3.21 时区修复 - 立即执行指南
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️  问题：时间戳比实际时间多了8小时（"未来"记录）
✅  工具：已完整开发并推送到GitHub
🎯  目标：所有时间戳减去8小时


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
方式1：一键执行脚本（推荐）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

登录服务器后，复制粘贴以下命令：

┌────────────────────────────────────────────────┐
│ cd ~/10-23-bot && \                            │
│ git pull origin main && \                      │
│ cd ds && \                                     │
│ chmod +x 服务器时区修复.sh && \                │
│ bash 服务器时区修复.sh                         │
└────────────────────────────────────────────────┘

脚本会自动：
✓ 拉取最新代码
✓ 检查数据（显示需要修复的记录）
✓ 询问确认
✓ 修复数据（自动备份）
✓ 验证结果


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
方式2：分步执行（手动控制）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

步骤1: 拉取代码
┌────────────────────────────────────────────────┐
│ cd ~/10-23-bot                                 │
│ git pull origin main                           │
└────────────────────────────────────────────────┘


步骤2: 检查数据（不会修改）
┌────────────────────────────────────────────────┐
│ cd ~/10-23-bot/ds                              │
│ python3 fix_timezone_data.py --dry-run        │
└────────────────────────────────────────────────┘

预期输出：
┌────────────────────────────────────────────────┐
│ [检查] trades_history.csv                     │
│   📊 共15条记录                               │
│                                                │
│   处理列: 开仓时间                            │
│     ⚠️  发现未来时间:                         │
│        2025-11-11 09:30:00                    │
│        (当前: 2025-11-11 01:40:00)            │
│     🚨 发现8条未来记录！                      │
│                                                │
│   💡 [干运行模式] 实际运行时将修复8条记录    │
└────────────────────────────────────────────────┘


步骤3: 修复数据
┌────────────────────────────────────────────────┐
│ python3 fix_timezone_data.py                   │
└────────────────────────────────────────────────┘

会提示：
┌────────────────────────────────────────────────┐
│ ⚠️  确认要修复数据吗？                        │
│    将会备份原文件。(yes/no):                  │
└────────────────────────────────────────────────┘

输入: yes


步骤4: 验证结果
┌────────────────────────────────────────────────┐
│ python3 fix_timezone_data.py --dry-run        │
└────────────────────────────────────────────────┘

预期输出：
┌────────────────────────────────────────────────┐
│ ✓ 无未来时间，数据正常                       │
│ ✓ 无需修复                                   │
└────────────────────────────────────────────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
方式3：快捷脚本
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌────────────────────────────────────────────────┐
│ cd ~/10-23-bot/ds                              │
│ bash 快速修复时区.sh                          │
└────────────────────────────────────────────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
预期修复效果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

修复前（错误）：
┌────────────────────────────────────────────────┐
│ 开仓时间: 2025-11-11 09:30:00  ❌            │
│ （未来时间，当前才 01:40）                    │
└────────────────────────────────────────────────┘

修复后（正确）：
┌────────────────────────────────────────────────┐
│ 开仓时间: 2025-11-11 01:30:00  ✅            │
│ （正确时间，已减去8小时）                    │
└────────────────────────────────────────────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
查看备份文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

修复后会自动创建备份：

┌────────────────────────────────────────────────┐
│ ls -lh ~/10-23-bot/ds/trading_data/qwen/ \    │
│     | grep bak_before_timezone_fix           │
└────────────────────────────────────────────────┘

预期输出：
┌────────────────────────────────────────────────┐
│ trades_history.csv.bak_before_timezone_fix    │
│ ai_decisions.json.bak_before_timezone_fix     │
│ pnl_history.csv.bak_before_timezone_fix       │
└────────────────────────────────────────────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
如需回滚
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

如果修复出错，从备份恢复：

Qwen模型：
┌────────────────────────────────────────────────┐
│ cd ~/10-23-bot/ds/trading_data/qwen            │
│ cp trades_history.csv.bak_before_timezone_fix \│
│    trades_history.csv                          │
│ cp ai_decisions.json.bak_before_timezone_fix \ │
│    ai_decisions.json                           │
│ cp pnl_history.csv.bak_before_timezone_fix \   │
│    pnl_history.csv                             │
└────────────────────────────────────────────────┘

DeepSeek模型：
┌────────────────────────────────────────────────┐
│ cd ~/10-23-bot/ds/trading_data/deepseek        │
│ cp trades_history.csv.bak_before_timezone_fix \│
│    trades_history.csv                          │
│ cp ai_decisions.json.bak_before_timezone_fix \ │
│    ai_decisions.json                           │
│ cp pnl_history.csv.bak_before_timezone_fix \   │
│    pnl_history.csv                             │
└────────────────────────────────────────────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
注意事项
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️  建议在非交易时间执行
⚠️  先运行 --dry-run 检查
⚠️  确认备份文件已创建
⚠️  修复后务必验证
⚠️  只需要执行一次


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
涉及的数据文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Qwen模型：
  ✓ trading_data/qwen/trades_history.csv
  ✓ trading_data/qwen/ai_decisions.json
  ✓ trading_data/qwen/pnl_history.csv

DeepSeek模型：
  ✓ trading_data/deepseek/trades_history.csv
  ✓ trading_data/deepseek/ai_decisions.json
  ✓ trading_data/deepseek/pnl_history.csv


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
工具文件清单
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✓ fix_timezone_data.py           # 主修复工具
✓ 服务器时区修复.sh              # 一键执行脚本
✓ 快速修复时区.sh                # 快捷脚本
✓ V8.3.21_时区修复说明.md        # 详细文档
✓ 时区修复快速指南.txt           # 快速指南
✓ 立即执行时区修复.txt           # 本文件


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
推荐执行方式
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 最简单：复制下面的命令到服务器执行

cd ~/10-23-bot && \
git pull origin main && \
cd ds && \
chmod +x 服务器时区修复.sh && \
bash 服务器时区修复.sh


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

详细文档：ds/V8.3.21_时区修复说明.md

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

