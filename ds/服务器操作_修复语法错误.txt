======================================================================
紧急修复：服务器语法错误
======================================================================

问题：
SyntaxError: invalid syntax at line 10833
Perhaps you forgot a comma?

原因：
可能是git pull时网络问题或编码问题导致文件损坏

======================================================================
方案1：重新获取文件（最简单）
======================================================================

cd /root/10-23-bot

# 1. 备份当前文件
cp ds/deepseek_多币种智能版.py ds/deepseek_broken_backup.py
cp ds/qwen_多币种智能版.py ds/qwen_broken_backup.py

# 2. 重置并重新拉取
git fetch origin
git reset --hard origin/main
git pull

# 3. 验证语法
python3 -m py_compile ds/deepseek_多币种智能版.py
python3 -m py_compile ds/qwen_多币种智能版.py

# 如果编译成功，说明文件正常
echo "✅ 文件已修复"

# 4. 运行回测
cd ds
MANUAL_BACKTEST=true python3 deepseek_多币种智能版.py backtest-deepseek

======================================================================
方案2：手动检查（如果方案1失败）
======================================================================

# 查看问题行
sed -n '10815,10835p' ds/deepseek_多币种智能版.py

# 应该看到（正确的）：
# import copy
# old_config = {
#     'global': copy.deepcopy(config.get('global', {})),
#     'per_symbol': copy.deepcopy(config.get('per_symbol', {})),
#     'scalping_params': copy.deepcopy(config.get('scalping_params', {})),
#     'swing_params': copy.deepcopy(config.get('swing_params', {}))
# }

# 如果看到冲突标记（<<<<<<< HEAD, =======, >>>>>>>）
# 或者某一行缺少逗号，需要手动编辑：

vim +10816 ds/deepseek_多币种智能版.py

# 确保第10816-10821行格式正确（复制下面的内容）：
            old_config = {
                'global': copy.deepcopy(config.get('global', {})),
                'per_symbol': copy.deepcopy(config.get('per_symbol', {})),
                'scalping_params': copy.deepcopy(config.get('scalping_params', {})),
                'swing_params': copy.deepcopy(config.get('swing_params', {}))
            }

# 保存后验证
python3 -m py_compile ds/deepseek_多币种智能版.py

======================================================================
方案3：回退到上一个版本先测试
======================================================================

# 如果V8.5.2.4.89.1修改有问题，可以先回退到V8.5.2.4.89测试

cd /root/10-23-bot
git checkout fa8c735  # V8.5.2.4.89

cd ds
MANUAL_BACKTEST=true python3 deepseek_多币种智能版.py backtest-deepseek

# 如果回测成功完成（没有Killed），说明：
# 1. V8.5.2.4.89的修复（延迟加载old_config）已经有效
# 2. V8.5.2.4.89.1的轻量级old_config可能不需要

# 如果仍然Killed，说明还需要V8.5.2.4.89.1的优化
# 然后切回main，修复语法错误

git checkout main

======================================================================
快速验证命令
======================================================================

# 检查文件是否被正确下载
ls -lh ds/deepseek_多币种智能版.py

# 文件大小应该在900-1000KB左右
# 如果大小明显不对，说明文件损坏

# 查看文件编码
file ds/deepseek_多币种智能版.py

# 应该显示: UTF-8 Unicode text

# 检查是否有冲突标记
grep -n "<<<<<<< HEAD\|=======\|>>>>>>>" ds/deepseek_多币种智能版.py

# 如果有输出，说明有git冲突未解决

======================================================================
推荐操作流程
======================================================================

1. 先用方案1（git reset --hard）强制重置
2. 如果还有错误，用 python3 -m py_compile 确认具体哪一行
3. 用方案2手动检查那一行
4. 如果仍解决不了，用方案3回退测试

======================================================================

