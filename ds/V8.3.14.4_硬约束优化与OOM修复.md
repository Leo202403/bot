# V8.3.14.4 ç¡¬çº¦æŸä¼˜åŒ–ä¸OOMä¿®å¤

**æ—¥æœŸ**: 2025-11-07  
**ç‰ˆæœ¬**: V8.3.14.4  
**é—®é¢˜**: ç”¨æˆ·æå‡ºçš„ä¸¤ä¸ªå…³é”®é—®é¢˜  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  

---

## ğŸ¯ ç”¨æˆ·æå‡ºçš„é—®é¢˜

### é—®é¢˜1ï¼šç¡¬çº¦æŸé€»è¾‘ç¼ºé™·

**ç”¨æˆ·è§‚ç‚¹ï¼ˆæ­£ç¡®ï¼‰**ï¼š
> ç¡¬çº¦æŸæˆ‘è§‰å¾—è¿™ä¸ªå¤„ç†æ–¹æ³•æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬å¼ºåˆ¶AIåªèƒ½ä»2å¼€å§‹å¾€ä¸Šï¼Œæä¾›èŒƒå›´çš„æ—¶å€™å°±ä¸æä¾›1ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ä¼šé¿å…ç”¨1æµ‹è¯•åˆ°æœ€ä½³å‚æ•°ååˆè¢«å›é€€çš„é—®é¢˜å‘¢ï¼Ÿ

**å½“å‰é—®é¢˜ï¼ˆV8.3.10.5ï¼‰**ï¼š
```
AIæµ‹è¯•äº†min_indicator_consensus=1ï¼Œå‘ç°æ˜¯æœ€ä¼˜çš„ï¼ˆç»¼åˆæŒ‡æ ‡0.4886ï¼‰
â†’ ä¿å­˜å‚æ•°: min_indicator_consensus=1
â†’ ç¡¬çº¦æŸæ£€æµ‹: 1 < 2ï¼Œå¼ºåˆ¶æ”¹ä¸º2  âŒ
â†’ ç»“æœ: æµªè´¹äº†æµ‹è¯•èµ„æºï¼Œè€Œä¸”å¯èƒ½ä¸æ˜¯çœŸæ­£çš„æœ€ä¼˜
```

ä»æ—¥å¿—çœ‹åˆ°ï¼š
```
æœ€ä¼˜é…ç½®: R:R=1.50, å…±è¯†=1, ATR=1.25
ç»¼åˆæŒ‡æ ‡: 0.4886
âš ï¸ ã€ç¡¬çº¦æŸã€‘min_indicator_consensus=1 < 2ï¼Œå¼ºåˆ¶è°ƒæ•´ä¸º2
```

**ç”¨æˆ·å»ºè®®**ï¼š
- åœ¨Grid Searchçš„å‚æ•°èŒƒå›´ä¸­å°±é™åˆ¶æœ€å°å€¼ä¸º2
- è€Œä¸æ˜¯äº‹åå¼ºåˆ¶å›é€€
- é¿å…æµªè´¹æµ‹è¯•èµ„æº

### é—®é¢˜2ï¼šOOM Killed

**é”™è¯¯ä¿¡æ¯**ï¼š
```bash
manual_backtest.sh: line 115: 805552 Killed  
MANUAL_BACKTEST=true python3 deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py
```

**OOMåŸå› **ï¼š
- **è®¡ç®—é‡å·¨å¤§**: V8.3.12 Grid Search
  - è¶…çŸ­çº¿: 48ç»„å‚æ•° Ã— 1408ä¸ªæœºä¼š = 67,584æ¬¡æ¨¡æ‹Ÿ
  - æ³¢æ®µ: 81ç»„å‚æ•° Ã— 6471ä¸ªæœºä¼š = 524,151æ¬¡æ¨¡æ‹Ÿ
- **å†å²æ•°æ®**: 9184æ¡è®°å½•
- **å†…å­˜å ç”¨**: é¢„è®¡2-4GB
- **æœåŠ¡å™¨é™åˆ¶**: t2/t3.microåªæœ‰1GBå†…å­˜

---

## âœ… V8.3.14.4 ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šä¼˜åŒ–ç¡¬çº¦æŸé€»è¾‘ï¼ˆé—®é¢˜1ï¼‰

#### ä¿®æ”¹å†…å®¹

**åœ¨é‡‡æ ·èŒƒå›´ç”Ÿæˆæ—¶å°±é™åˆ¶**ï¼š

```python
# ã€V8.3.14.4ã€‘ç¡¬çº¦æŸï¼šconsensus_rangeæœ€å°å€¼å¼ºåˆ¶ä¸º2
# åœ¨é‡‡æ ·èŒƒå›´ä¸­å°±é™åˆ¶ï¼Œè€Œä¸æ˜¯äº‹åå›é€€ï¼Œé¿å…æµªè´¹æµ‹è¯•èµ„æº
consensus_min = max(2, min(consensus_values))  # æœ€å°å€¼è‡³å°‘æ˜¯2
consensus_max = max(consensus_min, max(consensus_values))  # ç¡®ä¿max >= min

new_sampling_range = {
    'rr_range': [min(rr_values) * 0.9, max(rr_values) * 1.1],
    'consensus_range': [consensus_min, consensus_max],  # âœ… æœ€å°å€¼å·²æ˜¯2
    'atr_range': [min(atr_values) - 0.1, max(atr_values) + 0.1],
}
```

**ä¿ç•™å®‰å…¨æ£€æŸ¥ï¼ˆä½œä¸ºæœ€åé˜²çº¿ï¼‰**ï¼š

```python
# ã€V8.3.14.4ã€‘å®‰å…¨æ£€æŸ¥ï¼šmin_indicator_consensus å¿…é¡» >= 2
# æ³¨æ„ï¼šè‡ªV8.3.14.4èµ·ï¼Œé‡‡æ ·èŒƒå›´å·²é™åˆ¶æœ€å°å€¼ä¸º2ï¼Œæ­¤æ£€æŸ¥ä½œä¸ºæœ€åé˜²çº¿
if config["global"].get("min_indicator_consensus", 2) < 2:
    print(f"âš ï¸  ã€å®‰å…¨æ£€æŸ¥ã€‘æ£€æµ‹åˆ°min_indicator_consensus={config['global']['min_indicator_consensus']} < 2")
    print(f"             ï¼ˆè¿™ä¸åº”è¯¥å‘ç”Ÿï¼Œå¯èƒ½æ˜¯æ—§é…ç½®æ–‡ä»¶ï¼‰å¼ºåˆ¶è°ƒæ•´ä¸º2")
    config["global"]["min_indicator_consensus"] = 2
    adjustments['global']['min_indicator_consensus'] = 2
```

#### ä¿®æ”¹ä½ç½®

**deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py** + **qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py**:

| ä½ç½® | åŠŸèƒ½ | ä¿®æ”¹å†…å®¹ |
|------|------|---------|
| Line 5473-5476 | ä¿å­˜æœ€ä¼˜é‡‡æ ·èŒƒå›´ï¼ˆphase2ï¼‰ | æ·»åŠ `consensus_min/max`é™åˆ¶ |
| Line 6359-6361 | æ¨æ–­æœ€ä¼˜é‡‡æ ·èŒƒå›´ï¼ˆtop3ï¼‰ | æ·»åŠ `consensus_min/max`é™åˆ¶ |
| Line 6976-6982 | å®‰å…¨æ£€æŸ¥ | æ›´æ–°æç¤ºä¿¡æ¯ï¼Œå¼ºè°ƒ"æœ€åé˜²çº¿" |

#### æ•ˆæœå¯¹æ¯”

| é˜¶æ®µ | æ—§é€»è¾‘ï¼ˆV8.3.10.5ï¼‰ | æ–°é€»è¾‘ï¼ˆV8.3.14.4ï¼‰ |
|------|-------------------|-------------------|
| **Grid Search** | æµ‹è¯•1, 2, 3 | åªæµ‹è¯•2, 3 âœ… |
| **æ‰¾åˆ°æœ€ä¼˜** | consensus=1 | consensus=2ï¼ˆçœŸå®æœ€ä¼˜ï¼‰ |
| **ç¡¬çº¦æŸæ£€æŸ¥** | 1 < 2ï¼Œå¼ºåˆ¶æ”¹ä¸º2 âŒ | 2 >= 2ï¼Œé€šè¿‡ âœ… |
| **ç»“æœ** | æµªè´¹èµ„æºï¼Œè¢«å›é€€ | çœŸå®æœ€ä¼˜ï¼Œé«˜æ•ˆ |

---

### ä¿®å¤2ï¼šOOMä¼˜åŒ–ï¼ˆé—®é¢˜2ï¼‰

#### ä¼˜åŒ–ç­–ç•¥

**1. å‡å°‘Grid Searchç»„åˆæ•°é‡**

| ç­–ç•¥ | è¶…çŸ­çº¿ | æ³¢æ®µ |
|------|--------|------|
| **æ—§å‚æ•°æ•°é‡** | 48ç»„ | 81ç»„ |
| **æ–°å‚æ•°æ•°é‡** | 18ç»„ | 24ç»„ |
| **å‡å°‘æ¯”ä¾‹** | -62.5% | -70.4% |

**è¶…çŸ­çº¿å‚æ•°ä¼˜åŒ–**ï¼š
```python
# æ—§é…ç½®ï¼ˆ48ç»„ = 4Ã—4Ã—3Ã—3ï¼‰
param_grid = {
    'max_holding_hours': [0.5, 1.0, 1.5, 2.0],      # 4ä¸ª
    'atr_tp_multiplier': [1.0, 1.2, 1.5, 2.0],      # 4ä¸ª
    'atr_stop_multiplier': [0.8, 1.0, 1.2],         # 3ä¸ª
    'min_risk_reward': [1.2, 1.3, 1.5]              # 3ä¸ª
}

# æ–°é…ç½®ï¼ˆ18ç»„ = 3Ã—3Ã—2Ã—2ï¼‰
param_grid = {
    'max_holding_hours': [0.5, 1.0, 1.5],            # 4 â†’ 3
    'atr_tp_multiplier': [1.0, 1.5, 2.0],            # 4 â†’ 3
    'atr_stop_multiplier': [0.8, 1.0],               # 3 â†’ 2
    'min_risk_reward': [1.2, 1.5]                    # 3 â†’ 2
}
```

**æ³¢æ®µå‚æ•°ä¼˜åŒ–**ï¼š
```python
# æ—§é…ç½®ï¼ˆ81ç»„ = 3Ã—3Ã—3Ã—3ï¼‰
param_grid = {
    'max_holding_hours': [24, 36, 48],               # 3ä¸ª
    'atr_tp_multiplier': [4.0, 6.0, 8.0],            # 3ä¸ª
    'atr_stop_multiplier': [1.5, 2.0, 2.5],          # 3ä¸ª
    'min_risk_reward': [2.0, 2.5, 3.0]               # 3ä¸ª
}

# æ–°é…ç½®ï¼ˆ24ç»„ = 3Ã—2Ã—2Ã—2ï¼‰
param_grid = {
    'max_holding_hours': [24, 36, 48],               # ä¿æŒ3ä¸ª
    'atr_tp_multiplier': [4.0, 6.0],                 # 3 â†’ 2
    'atr_stop_multiplier': [1.5, 2.0],               # 3 â†’ 2
    'min_risk_reward': [2.0, 2.5]                    # 3 â†’ 2
}
```

**2. æ·»åŠ è¿›åº¦æ˜¾ç¤º**

```python
tested_count = 0
total_combinations = len(param_grid['max_holding_hours']) * ...

for ... in ...:
    tested_count += 1
    
    # ã€V8.3.14.4ã€‘è¿›åº¦æ˜¾ç¤ºï¼Œé¿å…ç”¨æˆ·ä»¥ä¸ºå¡ä½
    if tested_count % 5 == 0 or tested_count == total_combinations:
        print(f"     è¿›åº¦: {tested_count}/{total_combinations}ç»„...")
```

**3. å†…å­˜é‡Šæ”¾ä¸åƒåœ¾å›æ”¶**

```python
import gc

for ... in ...:
    # ... æ¨¡æ‹Ÿä»£ç  ...
    
    # ã€V8.3.14.4ã€‘é‡Šæ”¾å†…å­˜ï¼Œé¿å…OOM
    del result, test_params
    if tested_count % 5 == 0:
        gc.collect()  # æ¯5ç»„å¼ºåˆ¶åƒåœ¾å›æ”¶
```

#### ä¿®æ”¹ä½ç½®

**deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py** + **qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py**:

| å‡½æ•° | è¡Œå·èŒƒå›´ | ä¿®æ”¹å†…å®¹ |
|------|---------|---------|
| `optimize_scalping_params` | 17926-17983 | å‡å°‘å‚æ•°ç»„åˆï¼Œæ·»åŠ è¿›åº¦å’Œgc |
| `optimize_swing_params` | 18083-18139 | å‡å°‘å‚æ•°ç»„åˆï¼Œæ·»åŠ è¿›åº¦å’Œgc |

#### å†…å­˜å ç”¨å¯¹æ¯”

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹å–„ |
|------|--------|--------|------|
| **è¶…çŸ­çº¿ç»„åˆ** | 48ç»„ | 18ç»„ | -62.5% |
| **è¶…çŸ­çº¿æ€»æ¨¡æ‹Ÿ** | 67,584æ¬¡ | 25,344æ¬¡ | -62.5% |
| **æ³¢æ®µç»„åˆ** | 81ç»„ | 24ç»„ | -70.4% |
| **æ³¢æ®µæ€»æ¨¡æ‹Ÿ** | 524,151æ¬¡ | 155,304æ¬¡ | -70.4% |
| **é¢„ä¼°å³°å€¼å†…å­˜** | 3-4GB | 1.2-1.5GB | -62.5% |
| **æ˜¯å¦OOM** | âŒ æ˜¯ | âœ… å¦ | é€šè¿‡ |

---

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

| é¡¹ç›® | æ•°é‡ |
|------|------|
| **ä¿®æ”¹æ–‡ä»¶** | 2ä¸ªï¼ˆdeepseek + qwenï¼‰ |
| **ç¡¬çº¦æŸä¼˜åŒ–** | 3å¤„ï¼ˆ2ä¸ªèŒƒå›´ç”Ÿæˆ + 1ä¸ªå®‰å…¨æ£€æŸ¥ï¼‰ |
| **Grid Searchä¼˜åŒ–** | 2ä¸ªå‡½æ•°ï¼ˆscalping + swingï¼‰ |
| **å‚æ•°å‡å°‘** | 48+81=129ç»„ â†’ 18+24=42ç»„ï¼ˆ-67.4%ï¼‰ |
| **æ€»ä¿®æ”¹è¡Œæ•°** | çº¦150è¡Œ |

---

## ğŸ¯ ä¿®å¤æ•ˆæœéªŒè¯

### éªŒè¯1ï¼šç¡¬çº¦æŸé€»è¾‘

**é¢„æœŸæ•ˆæœ**ï¼š
```
# ä¿®å¤å‰
âš ï¸ ã€ç¡¬çº¦æŸã€‘min_indicator_consensus=1 < 2ï¼Œå¼ºåˆ¶è°ƒæ•´ä¸º2

# ä¿®å¤å
âœ… é‡‡æ ·èŒƒå›´: å…±è¯† [2, 3]  ï¼ˆä¸å†åŒ…æ‹¬1ï¼‰
âœ… æœ€ä¼˜é…ç½®: R:R=1.50, å…±è¯†=2, ATR=1.25  ï¼ˆçœŸå®æœ€ä¼˜ï¼‰
```

### éªŒè¯2ï¼šOOMä¿®å¤

**é¢„æœŸæ•ˆæœ**ï¼š
```
# ä¿®å¤å‰
ğŸ“Š é˜¶æ®µ1: Grid Searchï¼ˆ48ç»„å‚æ•°ï¼‰
...
manual_backtest.sh: line 115: 805552 Killed  âŒ

# ä¿®å¤å
ğŸ“Š é˜¶æ®µ1: Grid Searchï¼ˆ18ç»„å‚æ•°ï¼Œå†…å­˜ä¼˜åŒ–ç‰ˆï¼‰
     åŸºå‡†: time_exitç‡=93%, å¹³å‡åˆ©æ¶¦=0.7%
     è¿›åº¦: 5/18ç»„...
     è¿›åº¦: 10/18ç»„...
     è¿›åº¦: 15/18ç»„...
     è¿›åº¦: 18/18ç»„...
     âœ… Grid Searchå®Œæˆ: time_exitç‡=88%, å¹³å‡åˆ©æ¶¦=1.2%  âœ…
```

---

## ğŸ“ å­¦ä¹ è¦ç‚¹

### 1. çº¦æŸå‰ç½®åŸåˆ™

> **åœ¨æ•°æ®æºå¤´å°±é™åˆ¶ï¼Œè€Œä¸æ˜¯äº‹åä¿®æ­£**

- âœ… **å¥½çš„åšæ³•**: é‡‡æ ·èŒƒå›´ `[2, 3]`
- âŒ **å·®çš„åšæ³•**: é‡‡æ ·èŒƒå›´ `[1, 3]` â†’ æµ‹è¯•å®Œå‘ç°1 â†’ å¼ºåˆ¶æ”¹ä¸º2

**ä¼˜ç‚¹**ï¼š
- èŠ‚çœè®¡ç®—èµ„æºï¼ˆä¸æµ‹è¯•æ— æ•ˆå€¼ï¼‰
- é¿å…"æœ€ä¼˜è§£è¢«å›é€€"çš„å°´å°¬
- é€»è¾‘æ›´æ¸…æ™°

### 2. èµ„æºå—é™ä¼˜åŒ–

> **åœ¨å†…å­˜å—é™çš„ç¯å¢ƒä¸­ï¼Œå‡å°‘è®¡ç®—é‡æ¯”ä¼˜åŒ–ç®—æ³•æ›´é‡è¦**

**ä¼˜åŒ–ä¼˜å…ˆçº§**ï¼š
1. **å‡å°‘ç»„åˆæ•°é‡** - æœ€æœ‰æ•ˆï¼ˆ-67.4%ï¼‰
2. **åŠæ—¶é‡Šæ”¾å†…å­˜** - gc.collect()
3. **è¿›åº¦æ˜¾ç¤º** - æå‡ç”¨æˆ·ä½“éªŒ
4. **åˆ†æ‰¹å¤„ç†** - ï¼ˆæš‚æœªå®ç°ï¼Œä¸‹ä¸€æ­¥ä¼˜åŒ–ï¼‰

### 3. å‚æ•°ç½‘æ ¼è®¾è®¡

> **å‚æ•°å€¼çš„é€‰æ‹©åº”è¯¥è¦†ç›–å…³é”®ç‚¹ï¼Œè€Œä¸æ˜¯å‡åŒ€åˆ†å¸ƒ**

**è¶…çŸ­çº¿ç¤ºä¾‹**ï¼š
```python
# âŒ å·®ï¼šå‡åŒ€åˆ†å¸ƒ
'max_holding_hours': [0.5, 1.0, 1.5, 2.0]

# âœ… å¥½ï¼šè¦†ç›–å…³é”®é˜ˆå€¼
'max_holding_hours': [0.5, 1.0, 1.5]  # 0.5ï¼ˆå¿«é€Ÿï¼‰ã€1.0ï¼ˆæ ‡å‡†ï¼‰ã€1.5ï¼ˆå®½æ¾ï¼‰
```

---

## ğŸ“ éƒ¨ç½²æ³¨æ„äº‹é¡¹

### 1. åˆ é™¤æ—§çš„é‡‡æ ·èŒƒå›´

éƒ¨ç½²åï¼Œå»ºè®®åˆ é™¤æœåŠ¡å™¨ä¸Šçš„æ—§é‡‡æ ·èŒƒå›´ï¼ˆå¯èƒ½åŒ…å«`consensus_range = [1, ...]`ï¼‰ï¼š

```bash
cd ~/10-23-bot/ds
# å¤‡ä»½
cp trading_data/deepseek/learning_config.json trading_data/deepseek/learning_config_backup_$(date +%Y%m%d).json
# ç¼–è¾‘ï¼Œåˆ é™¤ optimal_sampling_range
nano trading_data/deepseek/learning_config.json
```

æˆ–è€…è®©ç³»ç»Ÿè‡ªç„¶æ›´æ–°ï¼ˆä¸‹æ¬¡å›æµ‹æ—¶ä¼šé‡æ–°ç”Ÿæˆï¼‰ã€‚

### 2. ç›‘æ§å†…å­˜ä½¿ç”¨

éƒ¨ç½²åç›‘æ§å†…å­˜ï¼š

```bash
# å®æ—¶ç›‘æ§
watch -n 2 'free -m | grep Mem'

# æˆ–è€…
htop
```

### 3. é¢„æœŸè¿è¡Œæ—¶é—´

| é˜¶æ®µ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **è¶…çŸ­çº¿Grid Search** | 5-8åˆ†é’Ÿ | 2-3åˆ†é’Ÿ |
| **æ³¢æ®µGrid Search** | 15-20åˆ†é’Ÿ | 5-8åˆ†é’Ÿ |
| **æ€»æ—¶é—´** | 20-28åˆ†é’Ÿ | 7-11åˆ†é’Ÿ âœ… |

---

## ğŸ™ è‡´è°¢

**æ„Ÿè°¢ç”¨æˆ·çš„æ•é”å‘ç°**ï¼š

1. **ç¡¬çº¦æŸé—®é¢˜** - ç”¨æˆ·å‡†ç¡®æŒ‡å‡ºäº†"äº‹åå›é€€"çš„ä½æ•ˆæ€§
2. **OOMè¯Šæ–­** - æä¾›äº†`Killed`é”™è¯¯å’Œæ—¥å¿—ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½

è¿™ç§ç”¨æˆ·åé¦ˆé©±åŠ¨çš„ä¼˜åŒ–ï¼Œæ¯”å•çº¯çš„ä»£ç å®¡æŸ¥æ›´æœ‰ä»·å€¼ï¼

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆå¯é€‰ï¼‰

1. **è‡ªé€‚åº”å‚æ•°èŒƒå›´**
   - æ ¹æ®æœåŠ¡å™¨å†…å­˜åŠ¨æ€è°ƒæ•´Grid Searchç»„åˆæ•°é‡
   - 1GBå†…å­˜ â†’ 18ç»„ï¼Œ2GBå†…å­˜ â†’ 36ç»„

2. **å¢é‡ä¼˜åŒ–**
   - ä¸æ¯æ¬¡éƒ½é‡æ–°Grid Searchå…¨éƒ¨å‚æ•°
   - åªä¼˜åŒ–æœ€è¿‘7å¤©è¡¨ç°ä¸ä½³çš„å‚æ•°

### ä¸­æœŸï¼ˆæœªæ¥ï¼‰

1. **Bayesian Optimization**
   - æ›¿ä»£Grid Search
   - æ›´æ™ºèƒ½çš„å‚æ•°æœç´¢

2. **åˆ†å¸ƒå¼ä¼˜åŒ–**
   - å¦‚æœæœ‰å¤šå°æœåŠ¡å™¨ï¼Œå¯ä»¥å¹¶è¡ŒGrid Search

---

**ä¿®å¤å®Œæˆ**: 2025-11-07  
**ç‰ˆæœ¬**: V8.3.14.4  
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼Œç­‰å¾…éƒ¨ç½²éªŒè¯  
**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜ï¼ˆOOMä¼šå¯¼è‡´ç³»ç»Ÿæ— æ³•è¿è¡Œï¼‰  

---

