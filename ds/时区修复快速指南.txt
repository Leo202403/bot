━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
V8.3.21 时区修复 - 快速指南
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

问题：时间戳比实际时间多了8小时（"未来"记录）
原因：服务器时区混用（UTC vs 北京时间）
影响：交易记录、AI决策、回测数据


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
在服务器上执行（3个步骤）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1️⃣  拉取最新代码
   ┌────────────────────────────────────────┐
   │ cd ~/10-23-bot                         │
   │ git pull origin main                   │
   └────────────────────────────────────────┘


2️⃣  检查数据（不会修改文件）
   ┌────────────────────────────────────────┐
   │ cd ~/10-23-bot/ds                      │
   │ python3 fix_timezone_data.py --dry-run │
   └────────────────────────────────────────┘

   输出示例：
   ┌────────────────────────────────────────┐
   │ ⚠️  发现未来时间:                      │
   │    2025-11-11 09:30:00                 │
   │    （当前: 2025-11-11 01:40:00）       │
   │ 🚨 发现8条未来记录！                  │
   └────────────────────────────────────────┘


3️⃣  修复数据（确认后执行）
   ┌────────────────────────────────────────┐
   │ python3 fix_timezone_data.py           │
   └────────────────────────────────────────┘

   或使用快捷脚本：
   ┌────────────────────────────────────────┐
   │ bash 快速修复时区.sh                  │
   └────────────────────────────────────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
涉及的数据文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✓ trading_data/qwen/trades_history.csv
✓ trading_data/qwen/ai_decisions.json
✓ trading_data/qwen/pnl_history.csv

✓ trading_data/deepseek/trades_history.csv
✓ trading_data/deepseek/ai_decisions.json
✓ trading_data/deepseek/pnl_history.csv


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
安全保障
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 自动备份（修复前）
   文件后缀：.bak_before_timezone_fix

✅ 可回滚
   cp trading_data/qwen/*.bak_before_timezone_fix trading_data/qwen/

✅ 先检查后修复
   --dry-run模式不会修改任何文件


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
修复效果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

修复前：
┌────────────────────────────────────────┐
│ 开仓时间: 2025-11-11 09:30:00  ❌     │
│ （未来时间，当前才01:40）             │
└────────────────────────────────────────┘

修复后：
┌────────────────────────────────────────┐
│ 开仓时间: 2025-11-11 01:30:00  ✅     │
│ （正确时间，减去8小时）               │
└────────────────────────────────────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
验证修复结果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

修复后再次检查：
┌────────────────────────────────────────┐
│ python3 fix_timezone_data.py --dry-run │
└────────────────────────────────────────┘

应该显示：
┌────────────────────────────────────────┐
│ ✓ 无未来时间，数据正常                │
│ ✓ 无需修复                            │
└────────────────────────────────────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
注意事项
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️  建议在非交易时间执行
⚠️  确保已创建备份
⚠️  修复后务必验证
⚠️  只执行一次即可


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
完整命令（复制粘贴）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# 一键执行（推荐）
cd ~/10-23-bot && git pull origin main && cd ds && python3 fix_timezone_data.py --dry-run


# 确认无误后修复
cd ~/10-23-bot/ds && python3 fix_timezone_data.py


# 验证
cd ~/10-23-bot/ds && python3 fix_timezone_data.py --dry-run


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

详细文档：ds/V8.3.21_时区修复说明.md

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

