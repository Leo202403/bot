======================================================================
âœ… V8.3.11 æ­¢ç›ˆæ­¢æŸå‚æ•°ä½¿ç”¨æƒ…å†µè¯´æ˜
======================================================================
â° æ£€æŸ¥æ—¶é—´: 2025-11-07 18:30
ğŸ¯ ç»“è®º: TP/SLè®¡ç®—å·²å®Œæ•´ä½¿ç”¨ separated paramsï¼

======================================================================
ã€å½“å‰TP/SLå‚æ•°ä½¿ç”¨æƒ…å†µã€‘
======================================================================

âœ… calculate_unified_risk_reward_v2 å‡½æ•°ï¼ˆç¬¬10518è¡Œï¼‰
   - å·²å®Œæ•´å®ç° separated strategy params

ğŸ“Š Scalpingæ¨¡å¼ï¼ˆç¬¬10552-10608è¡Œï¼‰ï¼š
---
```python
# ã€V8.0â†’V8.3.9ã€‘ä»separated paramsè¯»å–
scalping_config = config.get('scalping_params', {})
base_atr_multiplier = scalping_config.get('atr_stop_multiplier', 1.0)    # âœ… ä»scalping_paramsè¯»å–
base_tp_multiplier = scalping_config.get('atr_tp_multiplier', 1.5)       # âœ… ä»scalping_paramsè¯»å–

# ã€V8.3.9ã€‘åŠ¨æ€æ³¢åŠ¨æ€§è°ƒæ•´
atr_pct = (atr_15m / entry_price)
if atr_pct > 0.03:  # é«˜æ³¢åŠ¨
    volatility_factor_tp = 0.85  # é™ä½TPç›®æ ‡
    volatility_factor_sl = 1.15  # æ”¾å®½SL
elif atr_pct < 0.01:  # ä½æ³¢åŠ¨
    volatility_factor_tp = 1.15  # æé«˜TPç›®æ ‡
    volatility_factor_sl = 0.90  # æ”¶ç´§SL
else:
    volatility_factor_tp = 1.0
    volatility_factor_sl = 1.0

atr_multiplier = base_atr_multiplier * volatility_factor_sl  # âœ… åŠ¨æ€è°ƒæ•´
tp_multiplier = base_tp_multiplier * volatility_factor_tp    # âœ… åŠ¨æ€è°ƒæ•´

# è®¡ç®—å®é™…TP/SL
stop_loss = entry_price Â± (atr_15m * atr_multiplier)
take_profit = entry_price Â± (atr_15m * tp_multiplier)
```

ğŸ“Š Swingæ¨¡å¼ï¼ˆç¬¬10610-10710è¡Œï¼‰ï¼š
---
```python
# ã€V8.0â†’V8.3.9ã€‘ä»separated paramsè¯»å–
swing_config = config.get('swing_params', {})
base_atr_multiplier = swing_config.get('atr_stop_multiplier', 2.0)   # âœ… ä»swing_paramsè¯»å–
base_tp_multiplier = swing_config.get('atr_tp_multiplier', 6.0)      # âœ… ä»swing_paramsè¯»å–
use_htf_levels = swing_config.get('use_htf_levels', True)            # âœ… æ˜¯å¦ä½¿ç”¨æ”¯æ’‘é˜»åŠ›ä½

# ã€V8.3.9ã€‘åŠ¨æ€æ³¢åŠ¨æ€§è°ƒæ•´ï¼ˆç”¨äºATRå›é€€æ¨¡å¼ï¼‰
atr_pct = (atr_1h / entry_price)
if atr_pct > 0.04:  # é«˜æ³¢åŠ¨
    volatility_factor_tp = 0.80  # æ³¢æ®µæ›´æ¿€è¿›åœ°é™TP
    volatility_factor_sl = 1.20
elif atr_pct < 0.015:  # ä½æ³¢åŠ¨
    volatility_factor_tp = 1.20
    volatility_factor_sl = 0.85
else:
    volatility_factor_tp = 1.0
    volatility_factor_sl = 1.0

atr_multiplier = base_atr_multiplier * volatility_factor_sl  # âœ… åŠ¨æ€è°ƒæ•´
tp_multiplier = base_tp_multiplier * volatility_factor_tp    # âœ… åŠ¨æ€è°ƒæ•´

# ä¼˜å…ˆä½¿ç”¨æ”¯æ’‘é˜»åŠ›ä½ï¼Œå›é€€åˆ°ATR
if æœ‰åˆé€‚çš„æ”¯æ’‘/é˜»åŠ›ä½:
    stop_loss = æ”¯æ’‘/é˜»åŠ›ä½ Â± ç¼“å†²
    take_profit = é˜»åŠ›/æ”¯æ’‘ä½ âˆ“ å®‰å…¨è¾¹é™…
else:
    # å›é€€åˆ°ATRå€æ•°
    stop_loss = entry_price Â± (atr_1h * atr_multiplier)
    take_profit = entry_price Â± (atr_1h * tp_multiplier)
```

======================================================================
ã€å‚æ•°ä¼˜å…ˆçº§æ€»ç»“ã€‘
======================================================================

âœ… å®Œæ•´çš„å‚æ•°ä½¿ç”¨æµç¨‹ï¼š

1ï¸âƒ£ å¼€ä»“å†³ç­–æ—¶ï¼š
   - get_learning_config_for_symbol(symbol, config, signal_type)
   - è¯»å– scalping_params/swing_params çš„ min_risk_reward, min_signal_score
   - åˆ¤æ–­æ˜¯å¦æ»¡è¶³å¼€ä»“æ¡ä»¶

2ï¸âƒ£ è®¡ç®—TP/SLæ—¶ï¼š
   - calculate_unified_risk_reward_v2(entry_price, side, market_data, signal_classification)
   - è¯»å– scalping_params/swing_params çš„:
     * atr_stop_multiplierï¼ˆæ­¢æŸATRå€æ•°ï¼‰
     * atr_tp_multiplierï¼ˆæ­¢ç›ˆATRå€æ•°ï¼‰
     * use_htf_levelsï¼ˆæ˜¯å¦ä¼˜å…ˆä½¿ç”¨æ”¯æ’‘é˜»åŠ›ä½ï¼‰
   - åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®å¸‚åœºæ³¢åŠ¨æ€§å¾®è°ƒå€æ•°
   
3ï¸âƒ£ V8.3.11ä¿®å¤å‰çš„é—®é¢˜ï¼š
   âŒ å¼€ä»“å†³ç­–åªä» global è¯»å–å‚æ•°
   âœ… TP/SLè®¡ç®—å·²ä» separated params è¯»å–

4ï¸âƒ£ V8.3.11ä¿®å¤åï¼š
   âœ… å¼€ä»“å†³ç­–ä» separated params è¯»å–
   âœ… TP/SLè®¡ç®—ä» separated params è¯»å–
   âœ… **å…¨æµç¨‹ä¸€è‡´ä½¿ç”¨ separated paramsï¼**

======================================================================
ã€V8.3.4ä¼˜åŒ–çš„å‚æ•°åº”ç”¨èŒƒå›´ã€‘
======================================================================

âœ… å·²åº”ç”¨çš„å‚æ•°ï¼š
  1. min_risk_rewardï¼ˆå¼€ä»“æ¡ä»¶+TP/SLéªŒè¯ï¼‰
  2. min_signal_scoreï¼ˆå¼€ä»“æ¡ä»¶ï¼‰
  3. min_indicator_consensusï¼ˆå¼€ä»“æ¡ä»¶ï¼‰
  4. atr_stop_multiplierï¼ˆæ­¢æŸè®¡ç®—ï¼‰âœ…
  5. atr_tp_multiplierï¼ˆæ­¢ç›ˆè®¡ç®—ï¼‰âœ…
  6. use_htf_levelsï¼ˆæ˜¯å¦ä¼˜å…ˆæ”¯æ’‘é˜»åŠ›ä½ï¼‰âœ…

â“ å¯èƒ½æœªå……åˆ†åº”ç”¨çš„å‚æ•°ï¼š
  1. max_holding_hoursï¼ˆæœ€é•¿æŒä»“æ—¶é—´ï¼‰
     - éœ€è¦æ£€æŸ¥æŒä»“ç›‘æ§é€»è¾‘æ˜¯å¦æ ¹æ®signal_typeä½¿ç”¨ä¸åŒçš„æ—¶é—´é™åˆ¶
  
  2. trailing_stop_triggerï¼ˆç§»åŠ¨æ­¢æŸè§¦å‘ï¼‰
     - éœ€è¦æ£€æŸ¥æ˜¯å¦åŒºåˆ†scalping/swing
  
  3. max_trades_per_hourï¼ˆæ¯å°æ—¶æœ€å¤§äº¤æ˜“æ•°ï¼‰
     - éœ€è¦æ£€æŸ¥æ˜¯å¦åˆ†åˆ«ç»Ÿè®¡

======================================================================
ã€éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥çš„åŠŸèƒ½ã€‘
======================================================================

ğŸ” æŒä»“ç›‘æ§ä¸å¹³ä»“åˆ¤æ–­ï¼š
  
  é—®é¢˜ï¼šæŒä»“æ—¶çš„ç›‘æ§é€»è¾‘æ˜¯å¦æ ¹æ®signal_typeä½¿ç”¨ä¸åŒçš„å‚æ•°ï¼Ÿ
  
  éœ€è¦æ£€æŸ¥çš„ä»£ç ï¼š
  1. ä¸»å¾ªç¯ä¸­çš„æŒä»“ç›‘æ§é€»è¾‘
  2. æ˜¯å¦æ ¹æ®signal_typeè¯»å–max_holding_hours
  3. Time Exité€»è¾‘æ˜¯å¦åŒºåˆ†scalping(2h)/swing(24h)
  4. ç§»åŠ¨æ­¢æŸé€»è¾‘æ˜¯å¦åŒºåˆ†

  å…³é”®æ–‡ä»¶ä½ç½®ï¼š
  - ä¸»äº¤æ˜“å¾ªç¯ï¼ˆå¯èƒ½åœ¨mainå‡½æ•°æˆ–trading_loopå‡½æ•°ï¼‰
  - æŒä»“ç®¡ç†ç›¸å…³å‡½æ•°

======================================================================
ã€å»ºè®®ã€‘
======================================================================

âœ… å·²å®Œç¾å®ç°çš„éƒ¨åˆ†ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰ï¼š
  - å¼€ä»“å†³ç­–ï¼ˆV8.3.11å·²ä¿®å¤ï¼‰
  - TP/SLè®¡ç®—ï¼ˆV8.0å°±å·²å®ç°ï¼‰
  - åŠ¨æ€æ³¢åŠ¨æ€§è°ƒæ•´ï¼ˆV8.3.9ï¼‰

ğŸ“‹ å¯é€‰ä¼˜åŒ–é¡¹ç›®ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š
  1. æ£€æŸ¥æŒä»“ç›‘æ§æ˜¯å¦æ ¹æ®signal_typeåŒºåˆ†
  2. ç¡®ä¿Time Exitä½¿ç”¨å¯¹åº”ç­–ç•¥çš„max_holding_hours
  3. ç§»åŠ¨æ­¢æŸé€»è¾‘æ˜¯å¦éœ€è¦åŒºåˆ†scalping/swing

ğŸ’¡ æ¨èåšæ³•ï¼š
  1. å…ˆéƒ¨ç½²V8.3.11ï¼Œè§‚å¯Ÿæ•ˆæœ
  2. å¦‚æœå‘ç°æŒä»“æ—¶é—´é™åˆ¶ä¸åˆç†ï¼Œå†ä¼˜åŒ–æŒä»“ç›‘æ§é€»è¾‘
  3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„Time Exitæƒ…å†µï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–

======================================================================
âœ… æ€»ç»“ï¼šTP/SLå‚æ•°å·²å®Œæ•´ä½¿ç”¨ separated paramsï¼
======================================================================

ğŸ¯ æ ¸å¿ƒç»“è®ºï¼š
  - V8.0å°±å·²å®ç°separated paramsç”¨äºTP/SLè®¡ç®—
  - V8.3.9å¢åŠ äº†åŠ¨æ€æ³¢åŠ¨æ€§è°ƒæ•´
  - V8.3.11ä¿®å¤äº†å¼€ä»“å†³ç­–çš„å‚æ•°è¯»å–
  - **å½“å‰TP/SLé€»è¾‘å·²å®Œæ•´æ”¯æŒseparated strategyï¼**

ğŸ“Œ å»ºè®®ï¼š
  - ç«‹å³éƒ¨ç½²V8.3.11
  - è§‚å¯Ÿè¿è¡Œæ•ˆæœ
  - å¦‚å‘ç°æŒä»“ç®¡ç†éœ€è¦ä¼˜åŒ–ï¼Œå†è¿›è¡Œä¸‹ä¸€æ­¥è°ƒæ•´

