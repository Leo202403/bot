# V8.5.1.3 åˆ†æ‰¹å¹³ä»“ä¿®å¤æŠ¥å‘Š

## ä¿®å¤å†…å®¹

æœ¬æ¬¡ä¿®å¤è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š
1. **åˆ†æ‰¹å¹³ä»“åå‰©ä½™ä»“ä½ä¿¡æ¯ä¸¢å¤±**
2. **åˆ†æ‰¹å¹³ä»“åé‡è®¾æ­¢ç›ˆæ­¢æŸç²¾åº¦é”™è¯¯**

---

## é—®é¢˜1ï¼šåˆ†æ‰¹å¹³ä»“åå‰©ä½™ä»“ä½ä¿¡æ¯ä¸¢å¤±

### ç°è±¡

åˆ†æ‰¹å¹³ä»“50%åï¼Œå‰ç«¯æ— æ³•æ˜¾ç¤ºå‰©ä½™ä»“ä½çš„ï¼š
- å¼€ä»“æ—¶é—´
- ä¿è¯é‡‘
- æ æ†ç‡
- é¢„è®¡æ­¢ç›ˆä»·
- é¢„è®¡æ­¢æŸä»·
- ç›ˆäºæ¯”
- å¼€ä»“ç†ç”±

**åå°æ—¥å¿—å…³é”®è­¦å‘Š**ï¼š
```
âš ï¸ æœªæ‰¾åˆ° BNB ç©º çš„å¼€ä»“è®°å½•
âš ï¸ åˆ†æ‰¹å¹³ä»“ï¼Œä¿ç•™ BNB çš„å†³ç­–ä¸Šä¸‹æ–‡
```

## æ ¹æœ¬åŸå› åˆ†æ

### é”™è¯¯æµç¨‹

1. **ç¬¬ä¸€æ¬¡BNBåˆ†æ‰¹å¹³ä»“50%**ï¼ˆ13:31ï¼‰
   - ç³»ç»Ÿè°ƒç”¨ `update_close_position()`
   - å‡½æ•°æŸ¥æ‰¾ `trades_history.csv` ä¸­æœªå¹³ä»“çš„BNBè®°å½•
   - **é”™è¯¯åœ°å°†æ•´æ¡è®°å½•æ ‡è®°ä¸º"å·²å¹³ä»“"**ï¼ˆå¡«å†™äº†å¹³ä»“æ—¶é—´ï¼‰

2. **å‰©ä½™50%ä»“ä½**
   - äº¤æ˜“æ‰€ä»æœ‰æŒä»“
   - ä½† `trades_history.csv` ä¸­å·²æ— å¯¹åº”çš„æœªå¹³ä»“è®°å½•

3. **`get_all_positions()` æŸ¥è¯¢å¤±è´¥**
   - è°ƒç”¨ `get_trade_info_from_csv()` æŸ¥æ‰¾äº¤æ˜“ä¿¡æ¯
   - å› è®°å½•å·²æ ‡è®°ä¸ºå·²å¹³ä»“ï¼ŒæŸ¥è¯¢è¿”å› `None`
   - `current_positions.csv` ä¸­ç›¸å…³å­—æ®µä¸ºç©º

4. **å‰ç«¯æ˜¾ç¤ºç©ºç™½**
   - è¯»å– `current_positions.csv`
   - å¼€ä»“æ—¶é—´ã€ä¿è¯é‡‘ç­‰å­—æ®µå‡ä¸ºç©º

### é—®é¢˜ä»£ç 

```python
# æ—§çš„ update_close_position å‡½æ•°ï¼ˆç¬¬1037-1086è¡Œï¼‰
def update_close_position(coin_name, side, close_time, close_price, pnl, close_reason):
    # ...æŸ¥æ‰¾æœªå¹³ä»“è®°å½•...
    
    # 6. æ›´æ–°æœ€åä¸€æ¡åŒ¹é…è®°å½•
    last_idx = matching_rows.index[-1]
    df.at[last_idx, "å¹³ä»“æ—¶é—´"] = close_time  # âŒ æ— è®ºå¹³ä»“å¤šå°‘ï¼Œéƒ½å¡«å†™å¹³ä»“æ—¶é—´
    df.at[last_idx, "å¹³ä»“ä»·æ ¼"] = close_price
    df.at[last_idx, "ç›ˆäº(U)"] = pnl
    df.at[last_idx, "å¹³ä»“ç†ç”±"] = close_reason
```

**é—®é¢˜**ï¼šåˆ†æ‰¹å¹³ä»“50%æ—¶ï¼Œä¹Ÿä¼šæŠŠæ•´æ¡è®°å½•æ ‡è®°ä¸º"å·²å¹³ä»“"ï¼Œå¯¼è‡´å‰©ä½™50%ä»“ä½å¤±å»è¿½è¸ªã€‚

## ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯

**åˆ†æ‰¹å¹³ä»“æ—¶ï¼Œéœ€è¦ä¿ç•™å‰©ä½™ä»“ä½çš„è¿½è¸ªè®°å½•**ï¼š
1. å°†åŸè®°å½•æ›´æ–°ä¸ºå·²å¹³ä»“ï¼ˆä»£è¡¨å¹³æ‰çš„éƒ¨åˆ†ï¼‰
2. åˆ›å»ºä¸€æ¡æ–°çš„æœªå¹³ä»“è®°å½•ï¼ˆä»£è¡¨å‰©ä½™ä»“ä½ï¼‰

### ä»£ç ä¿®æ”¹

#### 1. ä¿®æ”¹ `update_close_position` å‡½æ•°

**æ–‡ä»¶**ï¼š`ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py` + `ds/deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`

**ä¿®æ”¹ä½ç½®**ï¼šç¬¬1037è¡Œ

```python
def update_close_position(coin_name, side, close_time, close_price, pnl, close_reason, close_pct=100):
    """æ›´æ–°å¹³ä»“è®°å½•ï¼ˆæ‰¾åˆ°å¯¹åº”çš„å¼€ä»“è®°å½•å¹¶æ›´æ–°ï¼‰- æ”¯æŒåˆ†æ‰¹å¹³ä»“"""
    # ...å‰é¢ä»£ç ä¸å˜...
    
    # 6. å¤„ç†å¹³ä»“è®°å½•
    last_idx = matching_rows.index[-1]
    original_row = df.loc[last_idx].copy()
    
    if close_pct >= 100:
        # å®Œå…¨å¹³ä»“ï¼šç›´æ¥æ›´æ–°è®°å½•
        df.at[last_idx, "å¹³ä»“æ—¶é—´"] = close_time
        df.at[last_idx, "å¹³ä»“ä»·æ ¼"] = close_price
        df.at[last_idx, "ç›ˆäº(U)"] = pnl
        df.at[last_idx, "å¹³ä»“ç†ç”±"] = close_reason
    else:
        # åˆ†æ‰¹å¹³ä»“ï¼šåˆ›å»ºä¸€æ¡å·²å¹³ä»“è®°å½•ï¼Œä¿ç•™ä¸€æ¡æœªå¹³ä»“è®°å½•
        # æ›´æ–°å½“å‰è®°å½•ä¸ºå·²å¹³ä»“ï¼ˆä»£è¡¨å¹³æ‰çš„éƒ¨åˆ†ï¼‰
        df.at[last_idx, "å¹³ä»“æ—¶é—´"] = close_time
        df.at[last_idx, "å¹³ä»“ä»·æ ¼"] = close_price
        df.at[last_idx, "ç›ˆäº(U)"] = pnl
        df.at[last_idx, "å¹³ä»“ç†ç”±"] = close_reason
        
        # âœ… åˆ›å»ºæ–°è®°å½•ä»£è¡¨å‰©ä½™ä»“ä½ï¼ˆå¤åˆ¶åŸè®°å½•ï¼Œæ¸…ç©ºå¹³ä»“ä¿¡æ¯ï¼‰
        remaining_row = original_row.copy()
        remaining_row["å¹³ä»“æ—¶é—´"] = pd.NA
        remaining_row["å¹³ä»“ä»·æ ¼"] = pd.NA
        remaining_row["ç›ˆäº(U)"] = pd.NA
        remaining_row["å¹³ä»“ç†ç”±"] = pd.NA
        remaining_row["å¼€ä»“ç†ç”±"] = original_row["å¼€ä»“ç†ç”±"] + f" [å‰©ä½™{100-close_pct:.0f}%]"
        
        # å°†æ–°è®°å½•è¿½åŠ åˆ°DataFrame
        df = pd.concat([df, pd.DataFrame([remaining_row])], ignore_index=True)
        print(f"  ğŸ“ å·²åˆ›å»ºå‰©ä½™{100-close_pct:.0f}%ä»“ä½çš„æ–°è®°å½•")
```

**å…³é”®æ”¹åŠ¨**ï¼š
- æ–°å¢å‚æ•°ï¼š`close_pct=100`ï¼ˆé»˜è®¤å®Œå…¨å¹³ä»“ï¼‰
- åˆ†æ‰¹å¹³ä»“æ—¶ï¼šå¤åˆ¶åŸè®°å½•ï¼Œåˆ›å»ºæ–°çš„æœªå¹³ä»“è®°å½•ï¼Œä¿ç•™æ‰€æœ‰å†å²ä¿¡æ¯

#### 2. ä¿®æ”¹è°ƒç”¨å¤„

**æ–‡ä»¶**ï¼š`ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆç¬¬16615è¡Œï¼‰+ `ds/deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆç¬¬16618è¡Œï¼‰

```python
# æ›´æ–°äº¤æ˜“è®°å½•
update_close_position(
    coin_name,
    "å¤š" if real_pos["side"] == "long" else "ç©º",
    datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
    order.get("average", 0) if order else 0,
    pnl,
    action.get("reason", "N/A") + (f" [åˆ†æ‰¹{close_pct:.0f}%]" if close_pct < 100 else ""),
    close_pct=close_pct  # âœ… ä¼ å…¥åˆ†æ‰¹å¹³ä»“æ¯”ä¾‹
)
```

**å…³é”®æ”¹åŠ¨**ï¼š
- ä¼ å…¥ `close_pct` å‚æ•°ï¼Œè®©å‡½æ•°çŸ¥é“æ˜¯åˆ†æ‰¹å¹³ä»“è¿˜æ˜¯å®Œå…¨å¹³ä»“

## ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰

```csv
# trades_history.csvï¼ˆåˆ†æ‰¹å¹³ä»“50%åï¼‰
å¸ç§,æ–¹å‘,å¼€ä»“æ—¶é—´,å¹³ä»“æ—¶é—´,å¼€ä»“ä»·,å¹³ä»“ä»·æ ¼,ç›ˆäº(U),æ æ†ç‡,æ­¢æŸ,æ­¢ç›ˆ,ç›ˆäºæ¯”,å¼€ä»“ç†ç”±,å¹³ä»“ç†ç”±
BNB,ç©º,2025-11-16 12:45:00,2025-11-16 13:31:00,933,931,0.02,5,945,900,3.3,"Simple Pullback","è¾¾ç¬¬ä¸€ç›®æ ‡$931ï¼Œåˆ†æ‰¹50%"

# âŒ æ²¡æœ‰å‰©ä½™50%ä»“ä½çš„æœªå¹³ä»“è®°å½•
```

**ç»“æœ**ï¼š`get_trade_info_from_csv()` æŸ¥ä¸åˆ°æœªå¹³ä»“è®°å½• â†’ å‰ç«¯æ˜¾ç¤ºç©ºç™½

### ä¿®å¤å

```csv
# trades_history.csvï¼ˆåˆ†æ‰¹å¹³ä»“50%åï¼‰
å¸ç§,æ–¹å‘,å¼€ä»“æ—¶é—´,å¹³ä»“æ—¶é—´,å¼€ä»“ä»·,å¹³ä»“ä»·æ ¼,ç›ˆäº(U),æ æ†ç‡,æ­¢æŸ,æ­¢ç›ˆ,ç›ˆäºæ¯”,å¼€ä»“ç†ç”±,å¹³ä»“ç†ç”±
BNB,ç©º,2025-11-16 12:45:00,2025-11-16 13:31:00,933,931,0.02,5,945,900,3.3,"Simple Pullback","è¾¾ç¬¬ä¸€ç›®æ ‡$931ï¼Œåˆ†æ‰¹50%"
BNB,ç©º,2025-11-16 12:45:00,,933,,,5,945,900,3.3,"Simple Pullback [å‰©ä½™50%]",

# âœ… æ–°å¢ï¼šå‰©ä½™50%ä»“ä½çš„æœªå¹³ä»“è®°å½•ï¼ˆä¿ç•™æ‰€æœ‰å†å²ä¿¡æ¯ï¼‰
```

**ç»“æœ**ï¼š
- `get_trade_info_from_csv()` å¯ä»¥æŸ¥åˆ°æœªå¹³ä»“è®°å½•
- `current_positions.csv` åŒ…å«å®Œæ•´ä¿¡æ¯
- å‰ç«¯æ­£å¸¸æ˜¾ç¤ºï¼šå¼€ä»“æ—¶é—´ã€ä¿è¯é‡‘ã€æ æ†ç‡ã€æ­¢ç›ˆæ­¢æŸç­‰

## éªŒè¯æ–¹æ³•

1. **éƒ¨ç½²ä¿®å¤ä»£ç **
2. **ç­‰å¾…ä¸‹æ¬¡åˆ†æ‰¹å¹³ä»“è§¦å‘**
3. **æ£€æŸ¥åå°æ—¥å¿—**ï¼š
   ```
   âœ“ å¹³ä»“æˆåŠŸ
   ğŸ“ å·²åˆ›å»ºå‰©ä½™50%ä»“ä½çš„æ–°è®°å½•  # â† æ–°å¢æ—¥å¿—
   âœ“ æŒä»“å¿«ç…§å·²æ›´æ–°
   ```

4. **æ£€æŸ¥ `trades_history.csv`**ï¼š
   - åº”æœ‰2æ¡BNBè®°å½•
   - ä¸€æ¡å·²å¹³ä»“ï¼ˆå¡«å†™äº†å¹³ä»“æ—¶é—´ï¼‰
   - ä¸€æ¡æœªå¹³ä»“ï¼ˆå¹³ä»“æ—¶é—´ä¸ºç©ºï¼Œå¼€ä»“ç†ç”±æ ‡æ³¨"å‰©ä½™50%"ï¼‰

5. **æ£€æŸ¥å‰ç«¯æ˜¾ç¤º**ï¼š
   - å‰©ä½™ä»“ä½åº”æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ï¼š
     - âœ“ å¼€ä»“æ—¶é—´ï¼š2025-11-16 12:45:00
     - âœ“ ä¿è¯é‡‘ï¼šxxx U
     - âœ“ æ æ†ç‡ï¼š5x
     - âœ“ æ­¢ç›ˆï¼š$900
     - âœ“ æ­¢æŸï¼š$945
     - âœ“ ç›ˆäºæ¯”ï¼š3.3:1

## å…¼å®¹æ€§è¯´æ˜

**å‘åå…¼å®¹**ï¼š
- `close_pct` å‚æ•°æœ‰é»˜è®¤å€¼ `100`
- æ‰€æœ‰ç°æœ‰è°ƒç”¨ï¼ˆæœªä¼ å…¥æ­¤å‚æ•°ï¼‰å°†é»˜è®¤ä¸ºå®Œå…¨å¹³ä»“
- ä¸ä¼šå½±å“ç°æœ‰å¹³ä»“é€»è¾‘

**å½±å“èŒƒå›´**ï¼š
- âœ… æ–°çš„åˆ†æ‰¹å¹³ä»“ï¼šæ­£ç¡®åˆ›å»ºå‰©ä½™ä»“ä½è®°å½•
- âœ… å®Œå…¨å¹³ä»“ï¼šè¡Œä¸ºä¸å˜ï¼ˆé»˜è®¤ `close_pct=100`ï¼‰
- âœ… å†å²æ•°æ®ï¼šä¸å—å½±å“

## éƒ¨ç½²è¯´æ˜

**ä¿®æ”¹æ–‡ä»¶**ï¼š
1. `ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆ2å¤„ä¿®æ”¹ï¼‰
2. `ds/deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆ2å¤„ä¿®æ”¹ï¼‰

**éƒ¨ç½²æ­¥éª¤**ï¼š
1. åœæ­¢äº¤æ˜“æœºå™¨äºº
2. å¤‡ä»½å½“å‰ä»£ç å’Œæ•°æ®
3. æ›´æ–°æ–‡ä»¶
4. é‡å¯äº¤æ˜“æœºå™¨äºº

**å›æ»šæ–¹æ¡ˆ**ï¼š
- å¦‚æœ‰é—®é¢˜ï¼Œæ¢å¤å¤‡ä»½æ–‡ä»¶å³å¯
- å·²åˆ›å»ºçš„æ–°è®°å½•ä¸ä¼šå½±å“ç³»ç»Ÿè¿è¡Œ

## æ€»ç»“

**ä¿®å¤å‰**ï¼šåˆ†æ‰¹å¹³ä»“åï¼Œç³»ç»Ÿé”™è¯¯åœ°å°†æ•´æ¡è®°å½•æ ‡è®°ä¸ºå·²å¹³ä»“ï¼Œå¯¼è‡´å‰©ä½™ä»“ä½å¤±å»è¿½è¸ªã€‚

**ä¿®å¤å**ï¼šåˆ†æ‰¹å¹³ä»“æ—¶è‡ªåŠ¨åˆ›å»ºæ–°çš„æœªå¹³ä»“è®°å½•ï¼Œä¿ç•™æ‰€æœ‰å†å²ä¿¡æ¯ï¼Œå‰ç«¯å¯æ­£å¸¸æ˜¾ç¤ºã€‚

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š
- å‡½æ•°ç­¾åæ·»åŠ  `close_pct` å‚æ•°
- åˆ†æ‰¹å¹³ä»“æ—¶å¤åˆ¶åŸè®°å½•ï¼Œåˆ›å»ºæ–°çš„æœªå¹³ä»“è®°å½•
- ä½¿ç”¨ `pd.concat()` è¿½åŠ æ–°è®°å½•
- ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆé»˜è®¤å€¼ï¼‰

---

## é—®é¢˜2ï¼šåˆ†æ‰¹å¹³ä»“åé‡è®¾æ­¢ç›ˆæ­¢æŸç²¾åº¦é”™è¯¯

### ç°è±¡

åˆ†æ‰¹å¹³ä»“50%åï¼Œä¸ºå‰©ä½™ä»“ä½é‡è®¾æ­¢ç›ˆæ­¢æŸæ—¶å¤±è´¥ï¼š
```
ğŸ”§ ä¸ºå‰©ä½™ä»“ä½é‡è®¾ä¿æŠ¤: 0.018ä¸ª
âŒ æ­¢æŸå•è®¾ç½®å¤±è´¥: HTTP 400 - {"code":-1111,"msg":"Precision is over the maximum defined for this asset."}
âŒ æ­¢ç›ˆå•è®¾ç½®å¤±è´¥: HTTP 400 - {"code":-1111,"msg":"Precision is over the maximum defined for this asset."}
âš ï¸ å‰©ä½™ä»“ä½ä¿æŠ¤è®¾ç½®å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥
```

### æ ¹æœ¬åŸå› 

`set_tpsl_orders_via_papi` å‡½æ•°åœ¨è®¾ç½®æ­¢ç›ˆæ­¢æŸè®¢å•æ—¶ï¼Œæ²¡æœ‰å¤„ç†æ•°é‡å’Œä»·æ ¼çš„ç²¾åº¦é—®é¢˜ï¼Œç›´æ¥ä½¿ç”¨åŸå§‹å€¼å¯¼è‡´å¸å®‰APIæ‹’ç»ã€‚

### é—®é¢˜ä»£ç 

```python
# æ—§ä»£ç ï¼ˆç¬¬1396è¡Œï¼‰
def set_tpsl_orders_via_papi(...):
    # ...
    params = {
        'quantity': str(amount),  # âŒ 0.018 å¯èƒ½è¶…è¿‡ç²¾åº¦é™åˆ¶
        'stopPrice': str(stop_loss)  # âŒ ä»·æ ¼ç²¾åº¦å¯èƒ½ä¹Ÿä¸ç¬¦åˆ
    }
```

### ä¿®å¤æ–¹æ¡ˆ

åœ¨è®¾ç½®è®¢å•å‰ï¼Œè·å–å¸‚åœºç²¾åº¦ä¿¡æ¯å¹¶è¿›è¡Œèˆå…¥ï¼š

```python
def set_tpsl_orders_via_papi(symbol: str, side: str, amount: float, stop_loss: float = None, take_profit: float = None, verbose: bool = True):
    """V7.9.3 é€šè¿‡papiç«¯ç‚¹ä¸ºä»“ä½è®¾ç½®æ­¢ç›ˆæ­¢æŸè®¢å•ï¼ˆV8.5.1.3: æ·»åŠ ç²¾åº¦å¤„ç†ï¼‰"""
    # ...
    
    # ğŸ†• V8.5.1.3: è·å–å¸‚åœºç²¾åº¦ä¿¡æ¯
    try:
        markets = exchange.load_markets()
        market_info = markets.get(symbol, {})
        amount_precision = market_info.get('precision', {}).get('amount', 3)
        price_precision = market_info.get('precision', {}).get('price', 2)
        
        # å¯¹æ•°é‡å’Œä»·æ ¼è¿›è¡Œç²¾åº¦èˆå…¥
        amount = round(amount, amount_precision)
        if stop_loss:
            stop_loss = round(stop_loss, price_precision)
        if take_profit:
            take_profit = round(take_profit, price_precision)
    except Exception as e:
        if verbose:
            print(f"  âš ï¸ è·å–å¸‚åœºç²¾åº¦å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼: {e}")
        # ä½¿ç”¨é»˜è®¤ç²¾åº¦ï¼ˆBTC/ETHé€šå¸¸ä¸º3ä½ï¼Œä»·æ ¼2ä½ï¼‰
        amount = round(amount, 3)
        if stop_loss:
            stop_loss = round(stop_loss, 2)
        if take_profit:
            take_profit = round(take_profit, 2)
    
    # åç»­æ­£å¸¸è®¾ç½®è®¢å•...
```

### ä¿®å¤æ•ˆæœ

**ä¿®å¤å‰**ï¼š
- âŒ æ•°é‡ 0.018 â†’ APIæ‹’ç»ï¼ˆç²¾åº¦è¶…é™ï¼‰
- âŒ å‰©ä½™ä»“ä½æ— æ­¢ç›ˆæ­¢æŸä¿æŠ¤

**ä¿®å¤å**ï¼š
- âœ… æ•°é‡ 0.018 â†’ èˆå…¥ä¸º 0.018ï¼ˆç¬¦åˆETHçš„3ä½ç²¾åº¦ï¼‰
- âœ… ä»·æ ¼è‡ªåŠ¨èˆå…¥åˆ°2ä½å°æ•°
- âœ… æ­¢ç›ˆæ­¢æŸè®¢å•è®¾ç½®æˆåŠŸ

---

## ä¿®æ”¹æ–‡ä»¶æ±‡æ€»

**ä¿®æ”¹æ–‡ä»¶**ï¼š
1. `ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆ4å¤„ä¿®æ”¹ï¼‰
   - ç¬¬1037è¡Œï¼š`update_close_position` æ·»åŠ  `close_pct` å‚æ•°
   - ç¬¬1396è¡Œï¼š`set_tpsl_orders_via_papi` æ·»åŠ ç²¾åº¦å¤„ç†
   - ç¬¬16622è¡Œï¼šè°ƒç”¨ `update_close_position` ä¼ å…¥ `close_pct`
   - ï¼ˆéšå¼ï¼‰ï¼š`set_tpsl_orders_via_papi` çš„æ‰€æœ‰è°ƒç”¨è‡ªåŠ¨ç”Ÿæ•ˆ

2. `ds/deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆ4å¤„ä¿®æ”¹ï¼‰
   - ç¬¬1036è¡Œï¼š`update_close_position` æ·»åŠ  `close_pct` å‚æ•°
   - ç¬¬1395è¡Œï¼š`set_tpsl_orders_via_papi` æ·»åŠ ç²¾åº¦å¤„ç†
   - ç¬¬16625è¡Œï¼šè°ƒç”¨ `update_close_position` ä¼ å…¥ `close_pct`
   - ï¼ˆéšå¼ï¼‰ï¼š`set_tpsl_orders_via_papi` çš„æ‰€æœ‰è°ƒç”¨è‡ªåŠ¨ç”Ÿæ•ˆ

---

**ç‰ˆæœ¬**ï¼šV8.5.1.3
**ä¿®å¤æ—¥æœŸ**ï¼š2025-11-16
**å½±å“èŒƒå›´**ï¼šåˆ†æ‰¹å¹³ä»“åŠŸèƒ½ + æ­¢ç›ˆæ­¢æŸè®¢å•è®¾ç½®
**å‘åå…¼å®¹**ï¼šâœ… å®Œå…¨å…¼å®¹

