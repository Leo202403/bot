# V8.5.1.9.4 ä¿®å¤entry_priceæœªå®šä¹‰å¯¼è‡´çš„è®¡ç®—é”™è¯¯

## é—®é¢˜æè¿°

V8.5.1.9.3ç‰ˆæœ¬åœ¨å‰ç½®æ£€æŸ¥ä¸­ä½¿ç”¨äº†`entry_price`å˜é‡ï¼Œä½†æ­¤æ—¶è¯¥å˜é‡å°šæœªå®šä¹‰ï¼Œå¯¼è‡´ï¼š
- è®¡ç®—ç»“æœå¼‚å¸¸ï¼ˆå¦‚éœ€è¦$23770è€Œéå®é™…çš„$47ï¼‰
- å¯èƒ½è§¦å‘NameErroræˆ–ä½¿ç”¨äº†é”™è¯¯çš„å€¼

### é”™è¯¯ç¤ºä¾‹
```
æ™ºèƒ½è®¡ç®—ä»“ä½: $16.84
æ æ†: 4x
âŒ è´¦æˆ·èµ„é‡‘ä¸è¶³ï¼šéœ€$23770U (å½“å‰ä»…$96U)  # â† è®¡ç®—å®Œå…¨é”™è¯¯ï¼
```

## æ ¹å› åˆ†æ

### åŸä»£ç æµç¨‹ï¼ˆV8.5.1.9.3ï¼‰
```python
# ç¬¬18103è¡Œï¼šV8.5.1.9.3å‰ç½®æ£€æŸ¥
calculated_amount = (planned_position * leverage) / entry_price  # â† entry_priceæœªå®šä¹‰ï¼

# ç¬¬18044è¡Œï¼šåç»­æ‰è·å–entry_price
ticker = exchange.fetch_ticker(symbol)
entry_price = ticker["last"]
```

**é—®é¢˜**ï¼šå‰ç½®æ£€æŸ¥åœ¨ç¬¬18103è¡Œæ‰§è¡Œï¼Œä½†`entry_price`è¦åˆ°ç¬¬18044è¡Œæ‰å®šä¹‰ï¼ˆå®é™…ä¸Šentry_priceçš„è·å–åœ¨æ›´åé¢çš„æµç¨‹ä¸­ï¼‰ã€‚

### ä¸ºä»€ä¹ˆä¼šæ˜¾ç¤º$23770ï¼Ÿ
```python
# å¦‚æœentry_price = Noneæˆ–0ï¼Œå¯¼è‡´é™¤é›¶é”™è¯¯æˆ–è®¡ç®—å¼‚å¸¸
calculated_amount = (16.84 * 4) / 0  # â†’ å¼‚å¸¸
# æˆ–è€…ä½¿ç”¨äº†æŸä¸ªé”™è¯¯çš„å…¨å±€å˜é‡å€¼
```

## è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ç­–ç•¥
åœ¨V8.5.1.9.4å‰ç½®æ£€æŸ¥ä¸­**å•ç‹¬è·å–**`entry_price_check`ï¼Œé¿å…ä¸åç»­æµç¨‹çš„`entry_price`å˜é‡å†²çªã€‚

### å…³é”®æ”¹åŠ¨

#### 1. ç‹¬ç«‹è·å–ä»·æ ¼
```python
# ğŸ”§ V8.5.1.9.4: æå‰è·å–entry_price
try:
    ticker = exchange.fetch_ticker(symbol)
    entry_price_check = ticker["last"]  # ä½¿ç”¨ç‹¬ç«‹å˜é‡å
except Exception as e:
    print(f"âš ï¸ è·å–ä»·æ ¼å¤±è´¥ï¼Œè·³è¿‡å‰ç½®æ£€æŸ¥: {e}")
    entry_price_check = None

if entry_price_check and entry_price_check > 0:
    # åç»­æ‰€æœ‰è®¡ç®—éƒ½åœ¨æ­¤ifå—å†…
    ...
```

#### 2. æ‰€æœ‰é€»è¾‘åŒ…å«åœ¨ifå—å†…
```python
if entry_price_check and entry_price_check > 0:
    import math
    
    # è·å–ç²¾åº¦
    try:
        markets = exchange.load_markets()
        market_info = markets.get(symbol, {})
        amount_precision = market_info.get('precision', {}).get('amount', 3)
    except:
        amount_precision = 3
    
    # è®¡ç®—ï¼ˆä½¿ç”¨entry_price_checkï¼‰
    calculated_amount = (planned_position * leverage) / entry_price_check
    
    # ... æ‰€æœ‰åç»­é€»è¾‘ ...
    
    if actual_notional < MIN_NOTIONAL:
        # è°ƒæ•´ä»“ä½é€»è¾‘
        min_position_required = (required_amount * entry_price_check) / leverage
        
        if min_position_required <= total_assets * 0.8:
            planned_position = min_position_required
        else:
            return  # èµ„é‡‘ä¸è¶³ï¼Œæå‰é€€å‡º
```

#### 3. æ­£ç¡®çš„è®¡ç®—ç¤ºä¾‹
```python
# BTCç¤ºä¾‹ï¼š
entry_price_check = $95,300
planned_position = $16.84
leverage = 4x

calculated_amount = (16.84 * 4) / 95300 = 0.000707 BTC
rounded_amount = round(0.000707 / 0.001) * 0.001 = 0.001 BTC
actual_notional = 0.001 * 95300 = $95.3 < $100

# éœ€è¦è°ƒæ•´åˆ°:
target_notional = 100 * 1.2 = $120
min_amount_needed = 120 / 95300 = 0.001259 BTC
required_amount = ceil(0.001259 / 0.001) * 0.001 = 0.002 BTC
min_position_required = (0.002 * 95300) / 4 = $47.65  # â† æ­£ç¡®ï¼
```

## ä¿®å¤æ–‡ä»¶
- `ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼šç¬¬18103-18179è¡Œ
- `ds/deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼šç¬¬18106-18182è¡Œ

## æµ‹è¯•éªŒè¯

### é¢„æœŸè¡Œä¸º
1. **ä»·æ ¼è·å–æˆåŠŸ**ï¼š
   ```
   âœ“ ä½¿ç”¨AIå»ºè®®æ æ†: 4x
   ğŸ’¡ ä»“ä½è‡ªåŠ¨è°ƒæ•´: $16.84 â†’ $47.65 (è€ƒè™‘ç²¾åº¦ååä¹‰ä»·å€¼â‰¥$100)
   ```

2. **ä»·æ ¼è·å–å¤±è´¥**ï¼š
   ```
   âš ï¸ è·å–ä»·æ ¼å¤±è´¥ï¼Œè·³è¿‡å‰ç½®æ£€æŸ¥: [é”™è¯¯ä¿¡æ¯]
   # ç»§ç»­åç»­æµç¨‹ï¼Œä¸å½±å“æ­£å¸¸ä¸‹å•
   ```

3. **èµ„é‡‘çœŸæ­£ä¸è¶³**ï¼š
   ```
   âŒ è´¦æˆ·èµ„é‡‘ä¸è¶³ï¼šéœ€$48U (å½“å‰ä»…$10U)
   [Barkæ¨é€] âœ… æ¨é€æˆåŠŸ
   ```

## æŠ€æœ¯è¦ç‚¹

### å˜é‡ä½œç”¨åŸŸç®¡ç†
- **`entry_price_check`**ï¼šä»…ç”¨äºV8.5.1.9.4å‰ç½®æ£€æŸ¥
- **`entry_price`**ï¼šåç»­æµç¨‹ä¸­æ­£å¸¸è·å–ä½¿ç”¨
- **é¿å…å†²çª**ï¼šä½¿ç”¨ç‹¬ç«‹å˜é‡åç¡®ä¿äº’ä¸å¹²æ‰°

### é”™è¯¯å¤„ç†
```python
try:
    ticker = exchange.fetch_ticker(symbol)
    entry_price_check = ticker["last"]
except Exception as e:
    print(f"âš ï¸ è·å–ä»·æ ¼å¤±è´¥ï¼Œè·³è¿‡å‰ç½®æ£€æŸ¥: {e}")
    entry_price_check = None  # æ˜ç¡®è®¾ç½®ä¸ºNone

if entry_price_check and entry_price_check > 0:
    # æ‰€æœ‰é€»è¾‘åœ¨æ­¤æ¡ä»¶ä¸‹æ‰§è¡Œ
    ...
# å¦‚æœè·å–å¤±è´¥ï¼Œç›´æ¥è·³è¿‡å‰ç½®æ£€æŸ¥ï¼Œä¸å½±å“åç»­æµç¨‹
```

### ç²¾åº¦èˆå…¥ä¿æŠ¤
```python
rounded_amount = round(calculated_amount / amount_step) * amount_step

# ä¿æŠ¤ï¼šå¦‚æœèˆå…¥å¯¼è‡´ä¸¥é‡æŸå¤±ï¼Œä½¿ç”¨åŸå§‹å€¼
if rounded_amount < calculated_amount * 0.1:
    rounded_amount = calculated_amount
```

## ç‰ˆæœ¬å†å²
- **V8.5.1.9**: é¦–æ¬¡å¼•å…¥æœ€å°åä¹‰ä»·å€¼å‰ç½®æ£€æŸ¥ï¼ˆä½¿ç”¨`planned_position * leverage`ï¼Œæœªè€ƒè™‘ç²¾åº¦ï¼‰
- **V8.5.1.9.1**: ä¿®å¤è¿‡åº¦èˆå…¥é—®é¢˜ï¼ˆ`math.floor` â†’ `round`ï¼‰
- **V8.5.1.9.2**: å¼•å…¥åŠ¨æ€MIN_NOTIONALï¼ˆBTC=100, å…¶ä»–=5ï¼‰
- **V8.5.1.9.3**: å‰ç½®æ£€æŸ¥ä¸­é›†æˆç²¾åº¦èˆå…¥æ¨¡æ‹Ÿï¼ˆä½†entry_priceæœªå®šä¹‰ï¼‰
- **V8.5.1.9.4**: âœ… ä¿®å¤entry_priceæœªå®šä¹‰é—®é¢˜ï¼Œä½¿ç”¨ç‹¬ç«‹çš„`entry_price_check`

## éƒ¨ç½²è¯´æ˜

### æ›´æ–°æ–‡ä»¶
```bash
cd /root/10-23-bot
git pull origin main
```

### é‡å¯æœåŠ¡
```bash
pm2 restart qwen
pm2 restart deepseek
```

### éªŒè¯
è§‚å¯Ÿä¸‹ä¸€ä¸ªå¼€ä»“å‘¨æœŸçš„æ—¥å¿—ï¼Œç¡®è®¤ï¼š
- âœ… ä¸å†æ˜¾ç¤ºå¼‚å¸¸çš„$23770ç­‰é”™è¯¯é‡‘é¢
- âœ… BTCä»“ä½è°ƒæ•´æ˜¾ç¤ºæ­£ç¡®ï¼ˆçº¦$47.65ï¼‰
- âœ… å…¶ä»–å¸ç§èƒ½æ­£å¸¸å¼€ä»“ï¼ˆåä¹‰ä»·å€¼â‰¥$5ï¼‰

