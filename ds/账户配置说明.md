# 账户配置说明

## 📊 系统架构

本交易系统使用**两个独立的币安账户**并行运行：

```
┌─────────────────────────────────────────────────┐
│                交易系统                          │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌──────────────────┐    ┌──────────────────┐  │
│  │   DeepSeek       │    │     Qwen         │  │
│  │   Trading Bot    │    │  Trading Bot     │  │
│  └────────┬─────────┘    └────────┬─────────┘  │
│           │                       │             │
│           ↓                       ↓             │
│  ┌──────────────────┐    ┌──────────────────┐  │
│  │  币安账户 A      │    │  币安账户 B      │  │
│  │  (.env)          │    │  (.env.qwen)     │  │
│  │  初始: 100U      │    │  初始: 100U      │  │
│  └──────────────────┘    └──────────────────┘  │
│                                                 │
└─────────────────────────────────────────────────┘
```

## 🔑 环境变量配置

### DeepSeek账户 (`ds/.env`)

```bash
# AI模型配置
DEEPSEEK_API_KEY=your_deepseek_key

# 币安交易所配置 (DeepSeek专用账户)
EXCHANGE_TYPE=binance
BINANCE_API_KEY=deepseek_binance_api_key
BINANCE_SECRET_KEY=deepseek_binance_secret
USE_PORTFOLIO_MARGIN=true

# 其他配置...
```

### Qwen账户 (`ds/.env.qwen`)

```bash
# AI模型配置
QWEN_API_KEY=your_qwen_key

# 币安交易所配置 (Qwen专用账户)
EXCHANGE_TYPE=binance
BINANCE_API_KEY=qwen_binance_api_key
BINANCE_SECRET_KEY=qwen_binance_secret
USE_PORTFOLIO_MARGIN=true

# 其他配置...
```

## 📂 数据目录结构

```
ds/
├── .env                          # DeepSeek配置
├── .env.qwen                     # Qwen配置
├── deepseek_多币种智能版.py      # DeepSeek交易程序
├── qwen_多币种智能版.py          # Qwen交易程序
└── trading_data/
    ├── deepseek/                 # DeepSeek数据目录
    │   ├── system_status.json    # DeepSeek账户状态
    │   ├── trades_history.csv    # DeepSeek交易记录
    │   └── ...
    └── qwen/                     # Qwen数据目录
        ├── system_status.json    # Qwen账户状态
        ├── trades_history.csv    # Qwen交易记录
        └── ...
```

## 💰 初始资金

- **DeepSeek账户**: 100 USDT
- **Qwen账户**: 100 USDT
- **系统总计**: 200 USDT

## 📊 数据独立性

### 完全独立的数据

| 项目 | DeepSeek | Qwen | 是否共享 |
|-----|----------|------|---------|
| 币安账户 | 账户A | 账户B | ❌ 独立 |
| API密钥 | .env | .env.qwen | ❌ 独立 |
| 总资产 | 独立计算 | 独立计算 | ❌ 独立 |
| 持仓 | 独立管理 | 独立管理 | ❌ 独立 |
| 订单历史 | 独立记录 | 独立记录 | ❌ 独立 |
| AI模型 | DeepSeek | Qwen | ❌ 独立 |

### 共享的配置

| 项目 | 说明 |
|-----|------|
| 交易对 | BTC, ETH, SOL, BNB, XRP, DOGE, LTC |
| 最大杠杆 | ≤5x |
| 账户模式 | 统一账户(Portfolio Margin) |
| 交易策略 | AI智能多空策略 + 裸K分析 |

## 🔄 数据恢复

当需要从币安API恢复数据时：

### 使用 `restore_from_binance_papi.py`

```bash
cd /root/10-23-bot/ds
python3 restore_from_binance_papi.py

# 选项：
# 1) 仅恢复DeepSeek账户 → 从币安账户A获取数据
# 2) 仅恢复Qwen账户 → 从币安账户B获取数据
# 3) 恢复两个账户 → 分别从两个币安账户获取数据
```

### 工具行为

1. **连接DeepSeek账户**:
   - 读取 `ds/.env`
   - 使用 `BINANCE_API_KEY` 和 `BINANCE_SECRET_KEY`
   - 获取账户A的数据
   - 更新 `trading_data/deepseek/` 目录

2. **连接Qwen账户**:
   - 读取 `ds/.env.qwen`
   - 使用 `BINANCE_API_KEY` 和 `BINANCE_SECRET_KEY`
   - 获取账户B的数据
   - 更新 `trading_data/qwen/` 目录

## ⚠️ 重要注意事项

### 1. API密钥不能混用

❌ **错误做法**:
```bash
# .env 和 .env.qwen 使用相同的API密钥
BINANCE_API_KEY=same_key_for_both  # 错误！
```

✅ **正确做法**:
```bash
# .env (DeepSeek专用)
BINANCE_API_KEY=account_a_api_key

# .env.qwen (Qwen专用)
BINANCE_API_KEY=account_b_api_key
```

### 2. 总资产 = DeepSeek资产 + Qwen资产

前端显示的"综合总资产"是两个账户的总和：

```
综合总资产 = DeepSeek账户总资产 + Qwen账户总资产
           = 105.23 + 110.45
           = 215.68 USDT
```

### 3. 数据恢复必须分别执行

不能用一个账户的数据恢复另一个账户：

❌ **错误**: 用DeepSeek的数据恢复Qwen
✅ **正确**: 用Qwen账户的API获取Qwen的数据

### 4. 备份文件命名

恢复工具会自动区分：
- `deepseek_system_status.json` - DeepSeek的备份
- `qwen_system_status.json` - Qwen的备份

## 🧪 验证配置

### 检查API密钥配置

```bash
cd /root/10-23-bot/ds

# 检查DeepSeek配置
echo "DeepSeek API Key:"
grep BINANCE_API_KEY .env | head -c 30

# 检查Qwen配置
echo "Qwen API Key:"
grep BINANCE_API_KEY .env.qwen | head -c 30

# 应该显示不同的密钥前缀
```

### 测试连接

```bash
# 测试DeepSeek账户连接
python3 << 'EOF'
from dotenv import load_dotenv
import ccxt, os
from pathlib import Path

load_dotenv(Path(__file__).parent / 'ds/.env')
exchange = ccxt.binance({
    'apiKey': os.getenv('BINANCE_API_KEY'),
    'secret': os.getenv('BINANCE_SECRET_KEY'),
    'options': {'portfolioMargin': True}
})
balance = exchange.fetch_balance()
print(f"DeepSeek账户总资产: {balance['total']['USDT']} USDT")
EOF

# 测试Qwen账户连接
python3 << 'EOF'
from dotenv import load_dotenv
import ccxt, os
from pathlib import Path

load_dotenv(Path(__file__).parent / 'ds/.env.qwen')
exchange = ccxt.binance({
    'apiKey': os.getenv('BINANCE_API_KEY'),
    'secret': os.getenv('BINANCE_SECRET_KEY'),
    'options': {'portfolioMargin': True}
})
balance = exchange.fetch_balance()
print(f"Qwen账户总资产: {balance['total']['USDT']} USDT")
EOF
```

## 📈 监控与管理

### 前端显示

前端会分别显示两个账户的数据：

- **DeepSeek标签页**: 显示账户A的数据
- **Qwen标签页**: 显示账户B的数据
- **综合标签页**: 显示两个账户的合并数据

### 日志监控

```bash
# DeepSeek日志
tail -f /root/10-23-bot/ds/deepseek.log

# Qwen日志
tail -f /root/10-23-bot/ds/qwen.log
```

## 🔒 安全建议

1. **API权限**: 建议只给读取和交易权限，不给提币权限
2. **IP白名单**: 在币安后台设置服务器IP白名单
3. **文件权限**: 
   ```bash
   chmod 600 /root/10-23-bot/ds/.env
   chmod 600 /root/10-23-bot/ds/.env.qwen
   ```
4. **定期检查**: 定期对比本地数据和币安实际数据

## 📞 常见问题

### Q1: 为什么要用两个账户？

**A**: 
- ✅ 风险隔离：一个账户出问题不影响另一个
- ✅ 策略对比：DeepSeek和Qwen的交易表现独立评估
- ✅ 资金管理：更灵活的资金分配

### Q2: 可以用一个账户吗？

**A**: 技术上可以，但需要修改代码。不推荐，因为：
- ❌ 无法独立评估两个AI模型的表现
- ❌ 持仓管理会变复杂
- ❌ 数据统计会混在一起

### Q3: 两个账户会互相影响吗？

**A**: 不会。它们：
- ✅ 使用不同的API密钥
- ✅ 访问不同的币安账户
- ✅ 存储在不同的数据目录
- ✅ 完全独立运行

### Q4: 恢复数据时选错了账户怎么办？

**A**: 从备份恢复：
```bash
cd /root/10-23-bot/ds/data_backup
ls -lt  # 找到最新的备份
cp before_binance_restore_YYYYMMDD_HHMMSS/deepseek_*.* ../trading_data/deepseek/
```

## 📚 相关文档

- `README_从币安恢复数据.md` - 数据恢复详细指南
- `数据修正说明.md` - 本地数据修正方法
- `restore_from_binance_papi.py` - 恢复工具源码

## ✅ 配置检查清单

运行前确认：

- [ ] 两个 .env 文件都已正确配置
- [ ] API密钥不同且有效
- [ ] 两个币安账户都开通了统一账户模式
- [ ] 初始资金已充值（各100U）
- [ ] 数据目录权限正确
- [ ] 防火墙允许访问币安API
- [ ] 服务器时间同步正确

---

**最后更新**: 2025-11-20  
**版本**: V1.0

