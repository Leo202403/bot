#!/bin/bash
# V8.3.21 æœåŠ¡å™¨æ—¶åŒºä¿®å¤è„šæœ¬
# è¯·åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ­¤è„šæœ¬

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "V8.3.21 æœåŠ¡å™¨æ—¶åŒºä¿®å¤"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“ å½“å‰ä½ç½®: $(pwd)"
echo "â° å½“å‰æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
echo ""

# 1. æ‹‰å–æœ€æ–°ä»£ç 
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥éª¤1: æ‹‰å–æœ€æ–°ä»£ç "
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

cd ~/10-23-bot
git pull origin main

if [ $? -ne 0 ]; then
    echo "âŒ æ‹‰å–ä»£ç å¤±è´¥"
    exit 1
fi

echo "âœ… ä»£ç æ‹‰å–æˆåŠŸ"
echo ""

# 2. æ£€æŸ¥æ•°æ®ï¼ˆä¸ä¿®æ”¹ï¼‰
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥éª¤2: æ£€æŸ¥æ•°æ®ï¼ˆä¸ä¼šä¿®æ”¹ä»»ä½•æ–‡ä»¶ï¼‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

cd ~/10-23-bot/ds
python3 fix_timezone_data.py --dry-run

if [ $? -ne 0 ]; then
    echo "âŒ æ£€æŸ¥å¤±è´¥"
    exit 1
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ£€æŸ¥å®Œæˆï¼"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# 3. è¯¢é—®æ˜¯å¦ä¿®å¤
read -p "â“ å‘ç°éœ€è¦ä¿®å¤çš„æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­ä¿®å¤ï¼Ÿ(yes/no): " answer

if [ "$answer" != "yes" ]; then
    echo "âŒ å·²å–æ¶ˆä¿®å¤"
    exit 0
fi

# 4. ä¿®å¤æ•°æ®
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥éª¤3: ä¿®å¤æ•°æ®"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# ä¿®å¤æ—¶è‡ªåŠ¨å›ç­”yes
echo "yes" | python3 fix_timezone_data.py

if [ $? -ne 0 ]; then
    echo "âŒ ä¿®å¤å¤±è´¥"
    exit 1
fi

echo "âœ… ä¿®å¤å®Œæˆ"
echo ""

# 5. éªŒè¯ä¿®å¤ç»“æœ
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ­¥éª¤4: éªŒè¯ä¿®å¤ç»“æœ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

python3 fix_timezone_data.py --dry-run

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… æ—¶åŒºä¿®å¤å®Œæˆï¼"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“ å¤‡ä»½æ–‡ä»¶ä½ç½®ï¼š"
echo "   ~/10-23-bot/ds/trading_data/*/*.bak_before_timezone_fix"
echo ""
echo "ğŸ“ æŸ¥çœ‹å¤‡ä»½ï¼š"
ls -lh ~/10-23-bot/ds/trading_data/qwen/*.bak_before_timezone_fix 2>/dev/null
ls -lh ~/10-23-bot/ds/trading_data/deepseek/*.bak_before_timezone_fix 2>/dev/null
echo ""
echo "ğŸ’¡ å¦‚éœ€å›æ»šï¼Œè¿è¡Œï¼š"
echo "   cd ~/10-23-bot/ds/trading_data/qwen"
echo "   cp *.bak_before_timezone_fix ."
echo ""
echo "âœ… å®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
echo ""

