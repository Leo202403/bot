# V8.5.1.1 修复说明

## 修复时间
2025-11-15

## 问题描述

从日志发现两个问题：

1. **代码错误**: `name 'model_display_name' is not defined`
   - 变量在第17147和17161行被使用但未定义
   
2. **Bark推送404错误**: URL过长导致推送失败
   - 日志显示：`Cannot GET /xxx...936.0`（URL在936字符处被截断）
   - 虽然已截断内容到100字符，但中文URL编码后仍超限

## 修复方案

### 1. 定义模型显示名称常量

**deepseek_多币种智能版.py**:
```python
# ==================== 全局配置 ====================
MODEL_DISPLAY_NAME = "DS"  # 用于Bark推送标题的简短模型名称
```

**qwen_多币种智能版.py**:
```python
# ==================== 全局配置 ====================
MODEL_DISPLAY_NAME = "QW"  # 用于Bark推送标题的简短模型名称
```

### 2. 更新变量引用

将所有 `model_display_name` 替换为 `MODEL_DISPLAY_NAME`：
- 第17147行：`f"[{MODEL_DISPLAY_NAME}]{coin_name}仓位智能调整✅"`
- 第17161行：`f"[{MODEL_DISPLAY_NAME}]{coin_name}开仓取消❌"`

### 3. 进一步收紧Bark URL长度限制

从 `send_bark_notification()` 函数中：

**修改前**:
```python
MAX_TITLE_LEN = 40   # 编码后~120字符
MAX_CONTENT_LEN = 100  # 编码后~300字符
```

**修改后**:
```python
MAX_TITLE_LEN = 30   # 编码后~90字符
MAX_CONTENT_LEN = 60  # 编码后~180字符
```

## 修复文件

1. `/Users/mac-bauyu/Downloads/10-23-bot/ds/deepseek_多币种智能版.py`
2. `/Users/mac-bauyu/Downloads/10-23-bot/ds/qwen_多币种智能版.py`

## 预期效果

1. ✅ 消除 `model_display_name` 未定义错误
2. ✅ 避免Bark推送URL过长导致404错误
3. ✅ 保持推送功能正常工作

## 版本标识

- 版本号: V8.5.1.1
- 基于: V8.5.1
- 修复类型: 紧急bug修复









