# 🎯 评分函数优化：以平均利润为核心

## 📊 用户建议

**问题**：当前评分函数是否应该**以平均利润为主要标准**，这样更贴近实际？

**回答**：✅ 非常正确！已实施。

## 🔄 优化对比

### 修改前（V8.3.21.5）

```python
# 权重分配
expectancy_score * 0.50 +      # 期望收益 50%
plr_score * 0.25 +              # 盈亏比 25%
capture_score * 0.15 +          # 捕获率 15%
- drawdown_penalty * 0.10       # 回撤惩罚 -10%
```

**问题**：
- ❌ 期望收益权重过高（50%）
- ❌ 不直接考虑平均利润
- ❌ 可能选择低胜率但高盈亏比的参数

### 修改后（V8.3.21.6）

```python
# 权重分配
avg_profit_score * 0.40 +       # 平均利润 40%（新增，最直观）
expectancy_score * 0.25 +       # 期望收益 25%（降低）
win_rate_score * 0.15 +         # 胜率 15%（新增，心理因素）
plr_score * 0.10 +              # 盈亏比 10%（降低）
- drawdown_penalty * 0.10       # 回撤惩罚 -10%
```

**改进**：
- ✅ 平均利润成为核心（40%）
- ✅ 新增胜率考量（15%）
- ✅ 更平衡的风险收益

## 📈 实际案例对比

### 案例1：高盈亏比 vs 高平均利润

**配置A**：
- 平均利润：3%
- 期望收益：2.5%
- 胜率：50%
- 盈亏比：2.5

**配置B**：
- 平均利润：4%
- 期望收益：3.0%
- 胜率：70%
- 盈亏比：1.8

**旧评分**：
```
配置A: 0.5*0.50 + 0.83*0.25 + ... = 0.46
配置B: 0.53*0.50 + 0.60*0.25 + ... = 0.48
差距很小，可能选A
```

**新评分**：
```
配置A: 0.15*0.40 + 0.5*0.50 + 0.5*0.15 + 0.83*0.10 = 0.41
配置B: 0.20*0.40 + 0.53*0.53 + 0.7*0.15 + 0.60*0.10 = 0.52
明确选B（平均利润更高，胜率更高）
```

### 案例2：保守 vs 激进

**配置C**（保守）：
- 平均利润：2%
- 期望收益：1.8%
- 胜率：80%
- 盈亏比：1.5

**配置D**（激进）：
- 平均利润：5%
- 期望收益：2.0%
- 胜率：40%
- 盈亏比：4.0

**旧评分**：
```
配置C: 0.45*0.50 + 0.50*0.25 + ... = 0.40
配置D: 0.47*0.50 + 1.0*0.25 + ... = 0.49
可能选D（高盈亏比）
```

**新评分**：
```
配置C: 0.10*0.40 + 0.45*0.25 + 0.8*0.15 + 0.50*0.10 = 0.32
配置D: 0.25*0.40 + 0.47*0.25 + 0.4*0.15 + 1.0*0.10 = 0.39
仍选D，但差距缩小，且考虑了胜率因素
```

## 🎯 新评分逻辑

### 1. 平均利润（40%）- 最直观

```python
avg_profit_score = min(1.0, avg_profit / 20)
```

**含义**：
- 平均利润越高，得分越高
- 20%为满分（非常优秀）
- 直接反映最终收益

**示例**：
- 2% → 0.10分
- 5% → 0.25分
- 10% → 0.50分
- 20% → 1.00分

### 2. 期望收益（25%）- 风险调整

```python
expectancy = (win_rate * avg_win) + ((1 - win_rate) * avg_loss)
expectancy_score = min(1.0, (expectancy + 5) / 15)
```

**含义**：
- 考虑胜率和亏损
- 风险调整后的收益
- 符合凯利公式

### 3. 胜率（15%）- 心理因素

```python
win_rate_score = win_rate
```

**含义**：
- 高胜率降低心理压力
- 避免选择低胜率参数
- 提高执行一致性

**示例**：
- 50% → 0.50分
- 70% → 0.70分
- 90% → 0.90分

### 4. 盈亏比（10%）- 辅助指标

```python
plr_score = min(1.0, profit_loss_ratio / 3.0)
```

**含义**：
- 赚的时候赚多少 vs 亏的时候亏多少
- 3.0为满分（优秀）
- 权重降低（不再是核心）

### 5. 回撤惩罚（-10%）- 风险控制

```python
drawdown_penalty = min(1.0, abs(max_drawdown) / 10)
```

**含义**：
- 连续亏损越多，扣分越多
- 10%回撤扣满分
- 控制极端风险

## 📊 权重设计理念

### 核心原则

1. **平均利润优先**（40%）
   - 最直观的收益指标
   - 直接反映最终结果
   - 用户最关心的指标

2. **风险调整**（25%）
   - 期望收益考虑胜率
   - 不盲目追求高利润
   - 平衡收益与风险

3. **心理因素**（15%）
   - 胜率影响执行
   - 低胜率难以坚持
   - 提高策略可持续性

4. **辅助指标**（10%）
   - 盈亏比作为参考
   - 不过度强调
   - 避免极端参数

5. **风险控制**（-10%）
   - 惩罚高回撤
   - 保护本金
   - 避免爆仓风险

## 🔍 验证方法

### 回测后检查

```bash
# 观察优化器选择的参数
✅ 平均利润应该是所有候选中最高或接近最高
✅ 胜率应该≥60%
✅ 期望收益应该>2%
✅ 回撤应该<5%
```

### 实际交易验证

```bash
# 1周后统计
✅ 实际平均利润应该>2%
✅ 实际胜率应该>60%
✅ 最大连续亏损<3笔
```

## 💡 为什么这样更好

### 1. 直观性

**旧方案**：期望收益50%
- 用户不理解期望收益
- 难以验证是否正确

**新方案**：平均利润40%
- 用户一眼就懂
- 容易验证（看交易记录）

### 2. 实用性

**旧方案**：可能选择低胜率参数
- 胜率40%，盈亏比5.0
- 心理压力大，难以执行

**新方案**：平衡胜率和利润
- 胜率70%，盈亏比2.0
- 更容易坚持执行

### 3. 可验证性

**旧方案**：期望收益难以验证
- 需要长期统计
- 短期波动大

**新方案**：平均利润容易验证
- 每周可以计算
- 直接对比回测预期

## 🎯 总结

### 核心改进

✅ **平均利润成为核心指标（40%）**
✅ **新增胜率考量（15%）**
✅ **更平衡的评分体系**

### 预期效果

- 选择的参数更贴近实际收益
- 避免低胜率高盈亏比的极端参数
- 提高策略的可执行性和可持续性

### 验证标准

回测后检查：
- ✅ 平均利润应该是最高的
- ✅ 胜率应该≥60%
- ✅ 期望收益应该>2%

---

**感谢用户的建议！这个改进让评分函数更加实用和直观。**

