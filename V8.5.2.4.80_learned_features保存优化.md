# V8.5.2.4.80: Learned Featuresä¿å­˜ä¼˜åŒ–

## ğŸ“Š Phase 2 Learned Featuresæ•°æ®æ¢³ç†

### å½“å‰ä¿å­˜çš„æ•°æ®ï¼ˆç¬¬7713-7725è¡Œï¼‰

```python
'learned_features': {
    # 1ï¸âƒ£ çœŸå®æŒä»“æ—¶é•¿ï¼ˆä»Phase 1ç»Ÿè®¡ï¼‰
    'scalping_real_holding_hours': 3.4,     # è¶…çŸ­çº¿çœŸå®æŒä»“
    'swing_real_holding_hours': 16.9,       # æ³¢æ®µçœŸå®æŒä»“
    
    # 2ï¸âƒ£ å‚æ•°æœç´¢èŒƒå›´ï¼ˆåŸºäºçœŸå®å€¼åŠ¨æ€è®¡ç®—ï¼‰
    'scalping_params_range': {
        'atr_tp': [8.7, 10.6, 12.4, 14.3],  # TPèŒƒå›´
        'atr_sl': [1.5, 2.0, 2.5, 3.0],     # SLèŒƒå›´
        'holding': [2, 2.7, 3.4, 5.1]       # æŒä»“æ—¶é•¿èŒƒå›´
    },
    'swing_params_range': {
        'atr_tp': [12.0, 13.6, 16.3, 20.4],
        'atr_sl': [2.5, 3.0, 3.5, 4.0],
        'holding': [12, 13.5, 16.9, 25.4]
    },
    
    # 3ï¸âƒ£ æƒé‡å€™é€‰ç»„åˆï¼ˆ3ç»„ï¼‰
    'scalping_weight_candidates': [
        {'name': 'é»˜è®¤', 'weights': {...}},
        {'name': 'åŠ¨é‡ä¼˜å…ˆ', 'weights': {...}},
        {'name': 'å¹³è¡¡', 'weights': {...}}
    ],
    'swing_weight_candidates': [
        {'name': 'é»˜è®¤', 'weights': {...}},
        {'name': 'è¶‹åŠ¿ä¼˜å…ˆ', 'weights': {...}},
        {'name': 'å¹³è¡¡', 'weights': {...}}
    ],
    
    # 4ï¸âƒ£ æœ€ä¼˜æƒé‡é…ç½®ï¼ˆPhase 2æµ‹è¯•ç»“æœï¼‰
    'best_scalping_weights': {
        'name': 'é»˜è®¤',
        'weights': {
            'trend_alignment': 0.35,
            'price_action': 0.25,
            'indicator_consensus': 0.20,
            'sr_strength': 0.20
        },
        'score': 0.964  # æ•è·ç‡å¾—åˆ†
    },
    'best_swing_weights': {
        'name': 'é»˜è®¤',
        'weights': {...},
        'score': 1.000
    },
    
    # 5ï¸âƒ£ Top5å‚æ•°ç»„åˆï¼ˆPhase 2æµ‹è¯•ç»“æœï¼‰
    'top5_param_combos': [
        {
            'name': 'è¶…å®½æ¾-ä½åˆ†',
            'params': {
                'min_risk_reward': 1.0,
                'min_indicator_consensus': 1,
                'min_signal_score': 70
            },
            'captured_count': 1729,
            'capture_rate': 0.432,
            'avg_profit': 0.0643,
            'total_profit': 4224
        },
        # ... å…¶ä»–4ç»„
    ],
    
    # 6ï¸âƒ£ æœ€ä¼˜TP/SLï¼ˆPhase 2æµ‹è¯•ç»“æœï¼‰
    'optimal_tp_sl': {
        'scalping': {'tp': 18.7, 'sl': 1.5},
        'swing': {'tp': 20.4, 'sl': 2.5}
    },
    
    # 7ï¸âƒ£ å®Œæ•´Phase 1æ•°æ®
    'phase1_baseline': {
        'scalping_opportunities': 2000,
        'swing_opportunities': 2000,
        'avg_scalping_profit': 0.1527,
        'avg_swing_profit': 0.1627
    }
}
```

---

## âŒ å½“å‰é—®é¢˜

### é—®é¢˜1ï¼šPhase 2ä¸ä¿å­˜ï¼Œlearned_featuresä¸¢å¤±

**V8.5.2.4.79ä¿®æ”¹**ï¼š
```python
# ç¬¬10886è¡Œï¼šæ³¨é‡Šæ‰Phase 2ä¿å­˜
# save_learning_config(config)  # â† ä¸ä¿å­˜äº†
```

**åæœ**ï¼š
- âŒ **learned_featuresæ²¡æœ‰ä¿å­˜åˆ°æ–‡ä»¶**
- âŒ **Phase 3è™½ç„¶èƒ½ç”¨ï¼ˆåœ¨å†…å­˜ä¸­ï¼‰ï¼Œä½†ä¸‹æ¬¡å›æµ‹æ— æ³•å‚è€ƒ**
- âŒ **å†å²å­¦ä¹ æˆæœä¸¢å¤±**

### é—®é¢˜2ï¼šlearned_featuresåªåœ¨phase2_baselineä¸­

**å½“å‰ä½ç½®**ï¼š
- Phase 2ç”Ÿæˆï¼šç¬¬7707-7778è¡Œ
- Phase 3ä½¿ç”¨ï¼šé€šè¿‡phase2_baselineä¼ é€’
- **ä½†ä¸ä¿å­˜åˆ°configæ–‡ä»¶**

**é—®é¢˜**ï¼š
- learned_featuresåªåœ¨å½“æ¬¡å›æµ‹çš„å†…å­˜ä¸­
- ä¸‹æ¬¡å›æµ‹æ— æ³•å‚è€ƒå†å²å­¦ä¹ æˆæœ
- æ— æ³•è¿½è¸ªå‚æ•°æ¼”åŒ–å†å²

---

## âœ… ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå°†learned_featuresä¿å­˜åˆ°configï¼ˆæ¨èï¼‰

#### æ ¸å¿ƒæ€è·¯

**Phase 2å®Œæˆåï¼Œå°†learned_featuresä¿å­˜åˆ°configï¼Œä½†ä¸ä¿å­˜å®Œæ•´å‚æ•°**

#### å®ç°ä»£ç 

```python
# ç¬¬7735è¡Œä¹‹åæ·»åŠ 
# ã€V8.5.2.4.80ã€‘ä¿å­˜learned_featuresåˆ°configï¼ˆä¾›ä¸‹æ¬¡å›æµ‹å‚è€ƒï¼‰
# æ³¨æ„ï¼šè¿™é‡Œåªä¿å­˜learned_featuresï¼Œä¸ä¿å­˜å®Œæ•´å‚æ•°
if phase2_baseline and phase2_baseline.get('learned_features'):
    if 'phase2_history' not in current_config:
        current_config['phase2_history'] = []
    
    # æ·»åŠ æœ¬æ¬¡å­¦ä¹ æˆæœåˆ°å†å²è®°å½•
    current_config['phase2_history'].append({
        'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
        'learned_features': phase2_baseline['learned_features'],
        'capture_rate': phase2_baseline.get('capture_rate', 0),
        'avg_profit': phase2_baseline.get('avg_profit', 0)
    })
    
    # åªä¿ç•™æœ€è¿‘5æ¬¡è®°å½•ï¼ˆé¿å…æ–‡ä»¶è¿‡å¤§ï¼‰
    if len(current_config['phase2_history']) > 5:
        current_config['phase2_history'] = current_config['phase2_history'][-5:]
    
    # ä¿å­˜å½“å‰æœ€æ–°çš„learned_featuresï¼ˆä¾›å¿«é€Ÿè®¿é—®ï¼‰
    current_config['latest_learned_features'] = phase2_baseline['learned_features']
    
    # ç«‹å³ä¿å­˜learned_featuresï¼ˆä¸å½±å“Phase 3-4æµç¨‹ï¼‰
    save_learning_config(current_config)
    print(f"\n  ğŸ’¾ ã€Phase 2å­¦ä¹ æˆæœå·²ä¿å­˜ã€‘")
    print(f"     âœ… ä¿¡å·åˆ†æƒé‡é…ç½®")
    print(f"     âœ… Top5å‚æ•°ç»„åˆ")
    print(f"     âœ… æœ€ä¼˜TP/SLé…ç½®")
    print(f"     âœ… çœŸå®æŒä»“æ—¶é•¿")
    print(f"     ğŸ“Š å†å²è®°å½•: {len(current_config['phase2_history'])}æ¬¡")
```

#### ä¼˜ç‚¹

âœ… **ä¿ç•™å­¦ä¹ æˆæœ**ï¼šlearned_featuresä¸ä¼šä¸¢å¤±
âœ… **å†å²å¯è¿½æº¯**ï¼šä¿å­˜æœ€è¿‘5æ¬¡è®°å½•
âœ… **ä¸å½±å“æµç¨‹**ï¼šä¸ä¿å­˜Phase 2çš„å®Œæ•´å‚æ•°
âœ… **ä¸‹æ¬¡å¯å‚è€ƒ**ï¼šä¸‹æ¬¡å›æµ‹å¯ä»¥åŠ è½½å†å²å­¦ä¹ æˆæœ

---

### æ–¹æ¡ˆ2ï¼šå¢å¼ºç‰ˆ - æ”¯æŒå†å²å¯¹æ¯”

#### æ‰©å±•æ•°æ®ç»“æ„

```python
current_config['phase2_learning'] = {
    # å½“å‰æœ€æ–°çš„å­¦ä¹ æˆæœ
    'latest': {
        'timestamp': '2025-11-20 02:00:00',
        'learned_features': {...},
        'performance': {
            'capture_rate': 0.625,
            'avg_profit': 0.0695
        }
    },
    
    # å†å²è®°å½•ï¼ˆæœ€è¿‘5æ¬¡ï¼‰
    'history': [
        {
            'timestamp': '2025-11-19 02:00:00',
            'learned_features': {...},
            'performance': {...}
        },
        # ... å…¶ä»–4æ¬¡
    ],
    
    # ç»Ÿè®¡åˆ†æ
    'statistics': {
        'best_capture_rate': 0.625,
        'best_avg_profit': 0.0710,
        'avg_scalping_holding': 3.5,  # å¹³å‡è¶…çŸ­çº¿æŒä»“
        'avg_swing_holding': 16.8,    # å¹³å‡æ³¢æ®µæŒä»“
        'most_used_weights': {
            'scalping': 'é»˜è®¤',
            'swing': 'é»˜è®¤'
        }
    }
}
```

#### ä¼˜ç‚¹

âœ… **æ›´ä¸°å¯Œçš„å†å²æ•°æ®**
âœ… **æ”¯æŒç»Ÿè®¡åˆ†æ**
âœ… **å¯ä»¥å¯¹æ¯”ä¸åŒæ—¶æœŸçš„å­¦ä¹ æˆæœ**

---

### æ–¹æ¡ˆ3ï¼šè½»é‡çº§ - åªä¿å­˜å…³é”®å‚æ•°

#### æ ¸å¿ƒæ€è·¯

**åªä¿å­˜æœ€å…³é”®çš„learned_featuresï¼Œå‡å°‘æ–‡ä»¶å¤§å°**

#### ä¿å­˜å†…å®¹

```python
current_config['learned_features_summary'] = {
    'timestamp': '2025-11-20 02:00:00',
    
    # åªä¿å­˜æœ€å…³é”®çš„æ•°æ®
    'best_weights': {
        'scalping': best_scalping_weights['name'],
        'swing': best_swing_weights['name']
    },
    'optimal_tp_sl': {
        'scalping': {'tp': 18.7, 'sl': 1.5},
        'swing': {'tp': 20.4, 'sl': 2.5}
    },
    'real_holding': {
        'scalping': 3.4,
        'swing': 16.9
    },
    'top_params': top5_results[0]['params']  # åªä¿å­˜æœ€ä¼˜çš„
}
```

#### ä¼˜ç‚¹

âœ… **æ–‡ä»¶å°**ï¼šåªä¿å­˜å…³é”®æ•°æ®
âœ… **å¤Ÿç”¨**ï¼šåŒ…å«æœ€é‡è¦çš„å­¦ä¹ æˆæœ
âš ï¸ **ä¿¡æ¯æœ‰é™**ï¼šæ— æ³•å®Œæ•´è¿˜åŸ

---

## ğŸ¯ æ¨èå®æ–½æ–¹æ¡ˆ

### çŸ­æœŸï¼ˆç«‹å³å®æ–½ï¼‰ï¼šæ–¹æ¡ˆ1

**ç†ç”±**ï¼š
- ä¿ç•™å®Œæ•´å­¦ä¹ æˆæœ
- å®ç°ç®€å•
- æ”¯æŒå†å²è¿½æº¯

### ä¸­æœŸï¼ˆ1-2å‘¨ï¼‰ï¼šæ–¹æ¡ˆ2

**ç†ç”±**ï¼š
- å¢åŠ ç»Ÿè®¡åˆ†æ
- æ”¯æŒå†å²å¯¹æ¯”
- æå‡å¯è§‚å¯Ÿæ€§

---

## ğŸ”§ å…·ä½“å®ç°

### ä¿®æ”¹ä½ç½®

**deepseekç‰ˆæœ¬**ï¼šç¬¬7735è¡Œä¹‹å
**qwenç‰ˆæœ¬**ï¼šç¬¬7734è¡Œä¹‹å

### å®Œæ•´ä»£ç 

```python
# ã€V8.5.2.4.80ã€‘ä¿å­˜Phase 2å­¦ä¹ æˆæœåˆ°config
# ç›®çš„ï¼šä¿ç•™learned_featuresä¾›ä¸‹æ¬¡å›æµ‹å‚è€ƒï¼Œä½†ä¸ä¿å­˜å®Œæ•´å‚æ•°
if phase2_baseline and phase2_baseline.get('learned_features'):
    # åˆå§‹åŒ–phase2_learningç»“æ„
    if 'phase2_learning' not in current_config:
        current_config['phase2_learning'] = {
            'latest': None,
            'history': []
        }
    
    # æ„å»ºæœ¬æ¬¡å­¦ä¹ æˆæœ
    learning_record = {
        'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
        'learned_features': phase2_baseline['learned_features'],
        'performance': {
            'capture_rate': phase2_baseline.get('capture_rate', 0),
            'avg_profit': phase2_baseline.get('avg_profit', 0),
            'captured_count': phase2_baseline.get('captured_count', 0)
        }
    }
    
    # å¦‚æœæœ‰æ—§çš„latestï¼Œç§»åˆ°history
    if current_config['phase2_learning']['latest']:
        current_config['phase2_learning']['history'].insert(
            0, 
            current_config['phase2_learning']['latest']
        )
    
    # æ›´æ–°latest
    current_config['phase2_learning']['latest'] = learning_record
    
    # åªä¿ç•™æœ€è¿‘5æ¬¡å†å²è®°å½•
    if len(current_config['phase2_learning']['history']) > 5:
        current_config['phase2_learning']['history'] = \
            current_config['phase2_learning']['history'][:5]
    
    # ç«‹å³ä¿å­˜learned_featuresï¼ˆç‹¬ç«‹äºPhase 3-4æµç¨‹ï¼‰
    save_learning_config(current_config)
    
    print(f"\n  ğŸ’¾ ã€Phase 2å­¦ä¹ æˆæœå·²ä¿å­˜ã€‘")
    print(f"     âœ… ä¿¡å·åˆ†æƒé‡: è¶…çŸ­çº¿={phase2_baseline['learned_features']['best_scalping_weights']['name']}, æ³¢æ®µ={phase2_baseline['learned_features']['best_swing_weights']['name']}")
    print(f"     âœ… Top5å‚æ•°ç»„åˆ: {len(phase2_baseline['learned_features']['top5_param_combos'])}ç»„")
    print(f"     âœ… æœ€ä¼˜TP/SL: è¶…çŸ­çº¿TP={phase2_baseline['learned_features']['optimal_tp_sl']['scalping']['tp']}x, æ³¢æ®µTP={phase2_baseline['learned_features']['optimal_tp_sl']['swing']['tp']}x")
    print(f"     âœ… çœŸå®æŒä»“: è¶…çŸ­çº¿{phase2_baseline['learned_features']['scalping_real_holding_hours']:.1f}h, æ³¢æ®µ{phase2_baseline['learned_features']['swing_real_holding_hours']:.1f}h")
    print(f"     ğŸ“Š å†å²è®°å½•: {len(current_config['phase2_learning']['history'])}æ¬¡")
```

---

## ğŸ“Š æ•°æ®ç»“æ„å¯¹æ¯”

### æ—§ç»“æ„ï¼ˆV8.5.2.4.79ä¹‹å‰ï¼‰

```
config
â”œâ”€ scalping_params (Phase 3-4æœ€ç»ˆå‚æ•°)
â”œâ”€ swing_params (Phase 3-4æœ€ç»ˆå‚æ•°)
â””â”€ compressed_insights (AIæ´å¯Ÿ)
```

**é—®é¢˜**ï¼šPhase 2çš„learned_featuresä¸¢å¤±

### æ–°ç»“æ„ï¼ˆV8.5.2.4.80ï¼‰

```
config
â”œâ”€ scalping_params (Phase 3-4æœ€ç»ˆå‚æ•°)
â”œâ”€ swing_params (Phase 3-4æœ€ç»ˆå‚æ•°)
â”œâ”€ compressed_insights (AIæ´å¯Ÿ)
â””â”€ phase2_learning (æ–°å¢) â† å­¦ä¹ æˆæœ
   â”œâ”€ latest (æœ€æ–°ä¸€æ¬¡)
   â”‚  â”œâ”€ timestamp
   â”‚  â”œâ”€ learned_features
   â”‚  â”‚  â”œâ”€ best_scalping_weights
   â”‚  â”‚  â”œâ”€ best_swing_weights
   â”‚  â”‚  â”œâ”€ top5_param_combos
   â”‚  â”‚  â”œâ”€ optimal_tp_sl
   â”‚  â”‚  â””â”€ real_holding_hours
   â”‚  â””â”€ performance
   â””â”€ history (æœ€è¿‘5æ¬¡)
```

**ä¼˜ç‚¹**ï¼šå®Œæ•´ä¿ç•™å­¦ä¹ æˆæœï¼Œæ”¯æŒå†å²è¿½æº¯

---

## ğŸ”„ å‚æ•°ä¿å­˜æµç¨‹ï¼ˆV8.5.2.4.80ï¼‰

```
Phase 2å®Œæˆ
    â†“
ä¿å­˜learned_featuresåˆ°config['phase2_learning'] âœ…
    â†“
Phase 3ä¼˜åŒ–ï¼ˆä½¿ç”¨å†…å­˜ä¸­çš„learned_featuresï¼‰
    â†“
ä¿å­˜Phase 3å‚æ•°åˆ°config âœ…
    â†“
Phase 4éªŒè¯
    â†“
ä¿å­˜æœ€ç»ˆå‚æ•°åˆ°config âœ…
```

**ç‰¹ç‚¹**ï¼š
- âœ… learned_featuresç‹¬ç«‹ä¿å­˜ï¼ˆä¸å½±å“Phase 3-4ï¼‰
- âœ… Phase 3-4å‚æ•°æŒ‰åŸæµç¨‹ä¿å­˜
- âœ… ä¸‰æ¬¡ä¿å­˜ï¼Œå„å¸å…¶èŒ

---

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæŸ¥çœ‹å†å²å­¦ä¹ æˆæœ

```python
config = load_learning_config()
latest = config['phase2_learning']['latest']

print(f"æœ€æ–°å­¦ä¹ æˆæœï¼ˆ{latest['timestamp']}ï¼‰:")
print(f"  è¶…çŸ­çº¿æœ€ä¼˜æƒé‡: {latest['learned_features']['best_scalping_weights']['name']}")
print(f"  æ³¢æ®µæœ€ä¼˜æƒé‡: {latest['learned_features']['best_swing_weights']['name']}")
print(f"  æ•è·ç‡: {latest['performance']['capture_rate']*100:.1f}%")
```

### åœºæ™¯2ï¼šå¯¹æ¯”å†å²è¡¨ç°

```python
history = config['phase2_learning']['history']
for record in history:
    print(f"{record['timestamp']}: æ•è·ç‡{record['performance']['capture_rate']*100:.1f}%")
```

### åœºæ™¯3ï¼šä¸‹æ¬¡å›æµ‹å‚è€ƒ

```python
# ä¸‹æ¬¡å›æµ‹æ—¶ï¼Œå¯ä»¥åŠ è½½å†å²æœ€ä¼˜é…ç½®
latest = config['phase2_learning']['latest']
historical_best_weights = latest['learned_features']['best_scalping_weights']
# ä½œä¸ºPhase 2çš„èµ·ç‚¹ä¹‹ä¸€
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›

1. âœ… **ä¿å­˜learned_features**ï¼šä¸ä¼šä¸¢å¤±å­¦ä¹ æˆæœ
2. âœ… **å†å²å¯è¿½æº¯**ï¼šä¿å­˜æœ€è¿‘5æ¬¡è®°å½•
3. âœ… **ç‹¬ç«‹ä¿å­˜**ï¼šä¸å½±å“Phase 3-4æµç¨‹
4. âœ… **ç»“æ„æ¸…æ™°**ï¼šphase2_learningç‹¬ç«‹ç®¡ç†

### å®æ–½ä¼˜å…ˆçº§

1. **P0ï¼ˆç«‹å³ï¼‰**ï¼šå®ç°æ–¹æ¡ˆ1ï¼ˆä¿å­˜learned_featuresï¼‰
2. **P1ï¼ˆæœ¬å‘¨ï¼‰**ï¼šæ·»åŠ å†å²è®°å½•ç®¡ç†
3. **P2ï¼ˆä¸‹å‘¨ï¼‰**ï¼šå¢åŠ ç»Ÿè®¡åˆ†æåŠŸèƒ½

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `ds/deepseek_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆç¬¬7735è¡Œä¹‹åï¼‰
- `ds/qwen_å¤šå¸ç§æ™ºèƒ½ç‰ˆ.py`ï¼ˆç¬¬7734è¡Œä¹‹åï¼‰
- `V8.5.2.4.79_å‚æ•°æµç¨‹æ¢³ç†ä¸ä¼˜åŒ–æ–¹æ¡ˆ.md`ï¼ˆå‰ç½®æ–‡æ¡£ï¼‰

